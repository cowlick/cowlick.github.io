<!doctype html>
<!-- Generated by akashic-cli-export-html@0.2.24. -->
<!-- Options: {"force":true,"strip":true,"minify":true,"bundle":true} -->
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>game</title>
<script>
	!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.engineFilesV2_1_17=t()}}(function(){var t;return function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return n(i||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){e.exports=t("./lib/main.node")},{"./lib/main.node":2}],2:[function(t,e,i){(function(){"use strict";var t,i=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};!function(t){var e;!function(t){t[t.Unspecified=0]="Unspecified",t[t.RetryLimitExceeded=1]="RetryLimitExceeded",t[t.NetworkError=2]="NetworkError",t[t.ClientError=3]="ClientError",t[t.ServerError=4]="ServerError"}(e=t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){var e;!function(e){function i(t,e){var i=new Error(t);return i.name="AssertionError",i.cause=e,i}function r(t,e,i,r){var n="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,n+=", actual type is "+(o.length>40?o.substr(0,40):o)}catch(s){}n+=".";var a=new Error(n);return a.name="TypeMismatchError",a.cause=r,a.expected=e,a.actual=i,a}function n(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name="AssetLoadError",o.cause=n,o.retriable=i,o.type=r,o}e.createAssertionError=i,e.createTypeMismatchError=r,e.createAssetLoadError=n}(e=t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e.prototype.createTrimmedSurface=function(t,e){var i=e||{x:0,y:0,width:t.width,height:t.height},r=this.createSurface(i.width,i.height),n=r.renderer();return n.begin(),n.drawImage(t,i.x,i.y,i.width,i.height,0,0),n.end(),r},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.seed=t,this[0]=this}return t}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.id=e,this.originalPath=i,this.path=this._assetPathFilter(i),this.onDestroyed=new t.Trigger}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return o.width=r,o.height=n,o}return i(e,t),e.prototype.initialize=function(t){this.hint=t},e}(e);t.ImageAsset=r;var n=function(t){function e(e,i,r,n,o,s,a){var h=t.call(this,e,i,r,n)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=s,h._useRealSize=a,h}return i(e,t),e.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},e.prototype.stop=function(){this.getPlayer().stop()},e.prototype.destroy=function(){this._system=void 0,t.prototype.destroy.call(this)},e}(r);t.VideoAsset=n;var o=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=s,a._system=n,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=s;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r,n){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._moduleMainScripts=n?n:{},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,n="string"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(n))++this._refCounts[n],e._onAssetLoad(this._assets[n]);else if(this._loadings.hasOwnProperty(n))r=this._loadings[n],r.handlers.push(e),++this._refCounts[n],o=!0;else{var s=this._createAssetFor(t);r=new i(s,e),this._loadings[n]=r,this._refCounts[n]=1,o=!0,r.loading=!0,s._load(this)}return o},r.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,n=t.length;n>r;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;i>e;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var n in e)if(e.hasOwnProperty(n)){var o=Object.create(e[n]);if(!o.path)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+n);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+n);if(!o.type)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+n);if("image"===o.type){if("number"!=typeof o.width)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+n);if("number"!=typeof o.height)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+n)}if("audio"===o.type){void 0===o.duration&&(o.duration=0);var s=i[o.systemId];void 0===o.loop&&(o.loop=!!s&&!!s.loop),void 0===o.hint&&(o.hint=s?s.hint:{})}if("video"===o.type&&!o.useRealSize){if("number"!=typeof o.width)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+n);if("number"!=typeof o.height)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+n);o.useRealSize=!1}o.global||(o.global=!1),r[n]=o}return r},r.prototype._createAssetFor=function(e){var i,r,n;if("string"==typeof e)i=e,n=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,n=o,r=o.uri}var s=this.game.resourceFactory;if(!n)throw t.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+i);switch(n.type){case"image":var a=s.createImageAsset(i,r,n.width,n.height);return a.initialize(n.hint),a;case"audio":var h=n.systemId?this.game.audio[n.systemId]:this.game.audio[this.game.defaultAudioSystemId];return s.createAudioAsset(i,r,n.duration,h,n.loop,n.hint);case"text":return s.createTextAsset(i,r);case"script":return s.createScriptAsset(i,r);case"video":return s.createVideoAsset(i,r,n.width,n.height,new t.VideoSystem,n.loop,n.useRealSize);default:throw t.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+n.type+" for asset ID: "+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+r.id);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var n=this.configuration[e].virtualPath;n&&this._liveAssetVirtualPathTable.hasOwnProperty(n)&&delete this._liveAssetVirtualPathTable[n],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var n=this._loadings[e.id],o=n.handlers;n.loading=!1,++n.errorCount,n.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var s=0;s<o.length;++s)o[s]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var n=i.handlers,o=0;o<n.length;++o)n[o]._onAssetLoad(e)}},r}();r.MAX_ERROR_COUNT=3,t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var n,o,s=e._assetManager._liveAssetVirtualPathTable,a=e._assetManager._moduleMainScripts;if(-1===i.indexOf("/")&&e._assetManager._assets.hasOwnProperty(i)&&(n=e._assetManager._assets[i],o=e._assetManager._liveAbsolutePathTable[n.path]),/^\.\/|^\.\.\/|^\//.test(i)){if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError("g._require: require from DynamicAsset is not supported");o=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if(!/^\.\//.test(i))throw t.ExceptionFactory.createAssertionError("g._require: entry point path must start with './'");o=i.substring(2)}if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+".js"))return e._scriptCaches[o+".js"]._cachedValue();n||(n=t.Util.findAssetByPathAsFile(o,s)),n||(n=t.Util.findAssetByPathAsDirectory(o,s))}else if(a[i]&&(o=a[i],n=e._assetManager._liveAssetVirtualPathTable[o]),!n){var h=r?r.paths:[];h.push("node_modules");for(var c=0;c<h.length;++c){var u=h[c];if(o=t.PathUtil.resolvePath(u,i),n=t.Util.findAssetByPathAsFile(o,s))break;if(n=t.Util.findAssetByPathAsDirectory(o,s))break}}if(n){if(e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(n instanceof t.ScriptAsset){var l=new t.ScriptAssetContext(e,n);return e._scriptCaches[o]=l,l._executeScript(r)}if(n instanceof t.TextAsset&&n&&".json"===t.PathUtil.resolveExtname(i)){var d=e._scriptCaches[o]=new t.RequireCachedValue(JSON.parse(n.data));return d._cachedValue()}}throw t.ExceptionFactory.createAssertionError("g._require: can not find module: "+i)}t._require=e;var i=function(){function e(e,i,r){var n=this,o=t.PathUtil.resolveDirname(r),s=e._assetManager._liveAbsolutePathTable[r],a=s?t.PathUtil.resolveDirname(s):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return"g"===i?h:t._require(e,i,n)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,i,r,n,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h*i,l=c*i,d=c*r,p=h*r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-u*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateByInverse=function(t,e,i,r,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),c=Math.sin(a),u=h/i,l=c/r,d=c/i,p=h/r,f=t/2,_=e/2;this._matrix[0]=u,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-u*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],n=e[1],o=e[2],s=e[3];e[0]=r*i[0]+o*i[1],e[1]=n*i[0]+s*i[1],e[2]=r*i[2]+o*i[3],e[3]=n*i[2]+s*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=n*i[4]+s*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix,i=e[0]*t.x+e[2]*t.y+e[4],r=e[1]*t.x+e[3]*t.y+e[5];return{x:i,y:r}},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){var e;!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function n(t,i){return e.distance(t.x+t.width/2,t.y+t.height/2,i.x+i.width/2,i.y+i.height/2)}function o(e,i,r,n,o){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,n,o)}function s(e,i,r){var n=i.x,o=i.y,s=0,a=0,h=i.width,c=i.height,u=i.calculateBoundingRect(r);if(!u)throw t.ExceptionFactory.createAssertionError("Util#createSpriteFromE: camera must look e");h=u.right-u.left,c=u.bottom-u.top,u.left<i.x&&(s=i.x-u.left),u.top<i.y&&(a=i.y-u.top),i.moveTo(s,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),d=l.renderer();d.begin(),i.render(d,r),d.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(u.left,u.top),i.moveTo(n,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var n=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=n.renderer();o.begin();for(var s=i.children,a=0;a<s.length;++a)s[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:n,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError("Util#asSurface","ImageAsset|Surface",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0}function u(i,r){var n;if(n=i+"/package.json",r.hasOwnProperty(n)&&r[n]instanceof t.TextAsset){var o=JSON.parse(r[n].data);if(o&&"string"==typeof o.main){var s=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(s)return s}}return n=i+"/index.js",r.hasOwnProperty(n)?r[n]:void 0}function l(t,e){var i=t.charCodeAt(e);if(i>=55296&&56319>=i){var r=i,n=t.charCodeAt(e+1);return r<<16|n}return i>=56320&&57343>=i?null:i}function d(t,e){e.isDynamic&&(e.animatingStarted.add(t._onAnimatingStarted,t),e.animatingStopped.add(t._onAnimatingStopped,t),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t._onAnimatingStarted,t),e.animatingStopped.remove(t._onAnimatingStopped,t)),i.isDynamic&&(i.animatingStarted.add(t._onAnimatingStarted,t),i.animatingStopped.add(t._onAnimatingStopped,t),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=n,e.createMatrix=o,e.createSpriteFromE=s,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=u,e.charCodeAt=l,e.setupAnimatingHandler=d,e.migrateAnimatingHandler=p}(e=t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){var e;!function(e){function i(t,e,i,r,n,o,s,a){return n+s>=t&&t+i>=n&&o+a>=e&&e+r>=o}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function n(e,i,r,n,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,n)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=n,e.withinAreas=o}(e=t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(){this._handlers=[],this.length=0}return t.prototype.add=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!1,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!1,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!1,name:i.name})}this.length=this._handlers.length},t.prototype.addOnce=function(t,e){if("function"==typeof t)this._handlers.push({func:t,owner:e,once:!0,name:void 0});else{var i=t;"number"==typeof i.index?this._handlers.splice(i.index,0,{func:i.func,owner:i.owner,once:!0,name:i.name}):this._handlers.push({func:i.func,owner:i.owner,once:!0,name:i.name})}this.length=this._handlers.length},t.prototype.handle=function(t,e,i){this.add(e?{owner:t,func:e,name:i}:{func:t})},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length){for(var e=this._handlers.concat(),i=0;i<e.length;i++){var r=e[i];if(r.func.call(r.owner,t)||r.once){var n=this._handlers.indexOf(r);-1!==n&&this._handlers.splice(n,1)}}this._handlers&&(this.length=this._handlers.length)}},t.prototype.contains=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++)if(this._comparePartial(i,this._handlers[r]))return!0;return!1},t.prototype.remove=function(t,e){for(var i="function"==typeof t?{func:t,owner:e}:t,r=0;r<this._handlers.length;r++){var n=this._handlers[r];if(i.func===n.func&&i.owner===n.owner&&i.name===n.name)return this._handlers.splice(r,1),void--this.length}},t.prototype.removeAll=function(t){var e=[];if(t)for(var i=0;i<this._handlers.length;i++){var r=this._handlers[i];this._comparePartial(t,r)||e.push(r)}this._handlers=e,this.length=this._handlers.length},t.prototype.destroy=function(){this._handlers=null,this.length=null},t.prototype.destroyed=function(){return null===this._handlers},t.prototype._comparePartial=function(t,e){return void 0!==t.func&&t.func!==e.func?!1:void 0!==t.owner&&t.owner!==e.owner?!1:void 0!==t.name&&t.name!==e.name?!1:!0},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var n=t.call(this)||this;return n.chain=e,n.filter=i,n.filterOwner=r,n._isActivated=!1,n}return i(e,t),e.prototype.add=function(e,i){t.prototype.add.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.addOnce=function(e,i){t.prototype.addOnce.call(this,e,i),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)},e.prototype.remove=function(e,i){t.prototype.remove.call(this,e,i),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.removeAll=function(e){t.prototype.removeAll.call(this,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1},e.prototype._onChainTriggerFired=function(t){(!this.filter||this.filter.call(this.filterOwner,t))&&this.fire(t)},e}(e);t.ChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed||0===this.elapsed.length},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=n,this._timer.elapsed.add(this._fire,this)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this._fire,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),0>e)throw t.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");1>e&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var n=new t.Timer(e,this._fps);return this._timers.push(n),n},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(0>i)throw t.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){var n=this.createTimer(i),o=new e(n,t,r);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(0>i)throw t.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(0>i)throw t.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(e.destroyed())throw t.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.stopped.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e.prototype._onVolumeChanged=function(){},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(0>e||e>1||isNaN(e)||"number"!=typeof e)throw t.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=this.game._audioSystemManager._muted,this._playbackRate=this.game._audioSystemManager._playbackRate},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(0>e||isNaN(e)||"number"!=typeof e)throw t.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,"player",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._reset=function(){e.prototype._reset.call(this),this._player&&(this._player.played.remove({owner:this,func:this._onPlayerPlayed}),this._player.stopped.remove({owner:this,func:this._onPlayerStopped})),this._player=void 0,this._suppressingAudio=void 0},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player._changeMuted(!1)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player._changeMuted(!0),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._suppressingAudio&&(this._suppressingAudio=void 0,this.player._changeMuted(!1)),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var i=this.players[e];i.played.remove({owner:this,func:this._onPlayerPlayed}),i.stopped.remove({owner:this,func:this._onPlayerStopped})}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate),t[e]._supportsPlaybackRate()||1===this._playbackRate||t[e].stop()},e.prototype._onPlayerPlayed=function(t){t.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);0>e||(t.player.stopped.remove({owner:this,func:this._onPlayerStopped}),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume)},e}(e);t.SoundAudioSystem=n}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,
video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity="opacity"in t?t.opacity:1,this.scaleX="scaleX"in t?t.scaleX:1,this.scaleY="scaleY"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if("number"==typeof e&&"number"!=typeof i)throw t.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if("number"==typeof e&&"number"!=typeof i)throw t.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=i.tag,r.shaderProgram=i.shaderProgram,r.local=i.scene.local!==t.LocalTickMode.NonLocal||!!i.local,i.children)for(var n=0;n<i.children.length;++n)r.append(i.children[n]);return i.parent&&i.parent.append(r),i.targetCameras&&(r.targetCameras=i.targetCameras),"touchable"in i&&(r.touchable=i.touchable),i.hidden&&r.hide(),r.id=i.id,i.scene.register(r),r}return i(r,e),Object.defineProperty(r.prototype,"update",{get:function(){return this._update||(this._update=new t.ChainTrigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"message",{get:function(){return this._message||(this._message=new t.ChainTrigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointDown",{get:function(){return this._pointDown||(this._pointDown=new t.ChainTrigger(this.scene.pointDownCapture,this._isTargetOperation,this)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointUp",{get:function(){return this._pointUp||(this._pointUp=new t.ChainTrigger(this.scene.pointUpCapture,this._isTargetOperation,this)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointMove",{get:function(){return this._pointMove||(this._pointMove=new t.ChainTrigger(this.scene.pointMoveCapture,this._isTargetOperation,this)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"targetCameras",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,o=n.length,s=0;o>s;++s)n[s].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram);var r=this.renderSelf(t,e);if(r&&this.children)for(var n=this.children,s=0;s<n.length;++s)n[s].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(0>i)throw t.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(;this.children.length;)this.children[this.children.length-1].destroy();this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var n=this._targetCameras;if(!(n&&n.length>0)||r&&-1!==n.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var s=this.children.length-1;s>=0;--s){var a=this.children[s];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!==(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(s.left>h.left&&(s.left=h.left),s.right<h.right&&(s.right=h.right),s.top>h.top&&(s.top=h.top),s.bottom<h.bottom&&(s.bottom=h.bottom))}return s}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return 1&this.state?!1:e instanceof t.PointEvent?this._touchable&&e.target===this:!1},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,i){var r=e.PADDING;if(this._renderedCamera!==i&&(this.state&=-3,this._renderedCamera=i),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*r,o=Math.ceil(this._cacheSize.height)+2*r,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(r,r),this.renderCache(a,i),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-r,-r),this.renderSelfFromCache(t),t.translate(r,r)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e}(t.E);e.PADDING=1,t.CacheableE=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Slots=1]="Slots",t[t.Scores=2]="Scores",t[t.Counts=3]="Counts",t[t.Values=4]="Values"}(e=t.StorageRegion||(t.StorageRegion={}));var i;!function(t){t[t.Asc=0]="Asc",t[t.Desc=1]="Desc"}(i=t.StorageOrder||(t.StorageOrder={}));var r;!function(t){t[t.Equal=1]="Equal",t[t.GreaterThan=2]="GreaterThan",t[t.LessThan=3]="LessThan"}(r=t.StorageCondition||(t.StorageCondition={}));var n;!function(t){t[t.Incr=1]="Incr",t[t.Decr=2]="Decr"}(n=t.StorageCountsOperation||(t.StorageCountsOperation={}));var o=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);if(e)return e[0]},t}();t.StorageValueStore=o;var s=function(){function t(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new o(e),this._handler=void 0,this._valueStoreSerialization=i}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=s;var a=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new s(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=a}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return 0===this.waitingAssetsCount?!1:this._requested?!0:(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),!0)},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&this._scene.game.terminateGame(),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount,this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError("SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]="Destroyed",t[t.Standby=1]="Standby",t[t.Active=2]="Active",t[t.Deactive=3]="Deactive",t[t.BeforeDestroyed=4]="BeforeDestroyed"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]="Initial",t[t.Ready=1]="Ready",t[t.ReadyFired=2]="ReadyFired",t[t.LoadedFired=3]="LoadedFired"}(r=t.SceneLoadState||(t.SceneLoadState={}));var n=function(){function n(n){var o,s,a,h;o=n.game,h=n.assetIds,n.storageKeys?(this._storageLoader=o.storage._createLoader(n.storageKeys,n.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),s=void 0===n.local?t.LocalTickMode.NonLocal:n.local===!1?t.LocalTickMode.NonLocal:n.local===!0?t.LocalTickMode.FullLocal:n.local,a=void 0!==n.tickGenerationMode?n.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=n.name,h||(h=[]),this.game=o,this.local=s,this.tickGenerationMode=a,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:h,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return n.prototype.modified=function(t){this.game.modified=!0},n.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},n.prototype.destroyed=function(){return void 0===this.game},n.prototype.createTimer=function(t){return this._timer.createTimer(t)},n.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},n.prototype.setInterval=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setInterval(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setInterval(i,t,e):r.setInterval(e,t,null)):r.setInterval(t,e,i)},n.prototype.clearInterval=function(t){this._timer.clearInterval(t)},n.prototype.setTimeout=function(t,e,i){var r=this._timer;return"number"==typeof t?(this.game.logger.warn("[deprecated] Scene#setTimeout(): this arguments ordering is now deprecated. Specify the function first."),null!=i?r.setTimeout(i,t,e):r.setTimeout(e,t,null)):r.setTimeout(t,e,i)},n.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},n.prototype.isCurrentScene=function(){return this.game.scene()===this},n.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");i?this.game.pushScene(e):this.game.replaceScene(e)},n.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},n.prototype.register=function(t){this.game.register(t),t.scene=this},n.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},n.prototype.append=function(t){this.insertBefore(t,void 0)},n.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},n.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},n.prototype.findPointSourceByPoint=function(e,i,r){var n=this.local!==t.LocalTickMode.NonLocal,o=this.children,s=void 0;r&&r instanceof t.Camera2D&&(s=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,s,i,r);if(h)return h.local=h.target.local||n,h}return{target:void 0,point:void 0,local:n}},n.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},n.prototype.serializeStorageValues=function(){return this._storageLoader?this._storageLoader._valueStoreSerialization:void 0},n.prototype.requestAssets=function(i,n){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:n});this._assetHolders.push(o),o.request()},n.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},n.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},n.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},n.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},n.prototype._onSceneAssetsLoad=function(){this._loaded&&(!this._storageLoader||this._storageLoader._loaded)&&this._notifySceneReady()},n.prototype._onStorageLoadError=function(t){this.game.terminateGame()},n.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},n.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},n.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},n.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},n}();t.Scene=n}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.addOnce(this._doReset,this):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:"(no scene)",i="LoadingScene#end(): the target scene is in invalid state: "+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll({owner:this}),this._targetScene.assetLoaded.removeAll({owner:this}),this._targetScene=void 0)},r.prototype._doReset=function(){this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.add(this._fireTriggerOnTargetReady,this),this._targetScene.assetLoaded.add(this._fireTriggerOnTargetAssetLoad,this),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene)},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;(i.x!==r.x||i.y!==r.y||i.angle!==r.angle||i.scaleX!==r.scaleX||i.scaleY!==r.scaleY)&&(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function n(t){var e=r.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(n,r),n.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:"rgba(0, 0, 0, 0.8)",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},n.prototype._onUpdateGuage=function(){var t=50,e=2/3;++this._gaugeUpdateCount;var i=Math.round(255-t+Math.sin(this._gaugeUpdateCount/this.game.fps*e*(2*Math.PI))*t);this._gauge.cssColor="rgb("+i+","+i+","+i+")",this._gauge.modified()},n.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},n.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},n}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.surface=t.Util.asSurface(i.src),"width"in i||(r.width=r.surface.width),"height"in i||(r.height=r.surface.height),r.srcWidth="srcWidth"in i?i.srcWidth:r.width,r.srcHeight="srcHeight"in i?i.srcHeight:r.height,r.srcX=i.srcX||0,r.srcY=i.srcY||0,r._stretchMatrix=void 0,r._beforeSurface=r.surface,t.Util.setupAnimatingHandler(r,r.surface),r._invalidateSelf(),r}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.contains(this._onUpdate,this)||this.update.add(this._onUpdate,this)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this._onUpdate,this)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0?!0:(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this._onAnimatingStarted,this),this.surface.animatingStopped.remove(this._onAnimatingStopped,this))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._lastUsedIndex=0,r.frameNumber=i.frameNumber||0,r.frames="frames"in i?i.frames:[0],r.interval=i.interval,r._timer=void 0,r.loop=null!=i.loop?i.loop:!0,r.finished=new t.Trigger,r._modifiedSelf(),r}return i(r,e),r.createBySprite=function(t,e,i){var n=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===e?t.srcWidth:e,n},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.add(this._onElapsed,this)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.finished.fire()):this.frameNumber++,this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this._onElapsed,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]="Unknown",t[t.Join=1]="Join",t[t.Leave=2]="Leave",t[t.Timestamp=3]="Timestamp",t[t.Seed=4]="Seed",t[t.PointDown=5]="PointDown",t[t.PointMove=6]="PointMove",t[t.PointUp=7]="PointUp",t[t.Message=8]="Message",t[t.Operation=9]="Operation"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,n,o){this.priority=o,this.local=n,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var n=function(t){function r(i,r,n,o,s,a){var h=t.call(this,i,r,n,o,s,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=n;var o=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointUp,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointUpEvent=o;var s=function(t){function r(i,r,n,o,s,a,h,c){var u=t.call(this,i,r,n,a,h,c)||this;return u.type=e.PointMove,u.prevDelta=o,u.startDelta=s,u}return i(r,t),r}(r);t.PointMoveEvent=s;var a=function(){function t(t,i,r,n){this.type=e.Message,this.priority=n,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,n,o){this.type=e.Operation,this.priority=o,this.local=n,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var u=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=u;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var d=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=d}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Info=2]="Info",t[t.Debug=3]="Debug"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.destroy=function(){this.game=void 0,this.logging.destroy(),this.logging=void 0},i.prototype.destroyed=function(){return!this.game},i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,message:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=null,this.age=0,this.assetBase=r||"",this.resourceFactory=i,this.selfId=n||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem("music",this),sound:new t.SoundAudioSystem("sound",this)},this.defaultAudioSystemId="sound",this.storage=new t.Storage(this),this.assets={},this.surfaceAtlasSet=void 0,this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,
this.resized=new t.Trigger,this.skippingChanged=new t.Trigger,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio,e.moduleMainScripts);var s=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,s),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.add(this._operationPluginOperated.fire,this._operationPluginOperated),this._sceneChanged=new t.Trigger,this._sceneChanged.add(this._updateEventTriggers,this),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.loaded.add(this._onInitialSceneLoaded,this),this._reset({age:0})}return Object.defineProperty(e.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){return this.scenes.length?this.scenes[this.scenes.length-1]:void 0},e.prototype.tick=function(t,e){var i=void 0;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var n=0;n<r.length;++n){var o=this._eventTriggerMap[r[n].type];o&&o.fire(r[n])}}i.update.fire(),t&&++this.age}return this._sceneChangeRequests.length?(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1]):!1},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0,this._terminateGame()},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if("assets"in e||(e.assets={}),"fps"in e||(e.fps=30),"number"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof e.width)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof e.height)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random=e.randGen)),this._audioSystemManager._reset(),this._loaded.removeAll({func:this._start,owner:this}),this.join.removeAll(),this.leave.removeAll(),this.seed.removeAll(),this.resized.removeAll(),this.skippingChanged.removeAll(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest.removeAll(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this.surfaceAtlasSet&&this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new t.SurfaceAtlasSet({game:this}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._destroy=function(){if(this._operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this.events=void 0,this.join.destroy(),this.join=void 0,this.leave.destroy(),this.leave=void 0,this.seed.destroy(),this.seed=void 0,this.modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0;for(var t=Object.keys(this.audio),e=0;e<t.length;++e)this.audio[t[e]].stopAll();this.audio=void 0,this.defaultAudioSystemId=void 0,this.logger.destroy(),this.logger=void 0,this.snapshotRequest.destroy(),this.snapshotRequest=void 0,this.resourceFactory=void 0,this.storage=void 0,this.playId=void 0,this.operationPlugins=void 0,this.resized.destroy(),this.resized=void 0,this.skippingChanged.destroy(),this.skippingChanged=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._sceneChanged.destroy(),this._sceneChanged=void 0,this._scriptCaches=void 0,this._loaded.destroy(),this._loaded=void 0,this._started.destroy(),this._started=void 0,this._main=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._audioSystemManager._game=void 0,this._audioSystemManager=void 0,this._operationPluginManager=void 0,this._operationPluginOperated.destroy(),this._operationPluginOperated=void 0,this._idx=0,this._localDb={},this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._configuration=void 0,this._sceneChangeRequests=[],this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.add(this._start,this),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){return this.modified=!0,e?(this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,void e._activate()):(this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0))},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this._onInitialSceneLoaded,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._terminateGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var n=this.scene();n&&n._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene.destroyed()||r.scene._fireReady();break;case 4:r.scene.destroyed()||r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError("Game#_flushSceneChangeRequests: unknown scene change request.")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError("Game#_start: global asset 'snapshotLoader' not found.");var e=t._require(this,"snapshotLoader");e(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError("Game#_start: global asset 'mainScene' not found.");var i=t._require(this,"mainScene")();this.pushScene(i),this._flushSceneChangeRequests()}return void this._started.fire()}var r=t._require(this,this._main);if(!r||"function"!=typeof r)throw t.ExceptionFactory.createAssertionError("Game#_start: Entry point '"+this._main+"' not found.");r(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.game=e.game,i.local=!!e.local,i.name=e.name,i._modifiedCount=0,i.width=e.game.width,i.height=e.game.height,i.id=i.local?void 0:i.game._cameraIdx++,i}return i(e,t),e.deserialize=function(t,i){var r=t;r.param.game=i;var n=new e(r.param);return n.id=r.id,n},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},e.prototype.serialize=function(){var t={id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}};return t},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},e}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.save(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,n=0;n<r.length;++n)r[n].render(this,e);e&&this.restore(),this.restore(),this.end()}},t.prototype.begin=function(){},t.prototype.end=function(){},t}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n){if(void 0===n&&(n=!1),e%1!==0||i%1!==0)throw t.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=n,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r.text=i.text,r.font=i.font,r.textAlign="textAlign"in i?i.textAlign:t.TextAlign.Left,r.glyphs=new Array(i.text.length),r.fontSize=i.fontSize,r.maxWidth=i.maxWidth,r.widthAutoAdjust="widthAutoAdjust"in i?i.widthAutoAdjust:!0,r.textColor=i.textColor,r._textWidth=0,r._game=void 0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderSelfFromCache=function(e){var i;switch(this.textAlign){case t.TextAlign.Center:i=this.widthAutoAdjust?this._overhangLeft:0;break;case t.TextAlign.Right:i=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:i=this._overhangLeft}e.drawImage(this._cache,0,0,this._cacheSize.width+t.CacheableE.PADDING,this._cacheSize.height+t.CacheableE.PADDING,i,0)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this.textAlign){case t.TextAlign.Center:r=this.width/2-(this._textWidth+this._overhangLeft)/2*i;break;case t.TextAlign.Right:r=this.width-(this._textWidth+this._overhangLeft)*i;break;default:r-=this._overhangLeft*i}e.translate(r,0),1!==i&&e.transform([i,0,0,1,0,0]),e.save();for(var n=this.fontSize/this.font.size,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*n,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(e.save(),e.transform([n,0,0,n,0,0]),e.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),e.restore()),e.translate(a,0)):this._outputOfWarnLogWithNoGlyph(h,"renderCache()")}e.restore(),e.save(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=this.text.length-1,i=this.text.length-1;i>=0;--i){var r=t.Util.charCodeAt(this.text,i);if(r){var n=this.font.glyphForCharacter(r);if(n&&0!==n.width&&0!==n.advanceWidth){e=i;break}}}for(var o=0,s=this.font.size>0?this.fontSize/this.font.size:0,i=0;e>=i;++i){var a=t.Util.charCodeAt(this.text,i);if(a){var n=this.font.glyphForCharacter(a);if(n){if(!(n.width<0||n.height<0||n.x<0||n.y<0)){this.glyphs.push(n);var h=0;0===i&&(this._overhangLeft=Math.min(n.offsetX,0),h=-this._overhangLeft),i===e&&(this._overhangRight=Math.max(n.width+n.offsetX-n.advanceWidth,0),h+=this._overhangRight),this._textWidth+=(n.advanceWidth+h)*s;var c=n.offsetY+n.height;c>o&&(o=c)}}else this._outputOfWarnLogWithNoGlyph(a,"_invalidateSelf()")}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=o*s},r.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var i=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn("Label#"+e+": failed to get a glyph for '"+i+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,n,o,s,a,h,c){void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=n,this.offsetX=o,this.offsetY=s,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;if("string"!=typeof i.cssColor)throw t.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",i.cssColor);return r.cssColor=i.cssColor,r}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._oldWidth=i.width,r._oldHeight=i.height,r.backgroundImage=t.Util.asSurface(i.backgroundImage),r.backgroundEffector=i.backgroundEffector,r._shouldRenderChildren=!1,r._padding=i.padding,r._initialize(),r._paddingChanged=!1,r._bgSurface=void 0,r._bgRenderer=void 0,r}return i(r,e),Object.defineProperty(r.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y?!0:!1},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),(0!==this._childrenArea.x||0!==this._childrenArea.y)&&t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){if(this.backgroundImage&&this.backgroundEffector){var t=this.backgroundEffector.render(this.backgroundImage,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},n=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(n[0]),s={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<n.length;++a)o=i.multiplyPoint(n[a]),s.left>o.x&&(s.left=o.x),s.right<o.x&&(s.right=o.x),s.top>o.y&&(s.top=o.y),s.bottom<o.y&&(s.bottom=o.y);return s}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var n=t._require(this._game,r.script);if(n.isSupported()){var o=new n(this._game,this._viewInfo,r.option),s=r.code;if(this.plugins[s])throw new Error("Plugin#code conflicted for code: "+s);this.plugins[s]=o,r._plugin=o;var a=new e(s,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;!function(t){}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Normal=0]="Normal",t[t.Bold=1]="Bold"}(e=t.FontWeight||(t.FontWeight={}));var i=function(){function i(i){if(this.fontFamily=i.fontFamily,this.size=i.size,this.hint="hint"in i?i.hint:{},this.fontColor="fontColor"in i?i.fontColor:"black",this.fontWeight="fontWeight"in i?i.fontWeight:e.Normal,this.strokeWidth="strokeWidth"in i?i.strokeWidth:0,this.strokeColor="strokeColor"in i?i.strokeColor:"black",this.strokeOnly="strokeOnly"in i?i.strokeOnly:!1,this._resourceFactory=i.game.resourceFactory,this._glyphFactory=this._resourceFactory.createGlyphFactory(this.fontFamily,this.size,this.hint.baselineHeight,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),this._glyphs={},this._destroyed=!1,this._isSurfaceAtlasSetOwner=!1,i.surfaceAtlasSet?this._atlasSet=i.surfaceAtlasSet:i.hint?(this._isSurfaceAtlasSetOwner=!0,this._atlasSet=new t.SurfaceAtlasSet({game:i.game,hint:this.hint})):this._atlasSet=i.game.surfaceAtlasSet,this._atlasSet.addAtlas(),this.hint.presetChars)for(var r=0,n=this.hint.presetChars.length;n>r;r++){var o=t.Util.charCodeAt(this.hint.presetChars,r);o&&this.glyphForCharacter(o)}}return i.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){var i=this._atlasSet.addGlyph(e);if(!i)return null;e._atlas=i,e._atlas._accessScore+=1}this._glyphs[t]=e}for(var r=0;r<this._atlasSet.getAtlasNum();r++){var n=this._atlasSet.getAtlas(r);n._accessScore/=2}return e},i.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlasSet.getAtlasNum())return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));var n={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};n[e]=o});var o=n[r],s=this._atlasSet.getAtlas(0).duplicateSurface(this._resourceFactory),a=new t.BitmapFont({src:s,map:n,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:o});return a},i.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},i.prototype.destroyed=function(){return this._destroyed},i}();t.DynamicFont=i}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){var e=Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),i=Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight));return{width:e,height:i}}var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=r;var n=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new r(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var n=e(this._emptySurfaceAtlasSlotHead,t,i);if(!n)return null;var o,s,a=n.width-t,h=n.height-i;h>=a?(o=new r(n.x+t,n.y,a,i),s=new r(n.x,n.y+i,n.width,h)):(o=new r(n.x,n.y+i,t,h),s=new r(n.x+t,n.y,a,n.height)),o.prev=n.prev,o.next=s,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,s.prev=o,s.next=n.next,s.next&&(s.next.prev=s);var c=new r(n.x,n.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t){var e=this._acquireSurfaceAtlasSlot(t.width,t.height);if(!e)return null;var i=this._surface.renderer();return i.begin(),i.drawImage(t.surface,t.x,t.y,t.width,t.height,e.x,e.y),i.end(),e},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=n;var o=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.game.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=i(r)}return t.prototype._deleteAtlas=function(t){for(var e=this._removeLeastFrequentlyUsedAtlas(t),i=e.surfaceAtlases,r=0;r<i.length;++r)i[r].destroy()},t.prototype._removeLeastFrequentlyUsedAtlas=function(t){for(var e=[],i=[],r=0;t>r;++r){for(var n=Number.MAX_VALUE,o=-1,s=0;s<this._surfaceAtlases.length;++s)this._surfaceAtlases[s]._accessScore<=n&&(n=this._surfaceAtlases[s]._accessScore,o=s);var a=this._surfaceAtlases.splice(o,1)[0];e.push(a),i.push(this._atlasGlyphsTable.splice(o,1)[0])}return{surfaceAtlases:e,glyphs:i}},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var i=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,r=this._surfaceAtlases[i],n=r.addSurface(t);if(n)return this._currentAtlasIndex=i,t.surface.destroy(),t.surface=r._surface,t.x=n.x,t.y=n.y,this._atlasGlyphsTable[i]||(this._atlasGlyphsTable[i]=[]),this._atlasGlyphsTable[i].push(t),r}return null},t.prototype._reallocateAtlas=function(){if(this._surfaceAtlases.length>=this._maxAtlasNum){for(var t=this._removeLeastFrequentlyUsedAtlas(1),e=t.surfaceAtlases[0],i=t.glyphs[0],r=0;r<i.length;r++){var n=i[r];n.surface=null,n.isSurfaceValid=!1,n._atlas=null}e.destroy()}this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.addAtlas=function(){this._surfaceAtlases.length>=this._maxAtlasNum&&this._deleteAtlas(1),this._surfaceAtlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height))},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){if(t.width>this._atlasSize.width||t.height>this._atlasSize.height)return null;var e=this._moveGlyphSurface(t);return e||(this._reallocateAtlas(),e=this._moveGlyphSurface(t)),e},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t}();o.INITIAL_MAX_SURFACEATLAS_NUM=10,t.SurfaceAtlasSet=o}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._reset=function(){this._muted=!1,this._playbackRate=1;var t=this._game.audio;for(var e in t)t.hasOwnProperty(e)&&t[e]._reset()},t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.SourceOver=0]="SourceOver",t[t.SourceAtop=1]="SourceAtop",t[t.Lighter=2]="Lighter",t[t.Copy=3]="Copy",t[t.ExperimentalSourceIn=4]="ExperimentalSourceIn",t[t.ExperimentalSourceOut=5]="ExperimentalSourceOut",t[t.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",t[t.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",t[t.DestinationOut=8]="DestinationOut",t[t.DestinationOver=9]="DestinationOver",t[t.Xor=10]="Xor"}(e=t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,n,o,s,a,h){void 0===r&&(r=i),void 0===n&&(n="black"),void 0===o&&(o=0),void 0===s&&(s="black"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=n,this.strokeWidth=o,this.strokeColor=s,this.strokeOnly=a}return e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.NonLocal=0]="NonLocal",
t[t.FullLocal=1]="FullLocal",t[t.InterpolateLocal=2]="InterpolateLocal"}(e=t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,"number"==typeof e?this.borderWidth={top:e,bottom:e,left:e,right:e}:this.borderWidth=e}return t.prototype.render=function(t,e,i){var r=!0;this._surface&&this._surface.width===e&&this._surface.height===i&&this._beforeSrcSurface===t?r=!1:(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),this._beforeSrcSurface=t);var n=this._surface.renderer();n.begin(),r||n.clear();var o=this.borderWidth.left,s=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,u=e-this.borderWidth.right,l=this.borderWidth.top,d=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:s,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:s,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:u,y:0},{x:0,y:d},{x:u,y:d}],_=0;for(_=0;_<p.length;++_){var g=p[_];n.save(),n.translate(f[_].x,f[_].y),n.drawImage(t,g.x,g.y,g.width,g.height,0,0),n.restore()}var y=[{x:o,y:0,width:s-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:s,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:s-o,height:this.borderWidth.bottom}],m=[{x:c,y:0,width:u-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:d-l},{x:u,y:l,width:this.borderWidth.right,height:d-l},{x:c,y:d,width:u-c,height:this.borderWidth.bottom}];for(_=0;_<y.length;++_){var v=y[_],T=m[_];n.save(),n.translate(T.x,T.y),n.transform([T.width/v.width,0,0,T.height/v.height,0,0]),n.drawImage(t,v.x,v.y,v.width,v.height,0,0),n.restore()}var A=s-o,w=h-a,x=u-c,E=d-l;return n.save(),n.translate(c,l),n.transform([x/A,0,0,E/w,0,0]),n.drawImage(t,o,a,A,w,0,0),n.restore(),n.end(),this._surface},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){var e;!function(e){function i(i,r){function n(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===r)return i;for(var o=e.splitPath(i),s=n(o.path).concat(n(r)),a=[],h=0;h<s.length;++h){var c=s[h];switch(c){case"..":var u=a.pop();if(void 0===u||""===u||"."===u)throw t.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===a.length&&a.push(".");break;case"":a=[""];break;default:a.push(c)}}return o.host+a.join("/")}function r(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)}function n(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,"/"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var n=t.split("/"),o=n.indexOf("node_modules"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if("node_modules"!==n[h]){var c=n.slice(0,h+1);c.push("node_modules");var u=c.join("/");a.push(r+u)}return a}function s(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)}function a(t){var e="",i=t.indexOf("//");if(i>=0){var r=t.indexOf("/",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t="/")}else e="";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=n,e.makeNodeModulePaths=o,e.addExtname=s,e.splitPath=a}(e=t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.SansSerif=0]="SansSerif",t[t.Serif=1]="Serif",t[t.Monospace=2]="Monospace"}(e=t.FontFamily||(t.FontFamily={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.surface=t.Util.asSurface(e.src),this.map=e.map,this.defaultGlyphWidth=e.defaultGlyphWidth,this.defaultGlyphHeight=e.defaultGlyphHeight,this.missingGlyph=e.missingGlyph,this.size=e.defaultGlyphHeight}return e.prototype.glyphForCharacter=function(e){var i=this.map[e]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,n=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,s=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===n?void 0:this.surface;return new t.Glyph(e,i.x,i.y,r,n,o,s,a,h,!0)},e.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},e.prototype.destroyed=function(){return!this.map},e}();t.BitmapFont=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Alphabetic=2]="Alphabetic",t[t.Bottom=3]="Bottom"}(e=t.TextBaseline||(t.TextBaseline={}));var r=function(r){function n(i){var n=r.call(this,i)||this;return n.text=i.text,n.fontSize=i.fontSize,n.textAlign="textAlign"in i?i.textAlign:t.TextAlign.Left,n.textBaseline="textBaseline"in i?i.textBaseline:e.Alphabetic,n.maxWidth=i.maxWidth,n.textColor="textColor"in i?i.textColor:"black",n.fontFamily="fontFamily"in i?i.fontFamily:t.FontFamily.SansSerif,n.strokeWidth="strokeWidth"in i?i.strokeWidth:0,n.strokeColor="strokeColor"in i?i.strokeColor:"black",n.strokeOnly="strokeOnly"in i?i.strokeOnly:!1,n}return i(n,r),n.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},n}(t.E);t.SystemLabel=r}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(e=t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.ByClock=0]="ByClock",t[t.Manual=1]="Manual"}(e=t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){var e=1812433253;t=e*(t^t>>30)+1,this._state0U=t,t=e*(t^t>>30)+2,this._state0L=t,t=e*(t^t>>30)+3,this._state1U=t,t=e*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var n=0,o=0,s=0,a=0,h=23,c=4294967295<<32-h;n=t<<h|(e&c)>>>32-h,o=e<<h,t^=n,e^=o,n=t^i,o=e^r;var u=17,l=4294967295>>>32-u;s=t>>>u,a=e>>>u|(t&l)<<32-u,n^=s,o^=a;var d=26,p=4294967295>>>32-d;s=i>>>d,a=r>>>d|(i&p)<<32-d,n^=s,o^=a,this._state1U=n,this._state1L=o;var f=(o>>>0)+(r>>>0);return s=n+i+(f/2>>>31)>>>0,a=f>>>0,[s,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var n=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return n=e.call(this,i)||this,r?n._xorshift=t.Xorshift.deserialize(r):n._xorshift=new t.Xorshift(i),n}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms}return t}();t.ShaderProgram=e}(t||(t={})),e.exports=t}).call(this)},{}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],4:[function(t,e,i){e.exports=t("./lib/index")},{"./lib/index":27}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){if(0>=t)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var e=this._totalDeltaTime;if(e+=t,e<=this._skipFrameWaitTime)return this._totalDeltaTime=e,this._waitTime-e;for(var i=e<this._waitTimeDoubled?1:e>this._waitTimeMax?this._realMaxFramePerOnce:e/this._waitTime|0,r=i,n={interrupt:!1};r>0&&this.running&&!n.interrupt;)--r,this.frameTrigger.fire(n);return e-=(i-r)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=e,this._waitTime-e},t.prototype._updateWaitTimes=function(e,i){var r=e*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();i.Clock=n},{"@akashic/akashic-engine":1}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(t("@akashic/akashic-pdi"),t("@akashic/akashic-engine")),n=t("./PointEventResolver"),o=function(){function t(t){this._amflow=t.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._defaultEventPriority=0,this._buffer=null,this._joinLeaveBuffer=null,this._localBuffer=null,this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._unfilteredJoinLeaves=[],this._pointEventResolver=new n.PointEventResolver({game:t.game}),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:return t[5];case 1:return t[3];case 2:return t[4];case 32:return t[4];case 33:return t[7];case 34:return t[11];case 35:return t[11];case 64:return t[5];default:throw r.ExceptionFactory.createAssertionError("EventBuffer.isEventLocal")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){return t.isEventLocal(e)?void(this._isLocalReceiver&&!this._isDiscarder&&this._unfilteredLocalEvents.push(e)):(this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._unfilteredJoinLeaves.push(e):this._unfilteredEvents.push(e)),void(this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))))},t.prototype.onPointEvent=function(t){var e;switch(t.type){case 0:e=this._pointEventResolver.pointDown(t);break;case 1:e=this._pointEventResolver.pointMove(t);break;case 2:e=this._pointEventResolver.pointUp(t)}e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;return void(this._localBuffer?this._localBuffer.push(e):this._localBuffer=[e])}this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer?this._joinLeaveBuffer.push(e):this._joinLeaveBuffer=[e]:this._buffer?this._buffer.push(e):this._buffer=[e]),this._isSender&&(null==e[1]&&(e[1]=this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return this._buffer=null,t},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return this._joinLeaveBuffer=null,t},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return this._localBuffer=null,t},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters){if(!t)return void(this._filters=null);for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1)}},t.prototype.processEvents=function(e){var i=this._unfilteredLocalEvents,r=this._unfilteredEvents,n=this._unfilteredJoinLeaves;if(!this._filters)return i.length>0&&(this._unfilteredLocalEvents=[],this._localBuffer=this._localBuffer?this._localBuffer.concat(i):i),!e&&r.length>0&&(this._unfilteredEvents=[],this._buffer=this._buffer?this._buffer.concat(r):r),void(!e&&n.length>0&&(this._unfilteredJoinLeaves=[],this._joinLeaveBuffer=this._joinLeaveBuffer?this._joinLeaveBuffer.concat(n):n));if(0===i.length&&0===r.length&&0===n.length)for(var o=0;o<this._filters.length;++o)if(this._filters[o].handleEmpty){var s=this._filters[o].func([]);if(s)for(var a=0;a<s.length;++a){var h=s[a];t.isEventLocal(h)?i.push(h):0===h[0]||1===h[0]?n.push(h):r.push(h)}}if(i.length>0){this._unfilteredLocalEvents=[];for(var o=0;o<this._filters.length&&(i=this._filters[o].func(i),i);++o);i&&i.length>0&&(this._localBuffer=this._localBuffer?this._localBuffer.concat(i):i)}if(!e&&r.length>0){this._unfilteredEvents=[];for(var o=0;o<this._filters.length&&(r=this._filters[o].func(r),r);++o);r&&r.length>0&&(this._buffer=this._buffer?this._buffer.concat(r):r)}if(!e&&n.length>0){this._unfilteredJoinLeaves=[];for(var o=0;o<this._filters.length&&n&&n.length>0&&(n=this._filters[o].func(n),n);++o);n&&n.length>0&&(this._joinLeaveBuffer=this._joinLeaveBuffer?this._joinLeaveBuffer.concat(n):n)}},t}();i.EventBuffer=o},{"./PointEventResolver":17,"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t){this._game=t.game,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,i,n,o,s,a,h,c,u=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(u){case 0:p={id:d,name:t[3]},this._playerTable[d]=p;var f=void 0;if(t[4]){var _=[],g=[];t[4].map(function(t){_.push(t.readKey),g.push(t.values)}),f=new r.StorageValueStore(_,g)}return new r.JoinEvent(p,f,l);case 1:return delete this._playerTable[p.id],new r.LeaveEvent(p,l);case 2:return c=t[3],new r.TimestampEvent(c,p,l);case 32:return h=t[4],new r.MessageEvent(t[3],p,h,l);case 33:return h=t[7],e=t[3],i=t[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},new r.PointDownEvent(e,n,o,p,h,l);case 34:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointMoveEvent(e,n,o,a,s,p,h,l);case 35:return h=t[11],e=t[3],i=t[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:t[4],y:t[5]},s={x:t[6],y:t[7]},a={x:t[8],y:t[9]},new r.PointUpEvent(e,n,o,a,s,p,h,l);case 64:h=t[5];var y=t[3],m=t[4],v=this._game._decodeOperationPluginOperation(y,m);return new r.OperationEvent(y,v,p,h,l);default:throw r.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},t.prototype.toPlaylogEvent=function(t,e){var i,n;switch(t.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+r.EventType[t.type]);case r.EventType.Timestamp:var o=t;return n=e?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=t;return i=s.target?s.target.id:null,n=e?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=t;return i=a.target?a.target.id:null,n=e?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var h=t;return i=h.target?h.target.id:null,n=e?h.player.id:this._game.player.id,[35,h.priority,n,h.pointerId,h.point.x,h.point.y,h.startDelta.x,h.startDelta.y,h.prevDelta.x,h.prevDelta.y,i,!!h.local];case r.EventType.Message:var c=t;return n=e?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var u=t;return n=e?u.player.id:this._game.player.id,[64,u.priority,n,u.code,u.data,!!u.local];default:throw r.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._game.player.id,i=null!=t.priority?t.priority:0;return[64,i,e,t._code,t.data,!!t.local]},t}();i.EventConverter=n},{"@akashic/akashic-engine":1}],8:[function(t,e,i){arguments[4][3][0].apply(i,arguments)},{dup:3}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.Active=0]="Active",t[t.Passive=1]="Passive"}(r||(r={})),i["default"]=r},{}],10:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e){var i=t.call(this,e.configuration,e.resourceFactory,e.assetBase,e.player.id,e.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.targetTimeReachedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=e.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!e.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._notifiesTargetTimeReached=!1,i._isSkipAware=!1,i._gameArgs=e.gameArgs,i._globalGameArgs=e.globalGameArgs,i.skippingChangedTrigger.add(i._onSkippingChanged,i),i}return r(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return this._notifyPassedAgeTable[t]?(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0):!1},e.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},e.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},e.prototype.setStorageFunc=function(t){this.storage._registerLoad(t.storageGetFunc),this.storage._registerWrite(t.storagePutFunc),this.storage.requestValuesForJoinPlayer=t.requestValuesForJoinFunc},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype.getCurrentTime=function(){return this._getCurrentTimeFunc()},e.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},e.prototype.raiseTick=function(t){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError("Game#raiseTick(): tickGenerationMode for the current scene is not Manual.");this.raiseTickTrigger.fire(t)},e.prototype.addEventFilter=function(t,e){this._eventFilterFuncs.addFilter(t,e)},e.prototype.removeEventFilter=function(t){this._eventFilterFuncs.removeFilter(t)},e.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},e.prototype.saveSnapshot=function(t,e){void 0===e&&(e=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:e,data:{randGenSer:this.random[0].serialize(),gameSnapshot:t}})},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.raiseEventTrigger.destroy(),this.raiseEventTrigger=null,this.raiseTickTrigger.destroy(),this.raiseTickTrigger=null,this.snapshotTrigger.destroy(),this.snapshotTrigger=null,this.isSnapshotSaver=!1,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;if(this._eventFilterFuncs.removeFilter(),null!=e.seed){var i=new n.XorshiftRandomGenerator(e.seed);this._reset({age:t.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,e.randGenSer);this._reset({age:t.frame,randGen:i}),this._loadAndStart({snapshot:e.gameSnapshot})}},e.prototype._leaveGame=function(){},e.prototype._terminateGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.skippingChanged.fire(t)},e}(n.Game);i.Game=o},{"@akashic/akashic-engine":1}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("es6-promise"),n=t("@akashic/akashic-engine"),o=t("./ExecutionMode"),s=t("./Game"),a=t("./EventBuffer"),h=t("./GameLoop"),c=t("./PdiUtil"),u=function(){function t(t){this.errorTrigger=new n.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=t.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(t.platform),this._player=t.player,this._rendererRequirement=null,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1}return t.prototype.initialize=function(t,e){this.doInitialize(t).then(function(){e()},e)},t.prototype.changeState=function(t,e){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(t,function(t){return t?void e(t):(r&&i._gameLoop.start(),void e())})},t.prototype.startGame=function(){return this._gameLoop?void this._gameLoop.start():void this.errorTrigger.fire(new Error("Not initialized"))},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){this._gameLoop.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,i){i=i?i:this._rendererRequirement?this._rendererRequirement.rendererCandidates:null;var r=this._game,n=this._platform,o=n.getPrimarySurface();r.renderers=r.renderers.filter(function(t){return t!==o.renderer()}),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:i},r.renderers.push(n.getPrimarySurface().renderer()),r.width=t,r.height=e,r.resized.fire({width:t,height:e}),r.modified=!0},t.prototype.doInitialize=function(t){var e=this,i=new r.Promise(function(i,r){return e._gameLoop&&e._gameLoop.running?r(new Error("Game is running. Must be stopped.")):(e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),void i())}).then(function(){return e._doSetDriverConfiguration(t.driverConfiguration)});return t.configurationUrl?i.then(function(){return e._loadConfiguration(t.configurationUrl,t.assetBase,t.configurationBase)}).then(function(i){return e._createGame(i,e._player,t)}):i},t.prototype.destroy=function(){var t=this;return new r.Promise(function(e,i){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=null,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,e()})},t.prototype._doSetDriverConfiguration=function(t){var e=this;if(null==t)return r.Promise.resolve();void 0===t.playId&&(t.playId=this._playId),void 0===t.playToken&&(t.playToken=this._playToken),void 0===t.eventBufferMode&&(t.executionMode===o["default"].Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===o["default"].Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==t.playId&&(i=i.then(function(){return e._doOpenAmflow(t.playId)})),this._playToken!==t.playToken&&(i=i.then(function(){return e._doAuthenticate(t.playToken)})),i.then(function(){return new r.Promise(function(i,r){null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(t.eventBufferMode.defaultEventPriority=e._permission.maxEventPriority),e._eventBuffer&&e._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&e._gameLoop&&e._gameLoop.setExecutionMode(t.executionMode),i()})})},t.prototype._doCloseAmflow=function(){var t=this;return new r.Promise(function(e,i){return t._openedAmflow?void t._platform.amflow.close(function(r){return t._openedAmflow=!1,r?i(r):void e()}):e()})},t.prototype._doOpenAmflow=function(t){var e=this;if(void 0===t)return r.Promise.resolve();var i=this._doCloseAmflow();return i.then(function(){return new r.Promise(function(i,r){return null===t?i():void e._platform.amflow.open(t,function(n){return n?r(n):(e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),void i())})})})},t.prototype._doAuthenticate=function(t){var e=this;return null==t?r.Promise.resolve():new r.Promise(function(i,r){e._platform.amflow.authenticate(t,function(n,o){return n?r(n):(e._playToken=t,e._permission=o,e._game&&(e._game.isSnapshotSaver=e._permission.writeTick),void i())})})},t.prototype._loadConfiguration=function(t,e,i){var n=this;return new r.Promise(function(r,o){n._loadConfigurationFunc(t,e,i,function(t,e){return t?o(t):(n.configurationLoadedTrigger.fire(e),void r(e))})})},t.prototype._putZerothStartPoint=function(t){var e=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,function(t){return t?r(t):void i()})})},t.prototype._getZerothStartPointData=function(){var t=this;return new r.Promise(function(e,i){t._platform.amflow.getStartPoint({frame:0},function(t,r){if(t)return i(t);var n=r.data;return"number"!=typeof n.seed?i(new Error("GameDriver#_getRandomSeed: No seed found.")):void e(n)})})},t.prototype._createGame=function(t,e,i){var c,u=this,l=i.driverConfiguration.executionMode===o["default"].Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:t.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return u._getZerothStartPointData()}),c.then(function(r){var c=u._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o["default"].Active},d=r.seed,p=i.gameArgs,f=r.globalArgs,_=r.startedAt,g={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(g);var y=new s.Game({configuration:t,player:e,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:u._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:p,globalGameArgs:f}),m=new a.EventBuffer({game:y,amflow:c.amflow});m.setMode(l.eventBufferMode),c.setPlatformEventHandler(m),y.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),y.renderers.push(c.getPrimarySurface().renderer());var v=new h.GameLoop({game:y,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:m,configuration:i.loopConfiguration,startedAt:_,profiler:i.profiler});v.rawTargetTimeReachedTrigger.add(y._onRawTargetTimeReached,y),y.setCurrentTimeFunc(v.getCurrentTime.bind(v)),y._reset({age:0,randGen:new n.XorshiftRandomGenerator(d)}),u._updateGamePlayId(y),u._hidden&&y._setMuted(!0),y.snapshotTrigger.add(function(t){u._platform.amflow.putStartPoint(t,function(t){t&&u.errorTrigger.fire(t)})}),u._game=y,u._eventBuffer=m,u._gameLoop=v,u._rendererRequirement=g,u.gameCreatedTrigger.fire(y),u._game._loadAndStart({args:i.gameArgs||void 0})})},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._platform.sendToExternal(e._playId,t)}},t}();i.GameDriver=u},{"./EventBuffer":6,"./ExecutionMode":9,"./Game":10,"./GameLoop":12,"./PdiUtil":16,"@akashic/akashic-engine":1,"es6-promise":78}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./constants"),o=t("./LoopMode"),s=t("./LoopRenderMode"),a=t("./ExecutionMode"),h=t("./Clock"),c=t("./ProfilerClock"),u=t("./EventConverter"),l=t("./TickController"),d=function(){function t(t){this.errorTrigger=new r.Trigger,this.rawTargetTimeReachedTrigger=new r.Trigger,this.running=!1,this._currentTime=t.startedAt,this._frameTime=1e3/t.game.fps,this._omittedTickDuration=0,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||n.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||n.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||n.DEFAULT_SKIP_THRESHOLD,this._jumpTryThreshold=e.jumpTryThreshold||n.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||n.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||n.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var i=null!=e.loopRenderMode?e.loopRenderMode:s["default"].AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=!!e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,
this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=e.targetAge?e.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new c.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new h.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new l.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new u.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(i),this._game.setIsSkipAware(null!=e.skipAwareGame?e.skipAwareGame:!0),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game._started.add(this._onGameStarted,this),this._game._operationPluginOperated.add(this._onGameOperationPluginOperated,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:this._targetAge}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGamePlaybackRate=function(){var t=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(t)},t.prototype._handleSceneChange=function(){var t=this._game.scene(),e=t?t.local:r.LocalTickMode.FullLocal,i=t?t.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==e||this._sceneTickMode!==i)switch(this._sceneLocalMode=e,this._sceneTickMode=i,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,e)for(var i=0,r=e.length;r>i;++i)t.events.push(this._eventConverter.toGameEvent(e[i]));var n=t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime));this._omittedTickDuration=0,n&&this._handleSceneChange()},t.prototype._onFrame=function(t){if(this._loopMode===o["default"].Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),i=e+this._realTargetTimeOffset,r=this._currentTime;this._onFrameForTimedReplay(i,t),r===this._currentTime&&i>=r&&i<=r+this._frameTime&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var i=!1,n=this._game,o=t-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||0>s)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),0>=s)return void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===this._tickBuffer.currentAge)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var a=0;a<this._skipTicksAtOnce;++a){if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._omitInterpolatedTickOnReplay&&this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();break}var h=this._currentTime+this._frameTime,c=this._tickBuffer.readNextTickTime();if(null==c&&(c=h),h>t){if(!(t>=c))break;h=t}else if(c>h){if(!this._omitInterpolatedTickOnReplay||!this._skipping){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}if(c>=t){this._omittedTickDuration+=t-this._currentTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}h=c,this._omittedTickDuration+=c-this._currentTime}this._currentTime=h;var u=this._tickBuffer.consume(),l=-1,d=this._eventBuffer.readLocalEvents();if(d)for(var p=0,f=d.length;f>p;++p)n.events.push(this._eventConverter.toGameEvent(d[p]));if("number"==typeof u)l=u,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{l=u[0];var _=u[1];if(_)for(var p=0,f=_.length;f>p;++p)n.events.push(this._eventConverter.toGameEvent(_[p]));i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[l]&&n.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(i){this._handleSceneChange();break}}this._skipping&&t-this._currentTime<this._frameTime&&this._stopSkipping()},t.prototype._onFrameNormal=function(t){var e=!1,i=this._game;if(this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var n,s,a=this._tickBuffer.currentAge;if(this._loopMode===o["default"].Realtime?(n=this._tickBuffer.knownLatestAge+1,s=n-a):null===this._targetAge?(n=null,s=1):this._targetAge===a?(n=this._targetAge=null,s=1):(n=this._targetAge,s=n-a),(s>this._jumpTryThreshold||0>s)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=n,this._amflow.getStartPoint({frame:n},this._onGotStartPoint_bound)),0>=s)return 0===s&&(0===a&&this._tickBuffer.requestTicks(),this._startWaitingNextTick()),this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()&&this._startSkipping();for(var h=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;h>c;++c){var u=this._currentTime+this._frameTime,l=this._tickBuffer.readNextTickTime();if(null!=l&&l>u){if(!(this._loopMode===o["default"].Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}u=Math.ceil(l/this._frameTime)*this._frameTime,this._omittedTickDuration+=u-this._currentTime}this._currentTime=u;var d=this._tickBuffer.consume(),p=-1;if(null==d){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,g=f.length;g>_;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if("number"==typeof d)p=d,e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime));else{p=d[0];var y=d[1];if(y)for(var m=0,g=y.length;g>m;++m)i.events.push(this._eventConverter.toGameEvent(y[m]));e=i.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime))}if(this._omittedTickDuration=0,i._notifyPassedAgeTable[p]&&i.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(e){this._handleSceneChange();break}}this._skipping&&n-this._tickBuffer.currentAge<1&&this._stopSkipping()},t.prototype._onGotNextFrameTick=function(){this._waitingNextTick&&this._loopMode!==o["default"].FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)return void this.errorTrigger.fire(t);if(this._targetTimeFunc&&this._loopMode!==o["default"].Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<e.timestamp)return;var r=this._currentTime;if(i>=r&&e.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===o["default"].Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var s=this._tickBuffer.currentAge;if(n>=s&&e.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(e.frame),this._currentTime=e.timestamp||e.data.timestamp||0,this._waitingNextTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(e),this._handleSceneChange()},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents(this._sceneLocalMode===r.LocalTickMode.FullLocal)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case s["default"].AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case s["default"].None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+t))}},t.prototype._renderOnRawFrame=function(){var t=this._game;t.modified&&t.scenes.length>0&&t.render()},t.prototype._onGameRaiseEvent=function(t){var e=this._eventConverter.toPlaylogEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===a["default"].Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(t[e]));this._tickController.forceGenerateTick()}},t.prototype._onGameOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this._eventBuffer.onEvent(e)},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t}();i.GameLoop=d},{"./Clock":5,"./EventConverter":7,"./ExecutionMode":9,"./LoopMode":14,"./LoopRenderMode":15,"./ProfilerClock":18,"./TickController":21,"./constants":26,"@akashic/akashic-engine":1}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t,e,i,r){this.joinResolver=e,this.pev=t,0===t[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return t.prototype._onGotStorageData=function(t,e){return this.resolved=!0,t?void this.joinResolver.errorTrigger.fire(t):void(this.pev[4]=e)},t}();i.JoinLeaveRequest=n;var o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._keysForJoin=null,this._requested=[]}return t.prototype.request=function(t){this._requested.push(new n(t,this,this._amflow,this._keysForJoin))},t.prototype.readResolved=function(){var t=this._requested.length;if(0===t||!this._requested[0].resolved)return null;for(var e=[],i=0;t>i;++i){var r=this._requested[i];if(!r.resolved)break;e.push(r.pev)}return this._requested.splice(0,i),e},t.prototype.setRequestValuesForJoin=function(t){this._keysForJoin=t},t}();i.JoinResolver=o},{"@akashic/akashic-engine":1}],14:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.Realtime=0]="Realtime",t[t.Replay=1]="Replay",t[t.FrameByFrame=2]="FrameByFrame"}(r||(r={})),i["default"]=r},{}],15:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){t[t.AfterRawFrame=0]="AfterRawFrame",t[t.None=1]="None"}(r||(r={})),i["default"]=r},{}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=t("es6-promise"),o=t("@akashic/akashic-engine");!function(t){function e(e){function i(i,s,a,h){e.loadGameConfiguration(i,function(e,c){if(e)return void h(e,null);try{c=t._resolveConfigurationBasePath(c,null!=s?s:o.PathUtil.resolveDirname(i))}catch(u){return void h(u,null)}if(!c.definitions)return void h(null,c);var l=c.definitions.map(function(t){if("string"==typeof t){var e=null!=a?o.PathUtil.resolvePath(a,t):t;return r(e,void 0,a)}var e=null!=a?o.PathUtil.resolvePath(a,t.url):t.url;return r(e,t.basePath,a)});n.Promise.all(l).then(function(e){return h(null,e.reduce(t._mergeGameConfiguration))})["catch"](function(t){return h(t,null)})})}function r(t,e,r){return new n.Promise(function(n,o){i(t,e,r,function(t,e){t?o(t):n(e)})})}return i}function i(t,e){function i(t,e){var i=o.PathUtil.resolvePath(t,e);if(0!==i.indexOf(t))throw o.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: invalid path: "+e);return i}var r=t.assets;if(r instanceof Object)for(var n in r)r.hasOwnProperty(n)&&"path"in r[n]&&(r[n].virtualPath=r[n].virtualPath||r[n].path,r[n].path=i(e,r[n].path));return t.globalScripts&&(t.globalScripts.forEach(function(t){if(r.hasOwnProperty(t))throw o.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: asset ID already exists: "+t);r[t]={type:/\.json$/i.test(t)?"text":"script",virtualPath:t,path:i(e,t),global:!0}}),delete t.globalScripts),t}function r(e,i){for(var r=Object.keys(i),n=0,o=r.length;o>n;++n){var s=r[n],a=i[s],h=typeof a,c=typeof e[s];if(h===c)switch(typeof a){case"string":case"number":case"boolean":e[s]=a;break;case"object":null==a?e[s]=a:Array.isArray(a)?e[s]=e[s].concat(a):t._mergeObject(e[s],a);break;default:throw new Error("PdiUtil._mergeObject(): unknown type")}else e[s]=a}return e}function s(e,i){return t._mergeObject(e,i)}t.makeLoadConfigurationFunc=e,t._resolveConfigurationBasePath=i,t._mergeObject=r,t._mergeGameConfiguration=s}(r=i.PdiUtil||(i.PdiUtil={}))},{"@akashic/akashic-engine":1,"es6-promise":78}],17:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._game=t.game,this._pointEventMap={}}return t.prototype.pointDown=function(t){var e=this._game.player,i=this._game.findPointSource(t.offset),r=i.point?i.point:t.offset,n=i.target?i.target.id:null;this._pointEventMap[t.identifier]={targetId:n,local:i.local,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}};var o=[33,2,e.id,t.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},t.prototype.pointMove=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n);var o=[34,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype.pointUp=function(t){var e=this._game.player,i=this._pointEventMap[t.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,t.offset,r,n),delete this._pointEventMap[t.identifier];var o=[35,2,e.id,t.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},t.prototype._pointMoveAndUp=function(t,e,i,r){r.x=e.x-t.start.x,r.y=e.y-t.start.y,i.x=e.x-t.prev.x,i.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();i.PointEventResolver=r},{}],18:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Clock"),o=function(t){function e(e){var i=t.call(this,e)||this;return i._profiler=e.profiler,i}return r(e,t),e.prototype._onLooperCall=function(t){if(0>=t)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var e=this._totalDeltaTime;if(e+=t,e<=this._skipFrameWaitTime)return this._totalDeltaTime=e,this._waitTime-e;this._profiler.timeEnd(1),this._profiler.time(1);var i=e<this._waitTimeDoubled?1:e>this._waitTimeMax?this._realMaxFramePerOnce:e/this._waitTime|0,r=i,n={interrupt:!1};for(this._profiler.setValue(0,r-1);r>0&&this.running&&!n.interrupt;)--r,this._profiler.time(2),this.frameTrigger.fire(n),this._profiler.timeEnd(2);return e-=(i-r)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=e,this._profiler.flush(),this._waitTime-e},e}(n.Clock);i.ProfilerClock=o},{"./Clock":5}],19:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./ExecutionMode"),o=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=t.game,this._amflow=t.amflow,this._tickGenerator=t.tickGenerator,this._tickBuffer=t.tickBuffer,this._executionMode=null,this.setExecutionMode(t.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return t.prototype.setExecutionMode=function(t){if(this._executionMode!==t){this._executionMode=t;var e=this._tickBuffer,i=this._tickGenerator;t===n["default"].Active?(e.gotStorageTrigger.remove(this._onGotStorageOnTick,this),i.gotStorageTrigger.add(this._onGotStorageOnTick,this)):(i.gotStorageTrigger.remove(this._onGotStorageOnTick,this),e.gotStorageTrigger.add(this._onGotStorageOnTick,this))}},t.prototype._onGotStorageOnTick=function(t){var e=t.age,i=t.storageData,r=this._unresolvedLoaders[e];if(!r)return void(this._unresolvedStorages[e]=i);delete this._unresolvedLoaders[e];var n=e,o=i.map(function(t){return t.values});r._onLoaded(o,n)},t.prototype._getStorage=function(t,e,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n["default"].Active?r=this._tickGenerator.requestStorageTick(t):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=e);delete this._unresolvedStorages[r];var s=r,a=o.map(function(t){return t.values});e._onLoaded(a,s)},t.prototype._putStorage=function(t,e,i){this._executionMode===n["default"].Active&&this._amflow.putStorageData(t,e,i,this._onStoragePut_bound)},t.prototype._requestValuesForJoin=function(t){this._tickGenerator.setRequestValuesForJoin(t)},t.prototype._onStoragePut=function(t){t&&this.errorTrigger.fire(t)},t}();i.StorageResolver=o},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],20:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./ExecutionMode"),o=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var i=e.ticks[0];if(i[0]!==t)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0]){var o=r[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===n["default"].Passive&&this._amflow.getTickList(t,t+e,this._onTicks_bound)},t.prototype.addTick=function(t){var e=t[0],i=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e),t[2]&&this.gotStorageTrigger.fire({age:t[0],storageData:t[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(e>=n.start)break}var o=this._tickRanges[r+1];if(0>r)this._tickRanges.unshift(this._createTickRangeFromTick(t));else{var n=this._tickRanges[r];e===n.end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(t))}this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],i=t[1]+1,r=t[2],n=e,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;a>s;++s){var h=this._tickRanges[s];if(e<h.start)break}var c=s;if(s>0){--s;var u=this._tickRanges[s].end;u>e&&(e=u)}for(;a>s;++s){var l=this._tickRanges[s];if(i<=l.end)break}if(a>s){var d=this._tickRanges[s].start;i>d&&(i=d)}if(e>=i)return{start:e,end:e,ticks:[]};r||(r=[]),(n!==e||o!==i)&&(r=r.filter(function(t){var r=t[0];return r>=e&&i>r}));for(var p=0;p<r.length;++p){var f=r[p];f[2]&&this.gotStorageTrigger.fire({age:f[0],storageData:f[2]})}var _={start:e,end:i,ticks:r},g=Math.max(0,s-c);return this._tickRanges.splice(c,g,_),e<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),_},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n["default"].Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw new Error;if(e){var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(e);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire()}},t.prototype._findNearestAbscentAge=function(t){for(var e=0,i=this._tickRanges.length;i>e&&!(t<=this._tickRanges[e].end);++e);for(;i>e;++e){var r=this._tickRanges[e];if(t<r.start)break;t=r.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(t<i.start)){for(i.start=t,e=0;e<i.ticks.length&&!(t<=i.ticks[e][0]);++e);i.ticks=i.ticks.slice(e)}}},t.prototype._createTickRangeFromTick=function(t){var e=t[0],i={start:e,end:e+1,ticks:[]};return t[1]&&i.ticks.push(t),i},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();i.TickBuffer=o},{"./ExecutionMode":9,"@akashic/akashic-engine":1}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./ExecutionMode"),o=t("./TickBuffer"),s=t("./TickGenerator"),a=t("./StorageResolver"),h=function(){function t(t){this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new s.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._storageResolver=new a.StorageResolver({game:t.game,amflow:t.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t),this._storageResolver.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===n["default"].Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();i.TickController=h},{"./ExecutionMode":9,"./StorageResolver":19,"./TickBuffer":20,"./TickGenerator":22,"@akashic/akashic-engine":1}],22:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./JoinResolver"),o=function(){function t(t){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._eventBuffer=t.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:t.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return t.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var t=this._eventBuffer.readJoinLeaves();if(t)for(var e=0;e<t.length;++e)this._joinResolver.request(t[e]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},t.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage."));var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){return this._waitingStorage?void this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage.")):void(this._nextAge=t)},t.prototype.requestStorageTick=function(t){if(this._waitingStorage){var e=r.ExceptionFactory.createAssertionError("TickGenerator#requestStorageTick(): Unsupported: multiple storage request");return this.errorTrigger.fire(e),-1}return this._waitingStorage=!0,this._amflow.getStorageData(t,this._onGotStorageData_bound),this._nextAge},t.prototype.setRequestValuesForJoin=function(t){this._joinResolver.setRequestValuesForJoin(t)},t.prototype._onGotStorageData=function(t,e){return this._waitingStorage=!1,t?void this.errorTrigger.fire(t):(this._storageDataForNext=e,void this.gotStorageTrigger.fire({age:this._nextAge,storageData:e}))},t}();i.TickGenerator=o},{"./JoinResolver":13,"@akashic/akashic-engine":1}],23:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error("Implementation not given");
},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,t.startPoints?(this._tickList=t.tickList,this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var i=this;setTimeout(function(){return t!==i._playId?void e(new Error("MemoryAmflowClient#open: unknown playId")):void e()},0)},t.prototype.close=function(t){setTimeout(function(){t()},0)},t.prototype.authenticate=function(e,i){setTimeout(function(){switch(e){case t.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},t.prototype.sendTick=function(t){if(this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];(t[1]||t[2])&&this._tickList[2].push(t),this._tickHandlers.forEach(function(e){return e(t)})},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter(function(e){return e!==t})},t.prototype.sendEvent=function(t){return 0===this._eventHandlers.length?void this._events.push(t):void this._eventHandlers.forEach(function(e){return e(t)})},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach(function(t){e._eventHandlers.forEach(function(e){return e(t)})}),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter(function(e){return e!==t})},t.prototype.getTickList=function(t,e,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);t=Math.max(t,this._tickList[0]),e=Math.min(e,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return r>=t&&e>=r}),n=[t,e,r];setTimeout(function(){return i(null,n)},0)},t.prototype.putStartPoint=function(t,e){var i=this;setTimeout(function(){i._startPoints.push(t),e(null)},0)},t.prototype.getStartPoint=function(t,e){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void e(new Error("no startpoint"));var r=0;if(null!=t.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=t.frame&&s>n&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var h=i._startPoints[o].timestamp;h<=t.timestamp&&h>a&&(a=h,r=o)}e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(t,e,i),r(null)}catch(o){r(o)}},0)},t.prototype.getStorageData=function(t,e){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(t);e(null,r)}catch(n){e(n)}},0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1];e>=t?(this._tickList=null,this._startPoints=[]):i>=t&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return r>=e&&t-1>=r}),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.TOKEN_ACTIVE="mamfc-token:active",t.TOKEN_PASSIVE="mamfc-token:passive",t}();i.MemoryAmflowClient=r},{}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],i=this._tickList[1],r=this._tickList[2];e>=t?(this._tickList=null,this._startPoints=[]):i>=t&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(r,i,t-1),this._startPoints=this._startPoints.filter(function(e){return e.frame<t}))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(t,e,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=t>=n&&o>=t,h=e>=n&&o>=e;a&&h?setTimeout(function(){i(null,[t,e,r._sliceTicks(s,t,e)])},0):this._amflow.getTickList(t,e,function(c,u){if(c)return void i(c);if(u)if(a||h)if(a){var l=r._sliceTicks(s,t,e).concat(u[2]||[]);i(null,[t,u[1],l])}else{var l=(u[2]||[]).concat(r._sliceTicks(s,t,e));i(null,[u[0],e,l])}else if(n>e||t>o)i(null,u);else{var l=u[2];if(l){var d=r._sliceTicks(l,t,n-1),p=r._sliceTicks(l,o+1,e);l=d.concat(s,p)}else l=s;i(null,[t,e,l])}else a||h?a?i(null,[t,o,r._sliceTicks(s,t,e)]):i(null,[n,e,r._sliceTicks(s,t,e)]):n>e||t>o?i(null,u):i(null,[n,o,r._sliceTicks(s,t,e)])})},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var i=this,r=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&s>n&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&h>a&&(a=h,r=o)}var c=this._tickList?this._tickList[1]:-1;t.frame>c?this._amflow.getStartPoint(t,function(t,n){return t?void e(t):void(c<n.frame?e(null,n):e(null,i._startPoints[r]))}):setTimeout(function(){e(null,i._startPoints[r])},0)},t.prototype.putStorageData=function(t,e,i,r){this._amflow.putStorageData(t,e,i,r)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,i){return t.filter(function(t){var r=t[0];return r>=e&&i>=r})},t}();i.ReplayAmflowProxy=r},{}],25:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(e){this._interval=null!=e.interval?e.interval:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),i=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:i})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var i=this._getCurrentTime()-e,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(n>0&&this._values[t][a].time<i);--a){var h=this._values[t][a].value;h>o&&(o=h),s>h&&(s=h),r+=h,++n}return{ave:r/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();i.SimpleProfiler=n},{"@akashic/akashic-engine":1}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4},{}],27:[function(t,e,i){"use strict";function r(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}Object.defineProperty(i,"__esModule",{value:!0}),r(t("./constants"));var n=t("./EventIndex");i.EventIndex=n;var o=t("./LoopMode");i.LoopMode=o["default"];var s=t("./LoopRenderMode");i.LoopRenderMode=s["default"];var a=t("./ExecutionMode");i.ExecutionMode=a["default"];var h=t("./GameDriver");i.GameDriver=h.GameDriver;var c=t("./Game");i.Game=c.Game;var u=t("./auxiliary/ReplayAmflowProxy");i.ReplayAmflowProxy=u.ReplayAmflowProxy;var l=t("./auxiliary/MemoryAmflowClient");i.MemoryAmflowClient=l.MemoryAmflowClient;var d=t("./auxiliary/SimpleProfiler");i.SimpleProfiler=d.SimpleProfiler},{"./EventIndex":8,"./ExecutionMode":9,"./Game":10,"./GameDriver":11,"./LoopMode":14,"./LoopRenderMode":15,"./auxiliary/MemoryAmflowClient":23,"./auxiliary/ReplayAmflowProxy":24,"./auxiliary/SimpleProfiler":25,"./constants":26}],28:[function(t,e,i){e.exports=t("./lib/full/index")},{"./lib/full/index":61}],29:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();i.AudioManager=r},{}],30:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./InputHandlerLayer"),o=function(){function t(t){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.useResizeForScaling=!1,this.pointEventTrigger=new r.Trigger,this._rendererReq=null,this._disablePreventDefault=!1,this.resourceFactory=t}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},t.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},t.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){var t=this._rendererReq,e=t.primarySurfaceWidth,i=t.primarySurfaceHeight,r=this._disablePreventDefault;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:e,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy()):this.inputHandlerLayer=new n.InputHandlerLayer({width:e,height:i,disablePreventDefault:r}),this.surface=this.resourceFactory.createPrimarySurface(e,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},t.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},t}();i.ContainerController=o},{"./InputHandlerLayer":31,"@akashic/akashic-engine":1}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./handler/TouchHandler"),o=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new r.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;this._inputHandler=new n.TouchHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.add(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler&&this._inputHandler.stop()},t.prototype.setOffset=function(t){var e="position:relative; left:"+t.x+"px; top:"+t.y+"px";this._inputHandler.inputView.setAttribute("style",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},t.prototype._createInputView=function(t,e){var i=document.createElement("div");return i.setAttribute("tabindex","1"),i.className="input-handler",i.setAttribute("style","display:inline-block; outline:none;"),i.style.width=t+"px",i.style.height=e+"px",i},t}();i.InputHandlerLayer=o},{"./handler/TouchHandler":60,"@akashic/akashic-engine":1}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./RafLooper"),n=t("./ResourceFactory"),o=t("./ContainerController"),s=t("./plugin/AudioPluginManager"),a=t("./AudioManager"),h=t("./plugin/AudioPluginRegistry"),c=t("./asset/XHRTextAsset"),u=function(){function t(t){this.containerView=t.containerView,this.audioPluginManager=new s.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(h.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new a.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new n.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new o.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var i=new c.XHRTextAsset("(game.json)",t);i._load({_onAssetLoad:function(t){e(null,JSON.parse(i.data))},_onAssetError:function(t,i){e(i,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());if(this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController&&!this.containerController.inputHandlerLayer)this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler);else{var e=this.getPrimarySurface();e&&!e.destroyed()&&e.destroy(),this.containerController.resetView(t)}},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new r.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.notifyViewMoved=function(){},t.prototype.setMasterVolume=function(t){this._audioManager&&this._audioManager.setMasterVolume(t)},t.prototype.getMasterVolume=function(){return this._audioManager?this._audioManager.getMasterVolume():void 0},t}();i.Platform=u},{"./AudioManager":29,"./ContainerController":30,"./RafLooper":33,"./ResourceFactory":34,"./asset/XHRTextAsset":39,"./plugin/AudioPluginManager":62,"./plugin/AudioPluginRegistry":63}],33:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(i){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(i-t._prev),t._prev=i)},i=function(i){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=i};this._timerId=requestAnimationFrame(i)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();i.RafLooper=r},{}],34:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./asset/HTMLImageAsset"),s=t("./asset/HTMLVideoAsset"),a=t("./asset/XHRTextAsset"),h=t("./asset/XHRScriptAsset"),c=t("./canvas/GlyphFactory"),u=t("./canvas/shims/SurfaceFactory"),l=function(t){function e(e){var i=t.call(this)||this;return i._audioPluginManager=e.audioPluginManager,i._audioManager=e.audioManager,i._platform=e.platform,i._surfaceFactory=new u.SurfaceFactory,i}return r(e,t),e.prototype.createAudioAsset=function(t,e,i,r,n,o){var s=this._audioPluginManager.getActivePlugin(),a=s.createAsset(t,e,i,r,n,o);return a.onDestroyed&&(this._audioManager.registerAudioAsset(a),a.onDestroyed.add(this._onAudioAssetDestroyed,this)),a},e.prototype.createAudioPlayer=function(t){var e=this._audioPluginManager.getActivePlugin();return e.createPlayer(t,this._audioManager)},e.prototype.createImageAsset=function(t,e,i,r){return new o.HTMLImageAsset(t,e,i,r)},e.prototype.createVideoAsset=function(t,e,i,r,n,o,a){return new s.HTMLVideoAsset(t,e,i,r,n,o,a)},e.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new h.XHRScriptAsset(t,e)},e.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},e.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,i,r,n,o,s,a){return new c.GlyphFactory(t,e,i,r,n,o,s,a)},e.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},e}(n.ResourceFactory);i.ResourceFactory=l},{"./asset/HTMLImageAsset":35,"./asset/HTMLVideoAsset":36,"./asset/XHRScriptAsset":38,"./asset/XHRTextAsset":39,"./canvas/GlyphFactory":41,"./canvas/shims/SurfaceFactory":45,"@akashic/akashic-engine":1}],35:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError("ImageAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(n.Surface);i.ImageAssetSurface=o;var s=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o.data=void 0,o._surface=void 0,o}return r(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,i=new Image;this.hint&&this.hint.untainted&&(i.crossOrigin="anonymous"),i.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},i.onload=function(){e.data=i,t._onAssetLoad(e)},i.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw n.ExceptionFactory.createAssertionError("ImageAssetImpl#asSurface: not yet loaded.");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(n.ImageAsset);i.HTMLImageAsset=s},{"@akashic/akashic-engine":1}],36:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./HTMLVideoPlayer"),s=function(t){function e(e,i,r){return t.call(this,e,i,r,!0)||this}return r(e,t),e.prototype.renderer=function(){throw n.ExceptionFactory.createAssertionError("VideoAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(n.Surface),a=function(t){function e(e,i,r,n,a,h,c){var u=t.call(this,e,i,r,n,a,h,c)||this;return u._player=new o.HTMLVideoPlayer,u._surface=new s(r,n,null),u}return r(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(n.VideoAsset);i.HTMLVideoAsset=a},{"./HTMLVideoPlayer":37,"@akashic/akashic-engine":1}],37:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e){var i=t.call(this,e)||this;return i.isDummy=!0,i}return r(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(n.VideoPlayer);i.HTMLVideoPlayer=o},{"@akashic/akashic-engine":1}],38:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("../utils/XHRLoader"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.script=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this,i=new o.XHRLoader;i.get(this.path,function(i,r){return i?void t._onAssetError(e,i):(e.script=r+"\n",void t._onAssetLoad(e))})},e.prototype.execute=function(t){var e=this._wrap();return e(t),t.module.exports},e.prototype._wrap=function(){var t=new Function("g",e.PRE_SCRIPT+this.script+e.POST_SCRIPT);return t},e.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",e.POST_SCRIPT="\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",e}(n.ScriptAsset);i.XHRScriptAsset=s},{"../utils/XHRLoader":77,"@akashic/akashic-engine":1}],39:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("../utils/XHRLoader"),s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return r(e,t),e.prototype._load=function(t){var e=this,i=new o.XHRLoader;i.get(this.path,function(i,r){return i?void t._onAssetError(e,i):(e.data=r,void t._onAssetLoad(e))})},e}(n.TextAsset);i.XHRTextAsset=s},{"../utils/XHRLoader":77,"@akashic/akashic-engine":1}],40:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e,i){var r=this,n=document.createElement("canvas");return r=t.call(this,e,i,n)||this,n.width=e,n.height=i,r.canvas=n,r._renderer=void 0,r}return r(e,t),e.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=null,this._renderer=null,t.prototype.destroy.call(this)},e.prototype.getHTMLElement=function(){return this.canvas},e.prototype.changeVisualScale=function(t,e){var i=this.canvas.style;"transform"in i?(i.transformOrigin="0 0",i.transform="scale("+t+","+e+")"):"webkitTransform"in i?(i.webkitTransformOrigin="0 0",i.webkitTransform="scale("+t+","+e+")"):(i.width=Math.floor(t*this.width)+"px",i.height=Math.floor(e*this.width)+"px")},e}(n.Surface);i.CanvasSurface=o},{"@akashic/akashic-engine":1}],41:[function(t,e,i){"use strict";function r(t,e,i,r,n,o,s,a,h,c,d,f){var _=e<p._environmentMinimumFontSize?e/p._environmentMinimumFontSize:1,g=Math.ceil((e+2*n)*_),y=Math.ceil((e+2*o)*_),m=new l.Context2DSurface(g,y),v=m.canvas,T=v.getContext("2d"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),w=f===u.FontWeight.Bold?"bold ":"";T.save(),T.font=w+e+"px "+i,T.textAlign="left",T.textBaseline="alphabetic",T.lineJoin="bevel",1!==_&&T.scale(_,_),h>0&&(T.lineWidth=h,T.strokeStyle=c,T.strokeText(A,n,o+r)),d||(T.fillStyle=a,T.fillText(A,n,o+r));var x=T.measureText(A).width;T.restore();var E={surface:m,advanceWidth:x,imageData:s?T.getImageData(0,0,v.width,v.height):void 0};return E}function n(t){for(var e=t.width,i=t.height,r=0,n=0,o=0,s=0,a=t.height;a>s;s=s+1|0)for(var h=0,c=t.width;c>h;h=h+1|0){var u=t.data[o+3];0!==u&&(e>h&&(e=h),h>r&&(r=h),i>s&&(i=s),s>n&&(n=s)),o+=4}var l=void 0;return l=e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:i,width:r-e+1,height:n-i+1}}function o(t){return 0===t.width||0===t.height}function s(t){switch(t){case u.FontFamily.Monospace:return"monospace";case u.FontFamily.Serif:return"serif";default:return"sans-serif"}}function a(t){return-1!==d.indexOf(t)?t:'"'+t+'"'}function h(t){return"number"==typeof t?s(t):"string"==typeof t?a(t):t.map(function(t){return"string"==typeof t?a(t):s(t)}).join(",")}var c=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var u=t("@akashic/akashic-engine"),l=t("./context2d/Context2DSurface"),d=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],p=function(t){function e(i,r,n,o,a,c,l,d){var p=t.call(this,i,r,n,o,a,c,l,d)||this;p._glyphAreas={},p._cssFontFamily=h(i);var f=s(u.FontFamily.SansSerif);return-1===p._cssFontFamily.indexOf(f)&&(p._cssFontFamily+=","+f),p._marginW=Math.ceil(.3*p.fontSize+p.strokeWidth/2),p._marginH=Math.ceil(.3*p.fontSize+p.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=p.measureMinimumFontSize()),p}return c(e,t),e.prototype.create=function(t){var e,i=this._glyphAreas[t];return i||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),i=n(e.imageData),i.advanceWidth=e.advanceWidth,this._glyphAreas[t]=i),o(i)?(e&&e.surface.destroy(),new u.Glyph(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(e||(e=r(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new u.Glyph(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e="M",i=document.createElement("canvas"),r=i.getContext("2d");r.textAlign="left",r.textBaseline="alphabetic",r.lineJoin="bevel";var n;r.font=t+"px sans-serif";var o=r.measureText(e).width;do n=o,t+=1,r.font=t+"px sans-serif",o=r.measureText(e).width;while(n===o||t>50);return t},e}(u.GlyphFactory);i.GlyphFactory=p},{"./context2d/Context2DSurface":44,"@akashic/akashic-engine":1}],42:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(t){function e(t){if(0!==(t&t-1)){for(var e=1;t>e;)e*=2;return e}return t}function i(t){return Math.min(Math.max(t,0),1)}function r(t){var e=!1;return t&&0<t.length&&(e="webgl"===t[0]),e}t.toPowerOfTwo=e,t.clamp=i,t.usedWebGL=r}(r=i.RenderingHelper||(i.RenderingHelper={}))},{}],43:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(e){var i=t.call(this)||this;return i.surface=e,i.context=e.context(),i}return r(e,t),e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,i,r,n,o,s){this.context.drawImage(t._drawable,e,i,r,n,o,s,r,n)},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;a>h;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawSystemText=function(t,e,i,r,o,s,a,h,c,u,l,d){var p,f,_,g=this.context;switch(g.save(),c){case n.FontFamily.Monospace:p="monospace";break;case n.FontFamily.Serif:p="serif";break;default:p="sans-serif"}switch(g.font=o+"px "+p,s){case n.TextAlign.Right:f="right";break;case n.TextAlign.Center:f="center";break;default:
f="left"}switch(g.textAlign=f,a){case n.TextBaseline.Top:_="top";break;case n.TextBaseline.Middle:_="middle";break;case n.TextBaseline.Bottom:_="bottom";break;default:_="alphabetic"}g.textBaseline=_,g.lineJoin="bevel",u>0&&(g.lineWidth=u,g.strokeStyle=l,"undefined"==typeof r?g.strokeText(t,e,i):g.strokeText(t,e,i,r)),d||(g.fillStyle=h,"undefined"==typeof r?g.fillText(t,e,i):g.fillText(t,e,i,r)),g.restore()},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform.apply(this.context,t)},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,i,r,n){var o=this.context.fillStyle;this.context.fillStyle=n,this.context.fillRect(t,e,i,r),this.context.fillStyle=o},e.prototype.setCompositeOperation=function(t){var e;switch(t){case n.CompositeOperation.SourceAtop:e="source-atop";break;case n.CompositeOperation.Lighter:e="lighter";break;case n.CompositeOperation.Copy:e="copy";break;case n.CompositeOperation.ExperimentalSourceIn:e="source-in";break;case n.CompositeOperation.ExperimentalSourceOut:e="source-out";break;case n.CompositeOperation.ExperimentalDestinationAtop:e="destination-atop";break;case n.CompositeOperation.ExperimentalDestinationIn:e="destination-in";break;case n.CompositeOperation.DestinationOut:e="destination-out";break;case n.CompositeOperation.DestinationOver:e="destination-over";break;case n.CompositeOperation.Xor:e="xor";break;default:e="source-over"}this.context.globalCompositeOperation=e},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform.apply(this.context,t)},e.prototype.setShaderProgram=function(t){throw n.ExceptionFactory.createAssertionError("Context2DRenderer#setShaderProgram() is not implemented")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype._getImageData=function(t,e,i,r){return this.context.getImageData(t,e,i,r)},e.prototype._putImageData=function(t,e,i,r,n,o,s){void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,i,r,n,o,s)},e}(n.Renderer);i.Context2DRenderer=o},{"@akashic/akashic-engine":1}],44:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Context2DRenderer"),o=t("../CanvasSurface"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.context=function(){return this._context||(this._context=this.canvas.getContext("2d")),this._context},e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},e.prototype.changePhysicalScale=function(t,e){this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},e.prototype.isPlaying=function(){return!1},e}(o.CanvasSurface);i.Context2DSurface=s},{"../CanvasSurface":40,"./Context2DRenderer":43}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("../RenderingHelper"),n=t("../context2d/Context2DSurface"),o=t("../webgl/WebGLSharedObject"),s=function(){function t(){}return t.prototype.createPrimarySurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?(this._shared||(this._shared=new o.WebGLSharedObject(t,e)),this._shared.getPrimarySurface()):new n.Context2DSurface(t,e)},t.prototype.createBackSurface=function(t,e,i){return r.RenderingHelper.usedWebGL(i)?this._shared.createBackSurface(t,e):new n.Context2DSurface(t,e)},t}();i.SurfaceFactory=s},{"../RenderingHelper":42,"../context2d/Context2DSurface":44,"../webgl/WebGLSharedObject":55}],46:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t){t?this.matrix=new Float32Array(t.matrix):this.matrix=new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this},t.prototype.translate=function(t,e){var i=this.matrix;return i[4]+=i[0]*t+i[2]*e,i[5]+=i[1]*t+i[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,i=t[0]*e[0]+t[1]*e[2],r=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();i.AffineTransformer=r},{}],47:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./AffineTransformer"),o=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer),this.shaderProgram=t.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation=r.CompositeOperation.SourceOver,this.transformer=new n.AffineTransformer,this.shaderProgram=null)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},t}();i.RenderingState=o},{"./AffineTransformer":46,"@akashic/akashic-engine":1}],48:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./WebGLBackSurfaceRenderer"),o=t("./WebGLPrimarySurface"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new n.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},e.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},e}(o.WebGLPrimarySurface);i.WebGLBackSurface=s},{"./WebGLBackSurfaceRenderer":49,"./WebGLPrimarySurface":51}],49:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./WebGLRenderer"),o=t("./RenderingState"),s=function(t){function e(e,i){var r=t.call(this,i,i.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:r._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new o.RenderingState(this.currentState()),i=e.transformer.matrix;i[1]*=-1,i[3]*=-1,i[5]=-i[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},e.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},e}(n.WebGLRenderer);i.WebGLBackSurfaceRenderer=s},{"./RenderingState":47,"./WebGLRenderer":53}],50:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=t("../RenderingHelper");!function(t){function e(e){var i="string"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return i[3]=n.RenderingHelper.clamp(i[3]),i[0]=n.RenderingHelper.clamp(i[0])*i[3],i[1]=n.RenderingHelper.clamp(i[1])*i[3],i[2]=n.RenderingHelper.clamp(i[2])*i[3],i}function i(t){var e=t[0]%360,i=t[1],r=t[2]>50?100-t[2]:t[2],n=t[3],o=r+r*i,s=r-r*i;return 60>e?[o,e/60*(o-s)+s,s,n]:120>e?[(120-e)/60*(o-s)+s,o,s,n]:180>e?[s,o,(e-120)/60*(o-s)+s,n]:240>e?[s,(240-e)/60*(o-s)+s,o,n]:300>e?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]}function r(e){var i=e.toUpperCase().replace(/\s+/g,""),r=t.colorMap[i];if(r)return r;if(i.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),n.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),n.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),n.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),n.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+i)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=i,t._toColor=r}(r=i.WebGLColor||(i.WebGLColor={}))},{"../RenderingHelper":42}],51:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("../CanvasSurface"),o=t("./WebGLPrimarySurfaceRenderer"),s=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.canvas.style.position="absolute",n._shared=e,n}return r(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},e.prototype.changePhysicalScale=function(t,e){var i=Math.ceil(this.width*t),r=Math.ceil(this.height*e);this.canvas.width=i,this.canvas.height=r,this.renderer().changeViewportSize(i,r)},e.prototype.isPlaying=function(){return!1},e}(n.CanvasSurface);i.WebGLPrimarySurface=s},{"../CanvasSurface":40,"./WebGLPrimarySurfaceRenderer":52}],52:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./WebGLRenderer"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shared.pushRenderTarget(r._renderTarget),r}return r(e,t),e.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},e}(n.WebGLRenderer);i.WebGLPrimarySurfaceRenderer=o},{"./WebGLRenderer":53}],53:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./WebGLColor"),s=t("./RenderingState"),a=function(t){function e(i,r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(e.DEFAULT_CAPACITY),n._whiteColor=[1,1,1,1],n._shared=i,n._renderTarget=r,n}return r(e,t),e.prototype.clear=function(){this._shared.clear()},e.prototype.end=function(){this._shared.end()},e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.fillRect=function(t,e,i,r,n){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,r,t,e,o.WebGLColor.get(n))},e.prototype.drawSprites=function(t,e,i,r,n,o,s,a){for(var h=0;a>h;++h)this.drawImage(t,e[h],i[h],r[h],n[h],o[h],s[h])},e.prototype.drawImage=function(t,e,i,r,o,s,a){if(!t._drawable)throw n.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw n.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,i,r,o,s,a,this._whiteColor)},e.prototype.drawSystemText=function(t,e,i,r,n,o,s,a,h,c,u,l){},e.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},e.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},e.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},e.prototype.isSupportedShaderProgram=function(){return!0},e.prototype.changeViewportSize=function(t,e){var i=this._renderTarget;this._renderTarget={width:i.width,height:i.height,viewportWidth:t,viewportHeight:e,texture:i.texture,framebuffer:i.framebuffer}},e.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},e.prototype._getImageData=function(){throw n.ExceptionFactory.createAssertionError("WebGLRenderer#_getImageData() is not implemented")},e.prototype._putImageData=function(t,e,i,r,o,s,a){throw n.ExceptionFactory.createAssertionError("WebGLRenderer#_putImageData() is not implemented")},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw n.ExceptionFactory.createAssertionError("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(t>e){2*e>t?this._capacity*=2:this._capacity=t;for(var i=e;i<this._capacity;++i)this._stateStack.push(new s.RenderingState)}},e.DEFAULT_CAPACITY=16,e}(n.Renderer);i.WebGLRenderer=a},{"./RenderingState":47,"./WebGLColor":50,"@akashic/akashic-engine":1}],54:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(e,i,r){var n=t._DEFAULT_VERTEX_SHADER,i=i||t._DEFAULT_FRAGMENT_SHADER,o=t._makeShaderProgram(e,n,i);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,"aVertex"),this._uColor=e.getUniformLocation(this.program,"uColor"),this._uAlpha=e.getUniformLocation(this.program,"uAlpha"),this._uSampler=e.getUniformLocation(this.program,"uSampler"),this._uniforms=r,this._uniformCaches=[],this._uniformSetterTable={"float":this._uniform1f.bind(this),"int":this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(n)}return r},t._makeShaderProgram=function(e,i,r){var n=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,i);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,r);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(a)}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],i=this._uniforms[e.name].value;(e.isArray||i!==e.beforeValue)&&(e.update(e.loc,i),e.beforeValue=i)}},t.prototype.initializeUniforms=function(){var t=this,e=[],i=this._uniforms;null!=i&&Object.keys(i).forEach(function(n){var o=i[n].type,s=Array.isArray(i[n].value);!s||"int"!==o&&"float"!==o||(o+="_v");var a=t._uniformSetterTable[o];if(!a)throw r.ExceptionFactory.createAssertionError("WebGLShaderProgram#initializeUniforms: Uniform type '"+o+"' is not supported.");e.push({name:n,update:a,beforeValue:null,isArray:s,loc:t._context.getUniformLocation(t.program,n)})}),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",t._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",t}();i.WebGLShaderProgram=n},{"@akashic/akashic-engine":1}],55:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=t("./WebGLShaderProgram"),o=t("./WebGLTextureAtlas"),s=t("./WebGLPrimarySurface"),a=t("./WebGLBackSurface"),h=function(){function t(t,e){var i=new s.WebGLPrimarySurface(this,t,e),n=i.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw r.ExceptionFactory.createAssertionError("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=i,this._context=n,this._init()}return t.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},t.prototype.getPrimarySurface=function(){return this._surface},t.prototype.createBackSurface=function(t,e){return new a.WebGLBackSurface(this,t,e)},t.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},t.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},t.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},t.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},t.prototype.draw=function(t,e,i,r,n,o,s,a,h){this._numSprites>=this._maxSpriteCount&&this._commit();var c;if(c=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==c&&(this._commit(),this._currentShaderProgram=c,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),(this._currentColor[0]!==h[0]||this._currentColor[1]!==h[1]||this._currentColor[2]!==h[2]||this._currentColor[3]!==h[3])&&(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var u=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(u[0],u[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+i+n),g=d*(f+r+o),y=l*(p+i),m=d*(f+r);this._register(this._transformVertex(s,a,n,o,t.transformer),[y,m,_,m,_,g,y,m,_,g,y,g])},t.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},t.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},t.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},t.prototype.assignTexture=function(t,e,i,n){if(this._context.bindTexture(this._context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw r.ExceptionFactory.createAssertionError("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.clearTexture=function(t,e,i,r){this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,i,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},t.prototype.makeTextureRaw=function(t,e,i){void 0===i&&(i=null);var r=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,r),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,i),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),r},t.prototype.makeTexture=function(t){var e=this._context.createTexture();return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),t instanceof HTMLImageElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t):t instanceof ImageData&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},t.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},t.prototype.createRenderTarget=function(t,e){var i=this._context,r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r);var n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,n,0),i.bindTexture(i.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();
return i.bindFramebuffer(i.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:r,texture:n}},t.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},t.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},t.prototype.getContext=function(){return this._context},t.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},t.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new n.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},t.prototype._init=function(){var t,e=new n.WebGLShaderProgram(this._context);this._textureAtlas=new o.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation=r.CompositeOperation.SourceOver,this._currentShaderProgram=e,this._defaultShaderProgram=e,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps=(t={},t[r.CompositeOperation.SourceAtop]=[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalSourceIn]=[this._context.DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.ExperimentalSourceOut]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],t[r.CompositeOperation.SourceOver]=[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationAtop]=[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],t[r.CompositeOperation.ExperimentalDestinationIn]=[this._context.ZERO,this._context.SRC_ALPHA],t[r.CompositeOperation.DestinationOut]=[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],t[r.CompositeOperation.DestinationOver]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],t[r.CompositeOperation.Lighter]=[this._context.ONE,this._context.ONE],t[r.CompositeOperation.Copy]=[this._context.ONE,this._context.ZERO],t[r.CompositeOperation.Xor]=[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],t);var i=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(i[0],i[1])},t.prototype._makeBuffer=function(t){var e=this._context.createBuffer();return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},t.prototype._transformVertex=function(t,e,i,r,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,c=s*i*h[0],u=a*i*h[1],l=s*r*h[2],d=a*r*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,c+p,u+f,c+l+p,u+d+f,p,f,c+l+p,u+d+f,l+p,d+f]},t.prototype._register=function(t,e){var i=6*this._numSprites;++this._numSprites;for(var r=0;6>r;++r)this._verticesCache[4*(r+i)+0]=t[2*r+0],this._verticesCache[4*(r+i)+1]=t[2*r+1],this._verticesCache[4*(r+i)+2]=e[2*r+0],this._verticesCache[4*(r+i)+3]=e[2*r+1]},t.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},t}();i.WebGLSharedObject=h},{"./WebGLBackSurface":48,"./WebGLPrimarySurface":51,"./WebGLShaderProgram":54,"./WebGLTextureAtlas":56,"@akashic/akashic-engine":1}],56:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./WebGLTextureMap"),n=t("../RenderingHelper"),o=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4)}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},t.prototype.makeTextureForSurface=function(e,i){var r=i._drawable;if(r&&!r.texture){var o=r.width,s=r.height;if(o>=t.TEXTURE_SIZE||s>=t.TEXTURE_SIZE){var a=n.RenderingHelper.toPowerOfTwo(r.width),h=n.RenderingHelper.toPowerOfTwo(r.height);if(a!==r.width||h!==r.height){var c=document.createElement("canvas");c.width=a,c.height=h;var u=c.getContext("2d");u.globalCompositeOperation="copy",u.drawImage(r,0,0),r=u.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(r),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},t.prototype._assign=function(e,i,n){for(var o,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(e,o,i._drawable),void(this._insertPos=s);o=null,n.length>=t.TEXTURE_COUNT&&(o=n.shift(),e.disposeTexture(o.texture),o.dispose(),e.clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new r.WebGLTextureMap(e.makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(e,o,i._drawable)},t.prototype._register=function(e,i,r){r.texture=i.texture,r.textureOffsetX=i.offsetX,r.textureOffsetY=i.offsetY,r.textureWidth=t.TEXTURE_SIZE,r.textureHeight=t.TEXTURE_SIZE,e.assignTexture(r,i.offsetX,i.offsetY,i.texture)},t.TEXTURE_SIZE=1024,t.TEXTURE_COUNT=16,t}();i.WebGLTextureAtlas=o},{"../RenderingHelper":42,"./WebGLTextureMap":57}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(t,e,i,r,n){this.texture=t,this.offsetX=e,this.offsetY=i,this._width=r,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var i=e._drawable,r=i.width+t.TEXTURE_MARGIN,n=i.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<r||this._height<n)return null;var a=this._width-r,h=this._height-n;return h>=a?(this._left=new t(this.texture,this.offsetX+r,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,r,h),this._right=new t(this.texture,this.offsetX+r,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();i.WebGLTextureMap=r},{}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=(t("@akashic/akashic-pdi"),function(){function t(e,i){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this._disablePreventDefault=!!i,this.pointTrigger=new r.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error("This method is abstract")},t.prototype.stop=function(){throw new Error("This method is abstract")},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t}());i.InputAbstractHandler=n},{"@akashic/akashic-engine":1,"@akashic/akashic-pdi":3}],59:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./InputAbstractHandler"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this,n=1;return r.onMouseDown=function(t){0===t.button&&(r.eventTarget=t.target,r.pointDown(n,t),window.addEventListener("mousemove",r.onMouseMove,!1),window.addEventListener("mouseup",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseMove=function(t){t.target===r.eventTarget&&(r.pointMove(n,t),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r.onMouseUp=function(t){t.target===r.eventTarget&&(r.pointUp(n,t),window.removeEventListener("mousemove",r.onMouseMove,!1),window.removeEventListener("mouseup",r.onMouseUp,!1),r._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},r}return r(e,t),e.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1)},e}(n.InputAbstractHandler);i.MouseHandler=o},{"./InputAbstractHandler":58}],60:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("./MouseHandler"),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.onTouchDown=function(t){for(var e=t.changedTouches,i=0,n=e.length;n>i;i++){var o=e[i];r.pointDown(o.identifier,r.convertToPagePosition(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchMove=function(t){for(var e=t.changedTouches,i=0,n=e.length;n>i;i++){var o=e[i];r.pointMove(o.identifier,r.convertToPagePosition(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r.onTouchUp=function(t){for(var e=t.changedTouches,i=0,n=e.length;n>i;i++){var o=e[i];r.pointUp(o.identifier,r.convertToPagePosition(o))}r._disablePreventDefault||(t.stopPropagation(),t.cancelable&&t.preventDefault())},r}return r(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.inputView.addEventListener("touchstart",this.onTouchDown),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchUp)},e.prototype.stop=function(){t.prototype.stop.call(this),this.inputView.removeEventListener("touchstart",this.onTouchDown),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchUp)},e.prototype.convertToPagePosition=function(t){var e=this.inputView.getBoundingClientRect(),i=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/i.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/i.y}},e}(n.MouseHandler);i.TouchHandler=o},{"./MouseHandler":59}],61:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./Platform");i.Platform=r.Platform;var n=t("./ResourceFactory");i.ResourceFactory=n.ResourceFactory;var o=t("@akashic/akashic-engine");i.g=o;var s=t("./plugin/AudioPluginRegistry");i.AudioPluginRegistry=s.AudioPluginRegistry;var a=t("./plugin/AudioPluginManager");i.AudioPluginManager=a.AudioPluginManager;var h=t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin");i.HTMLAudioPlugin=h.HTMLAudioPlugin;var c=t("./plugin/WebAudioPlugin/WebAudioPlugin");i.WebAudioPlugin=c.WebAudioPlugin;var u=t("./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin");i.PostMessageAudioPlugin=u.PostMessageAudioPlugin},{"./Platform":32,"./ResourceFactory":34,"./plugin/AudioPluginManager":62,"./plugin/AudioPluginRegistry":63,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":67,"./plugin/PostMessageAudioPlugin/PostMessageAudioPlugin":70,"./plugin/WebAudioPlugin/WebAudioPlugin":76,"@akashic/akashic-engine":1}],62:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function t(){this._activePlugin=void 0}return t.prototype.getActivePlugin=function(){return void 0===this._activePlugin?null:this._activePlugin},t.prototype.tryInstallPlugin=function(t){var e=this.findFirstAvailablePlugin(t);return e?(this._activePlugin=new e,!0):!1},t.prototype.findFirstAvailablePlugin=function(t){for(var e=0,i=t.length;i>e;e++){var r=t[e];if(r.isSupported())return r}},t}();i.AudioPluginManager=r},{}],63:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=[];i.AudioPluginRegistry={addPlugin:function(t){-1===r.indexOf(t)&&r.push(t)},getRegisteredAudioPlugins:function(){return r},clear:function(){r=[]}}},{}],64:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var i=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(i)},0);var r=new Audio,o=function(t,e){r.autoplay=!1,r.preload="none",r.src=t,i._attachAll(r,e),r.preload="auto",a(r,e),r.load()},s={success:function(){i._detachAll(r,s),i.data=r,t._onAssetLoad(i),window.clearInterval(i._intervalId)},error:function(){i._detachAll(r,s),i.data=r,t._onAssetError(i,n.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(i._intervalId)}},a=function(t,e){i._intervalCount=0,i._intervalId=window.setInterval(function(){4===t.readyState?e.success():(++i._intervalCount,600===i._intervalCount&&e.error())},100)};if(".aac"===this.path.slice(-4)&&-1!==e.supportedFormats.indexOf("mp4")){var h={success:s.success,error:function(){i._detachAll(r,h),window.clearInterval(i._intervalId);var t=i.path.slice(0,i.path.length-4)+".mp4";o(t,s)}};return void o(this.path,h)}o(this.path,s)},e.prototype.cloneElement=function(){return this.data?new Audio(this.data.src):null},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?n.PathUtil.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("aac")?n.PathUtil.addExtname(t,"aac"):null},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},e}(n.AudioAsset);i.HTMLAudioAsset=o},{"@akashic/akashic-engine":1}],65:[function(t,e,i){"use strict";function r(){s(),o()}function n(){document.addEventListener("keydown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("touchend",r,!0)}function o(){document.removeEventListener("keydown",r),document.removeEventListener("mousedown",r),document.removeEventListener("touchend",r)}function s(){h=2,c.forEach(function(t){return t.play()}),c=[]}var a,h=0,c=[];!function(t){function e(t){function e(){switch(h){case 0:case 1:s();break;case 2:}h=2,clearTimeout(r)}function i(){switch(t.removeEventListener("play",e),h){case 0:c.push(t),h=1,n();break;case 1:c.push(t);break;case 2:t.play()}}switch(h){case 0:t.addEventListener("play",e,!0);var r=setTimeout(i,100);break;case 1:c.push(t);break;case 2:}}t.setupChromeMEIWorkaround=e}(a||(a={})),e.exports=a},{}],66:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./HTMLAudioAutoplayHelper"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._manager=i,r._endedEventHandler=function(){r._onAudioEnded()},r._onPlayEventHandler=function(){r._onPlayEvent()},r._dummyDurationWaitTimer=null,r}return r(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var i=e.cloneElement();i?(o.setupChromeMEIWorkaround(i),i.volume=this._calculateVolume(),i.play()["catch"](function(t){}),i.loop=e.loop,i.addEventListener("ended",this._endedEventHandler,!1),i.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=i):this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration),t.prototype.play.call(this,e)},e.prototype.stop=function(){return this.currentAudio?(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),void t.prototype.stop.call(this)):void t.prototype.stop.call(this)},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._onPlayEvent=function(){this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,this._audioInstance.pause(),this._audioInstance=null))},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.HTMLAudioPlayer=s},{"./HTMLAudioAutoplayHelper":65,"@akashic/akashic-engine":1}],67:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./HTMLAudioAsset"),n=t("./HTMLAudioPlayer"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),r.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(i){}return e},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.HTMLAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.HTMLAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];try{for(var i=["ogg","aac","mp4"],r=0,n=i.length;n>r;r++){var o=i[r],s=t.canPlayType("audio/"+o),a="no"!==s&&""!==s;a&&e.push(o)}}catch(h){}return e},t}();i.HTMLAudioPlugin=o},{"./HTMLAudioAsset":64,"./HTMLAudioPlayer":66}],68:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./PostMessageAudioPlugin"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this,i={id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint};o.PostMessageAudioPlugin.send("akashic:AudioAsset#_load",i),setTimeout(function(){return t._onAssetLoad(e)})},e.prototype.destroy=function(){o.PostMessageAudioPlugin.send("akashic:AudioAsset#destroy",{id:this.id}),t.prototype.destroy.call(this)},e}(n.AudioAsset);i.PostMessageAudioAsset=s},{"./PostMessageAudioPlugin":70,"@akashic/akashic-engine":1}],69:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./PostMessageAudioPlugin"),s=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._manager=i,n.id=r,o.PostMessageAudioPlugin.send("akashic:AudioPlayer#new",{id:r}),n}return r(e,t),e.prototype.play=function(t){o.PostMessageAudioPlugin.send("akashic:AudioPlayer#play",{id:this.id,assetId:t.id})},e.prototype.stop=function(){o.PostMessageAudioPlugin.send("akashic:AudioPlayer#stop",{id:this.id})},e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},e.prototype._changePlaybackRate=function(e){t.prototype._changePlaybackRate.call(this,e),o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changePlaybackRate",{id:this.id,rate:e})},e.prototype.notifyMasterVolumeChanged=function(){o.PostMessageAudioPlugin.send("akashic:AudioPlayer#changeVolume",{id:this.id,volume:this._calculateVolume()})},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.PostMessageAudioPlayer=s},{"./PostMessageAudioPlugin":70,"@akashic/akashic-engine":1}],70:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=t("./PostMessageAudioAsset"),o=t("./PostMessageAudioPlayer"),s=t("./PostMessageHandler"),a=function(){function t(){this.supportedFormats=void 0,this._playerIdx=0}return t.isSupported=function(){return"undefined"!=typeof window&&!!window.postMessage},t.initialize=function(t,e){return r=new s.PostMessageHandler(t,e),r.start(),r},t.send=function(t,e){r.send({type:t,parameters:e})},t.prototype.createAsset=function(t,e,i,r,o,s){return new n.PostMessageAudioAsset(t,e,i,r,o,s)},t.prototype.createPlayer=function(t,e){return new o.PostMessageAudioPlayer(t,e,""+this._playerIdx++)},t}();i.PostMessageAudioPlugin=a},{"./PostMessageAudioAsset":68,"./PostMessageAudioPlayer":69,"./PostMessageHandler":71}],71:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t,e){this.message=new r.Trigger,this.targetWindow=t,this.targetOrigin=e,this.onMessage_bound=this.onMessage.bind(this)}return t.prototype.start=function(){window.addEventListener("message",this.onMessage_bound)},t.prototype.stop=function(){window.removeEventListener("message",this.onMessage_bound)},t.prototype.send=function(t){this.targetWindow.postMessage(t,this.targetOrigin)},t.prototype.onMessage=function(t){t.origin===this.targetOrigin&&this.message.fire(t.data)},t}();i.PostMessageHandler=n},{"@akashic/akashic-engine":1}],72:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("../../utils/XHRLoader"),s=t("./WebAudioHelper"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout(function(){return t._onAssetLoad(e)},0);var i=function(i){e.data=i,t._onAssetLoad(e)},r=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},a=function(t){var e=s.getAudioContext();e.decodeAudioData(t,i,r)},h=new o.XHRLoader,c=function(t,e,i){h.getArrayBuffer(t,function(t,r){t?i(t):e(r)})};return".aac"===this.path.slice(-4)?void c(this.path,a,function(t){var i=e.path.slice(0,e.path.length-4)+".mp4";c(i,function(t){e.path=i,a(t)},r)}):void c(this.path,a,r)},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?n.PathUtil.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("aac")?n.PathUtil.addExtname(t,"aac"):null},e.supportedFormats=[],e}(n.AudioAsset);i.WebAudioAsset=a},{"../../utils/XHRLoader":77,"./WebAudioHelper":74,"@akashic/akashic-engine":1}],73:[function(t,e,i){"use strict";function r(){var t=a.getAudioContext();t.resume(),o()}function n(){document.addEventListener("keydown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("touchend",r,!0)}function o(){document.removeEventListener("keydown",r),document.removeEventListener("mousedown",r),document.removeEventListener("touchend",r)}var s,a=t("./WebAudioHelper");!function(t){function e(){var t=a.getAudioContext();if(!t||"function"==typeof t.resume){var e=a.createGainNode(t),i=t.createOscillator();i.type="sawtooth",i.frequency.value=440,i.connect(e),i.start(0);var r=t.state;i.disconnect(),"running"!==r&&n()}}t.setupChromeMEIWorkaround=e}(s||(s={})),e.exports=s},{"./WebAudioHelper":74}],74:[function(t,e,i){"use strict";var r,n=window.AudioContext||window.webkitAudioContext;!function(t){function e(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var e=window.__akashic__.audioContext;return e instanceof n||(e=window.__akashic__.audioContext=new n,t._workAroundSafari()),e}function i(t){return t.createGain?t.createGain():t.createGainNode()}function r(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}function o(){document.addEventListener("touchstart",function e(){document.removeEventListener("touchstart",e),t.getAudioContext().createBufferSource().start(0)},!0)}t.getAudioContext=e,t.createGainNode=i,t.createBufferNode=r,t._workAroundSafari=o}(r||(r={})),e.exports=r},{}],75:[function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),o=t("./WebAudioHelper"),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._manager=i,r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._sourceNode=void 0,r._dummyDurationWaitTimer=null,r._endedEventHandler=function(){r._onAudioEnded()},r}return r(e,t),e.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},e.prototype.play=function(e){if(this.currentAudio&&this.stop(),e.data){var i=o.createBufferNode(this._audioContext);i.loop=e.loop,i.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),i.connect(this._gainNode),this._sourceNode=i,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0)}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},e.prototype.stop=function(){return this.currentAudio?(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),void t.prototype.stop.call(this)):void t.prototype.stop.call(this)},e.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},e.prototype._calculateVolume=function(){return this._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},e}(n.AudioPlayer);i.WebAudioPlayer=s},{"./WebAudioHelper":74,"@akashic/akashic-engine":1}],76:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./WebAudioAsset"),n=t("./WebAudioPlayer"),o=t("./WebAudioAutoplayHelper"),s=function(){function t(){this.supportedFormats=this._detectSupportedFormats(),o.setupChromeMEIWorkaround()}return t.isSupported=function(){return"AudioContext"in window?!0:"webkitAudioContext"in window?!0:!1},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s){return new r.WebAudioAsset(t,e,i,n,o,s)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t.prototype._detectSupportedFormats=function(){if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];var t=document.createElement("audio"),e=[];
try{for(var i=["ogg","aac","mp4"],r=0,n=i.length;n>r;r++){var o=i[r],s=t.canPlayType("audio/"+o),a="no"!==s&&""!==s;a&&e.push(o)}}catch(h){}return e},t}();i.WebAudioPlugin=s},{"./WebAudioAsset":72,"./WebAudioAutoplayHelper":73,"./WebAudioPlayer":75}],77:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("@akashic/akashic-engine"),n=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},t.prototype._getRequestObject=function(t,e){var i=new XMLHttpRequest;i.open("GET",t.url,!0),i.responseType=t.responseType,i.timeout=this.timeout,i.addEventListener("timeout",function(){e(r.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),i.addEventListener("load",function(){if(i.status>=200&&i.status<300){var n="text"===t.responseType?i.responseText:i.response;e(null,n)}else e(r.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))},!1),i.addEventListener("error",function(){e(r.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))},!1),i.send()},t}();i.XHRLoader=n},{"@akashic/akashic-engine":1}],78:[function(e,i,r){(function(n,o){!function(e,n){"object"==typeof r&&"undefined"!=typeof i?i.exports=n():"function"==typeof t&&t.amd?t(n):e.ES6Promise=n()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function i(t){return"function"==typeof t}function r(t){K=t}function s(t){J=t}function a(){return function(){return n.nextTick(d)}}function h(){return function(){Y(d)}}function c(){var t=0,e=new Q(d),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=d,function(){return t.port2.postMessage(0)}}function l(){var t=setTimeout;return function(){return t(d,1)}}function d(){for(var t=0;z>t;t+=2){var e=it[t],i=it[t+1];e(i),it[t]=void 0,it[t+1]=void 0}z=0}function p(){try{var t=e,i=t("vertx");return Y=i.runOnLoop||i.runOnContext,h()}catch(r){return l()}}function f(t,e){var i=arguments,r=this,n=new this.constructor(g);void 0===n[nt]&&I(n);var o=r._state;return o?!function(){var t=i[o-1];J(function(){return C(o,n,t,r._result)})}():k(r,n,t,e),n}function _(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(g);return E(i,t),i}function g(){}function y(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(e){return ht.error=e,ht}}function T(t,e,i,r){try{t.call(e,i,r)}catch(n){return n}}function A(t,e,i){J(function(t){var r=!1,n=T(i,e,function(i){r||(r=!0,e!==i?E(t,i):b(t,i))},function(e){r||(r=!0,P(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&n&&(r=!0,P(t,n))},t)}function w(t,e){e._state===st?b(t,e._result):e._state===at?P(t,e._result):k(e,void 0,function(e){return E(t,e)},function(e){return P(t,e)})}function x(t,e,r){e.constructor===t.constructor&&r===f&&e.constructor.resolve===_?w(t,e):r===ht?P(t,ht.error):void 0===r?b(t,e):i(r)?A(t,e,r):b(t,e)}function E(e,i){e===i?P(e,y()):t(i)?x(e,i,v(i)):b(e,i)}function S(t){t._onerror&&t._onerror(t._result),R(t)}function b(t,e){t._state===ot&&(t._result=e,t._state=st,0!==t._subscribers.length&&J(R,t))}function P(t,e){t._state===ot&&(t._state=at,t._result=e,J(S,t))}function k(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+st]=i,n[o+at]=r,0===o&&t._state&&J(R,t)}function R(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?C(i,r,n,o):n(o);t._subscribers.length=0}}function L(){this.error=null}function M(t,e){try{return t(e)}catch(i){return ct.error=i,ct}}function C(t,e,r,n){var o=i(r),s=void 0,a=void 0,h=void 0,c=void 0;if(o){if(s=M(r,n),s===ct?(c=!0,a=s.error,s=null):h=!0,e===s)return void P(e,m())}else s=n,h=!0;e._state!==ot||(o&&h?E(e,s):c?P(e,a):t===st?b(e,s):t===at&&P(e,s))}function O(t,e){try{e(function(e){E(t,e)},function(e){P(t,e)})}catch(i){P(t,i)}}function F(){return ut++}function I(t){t[nt]=ut++,t._state=void 0,t._result=void 0,t._subscribers=[]}function D(t,e){this._instanceConstructor=t,this.promise=new t(g),this.promise[nt]||I(this.promise),X(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&b(this.promise,this._result))):P(this.promise,G())}function G(){return new Error("Array Methods must be provided an Array")}function H(t){return new D(this,t).promise}function U(t){var e=this;return new e(X(t)?function(i,r){for(var n=t.length,o=0;n>o;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function N(t){var e=this,i=new e(g);return P(i,t),i}function W(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function B(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(t){this[nt]=F(),this._result=this._state=void 0,this._subscribers=[],g!==t&&("function"!=typeof t&&W(),this instanceof j?O(this,t):B())}function V(){var t=void 0;if("undefined"!=typeof o)t=o;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=t.Promise;if(i){var r=null;try{r=Object.prototype.toString.call(i.resolve())}catch(e){}if("[object Promise]"===r&&!i.cast)return}t.Promise=j}var q=void 0;q=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var X=q,z=0,Y=void 0,K=void 0,J=function(t,e){it[z]=t,it[z+1]=e,z+=2,2===z&&(K?K(d):rt())},$="undefined"!=typeof window?window:void 0,Z=$||{},Q=Z.MutationObserver||Z.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof n&&"[object process]"==={}.toString.call(n),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,it=new Array(1e3),rt=void 0;rt=tt?a():Q?c():et?u():void 0===$&&"function"==typeof e?p():l();var nt=Math.random().toString(36).substring(16),ot=void 0,st=1,at=2,ht=new L,ct=new L,ut=0;return D.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===ot&&t>i;i++)this._eachEntry(e[i],i)},D.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===_){var n=v(t);if(n===f&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===j){var o=new i(g);x(o,t,n),this._willSettleAt(o,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},D.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===ot&&(this._remaining--,t===at?P(r,i):this._result[e]=i),0===this._remaining&&b(r,this._result)},D.prototype._willSettleAt=function(t,e){var i=this;k(t,void 0,function(t){return i._settledAt(st,e,t)},function(t){return i._settledAt(at,e,t)})},j.all=H,j.race=U,j.resolve=_,j.reject=N,j._setScheduler=r,j._setAsap=s,j._asap=J,j.prototype={constructor:j,then:f,"catch":function(t){return this.then(null,t)}},V(),j.polyfill=V,j.Promise=j,j})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:79}],79:[function(t,e,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function s(t){if(d===clearTimeout)return clearTimeout(t);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?_=f.concat(_):y=-1,_.length&&h())}function h(){if(!g){var t=o(a);g=!0;for(var e=_.length;e;){for(f=_,_=[];++y<e;)f&&f[y].run();y=-1,e=_.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var l,d,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{d="function"==typeof clearTimeout?clearTimeout:n}catch(t){d=n}}();var f,_=[],g=!1,y=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];_.push(new c(t,e)),1!==_.length||g||o(h)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],80:[function(t,e,i){e.exports={gameDriver:t("@akashic/game-driver"),akashicEngine:t("@akashic/akashic-engine"),pdiBrowser:t("@akashic/pdi-browser")}},{"@akashic/akashic-engine":1,"@akashic/game-driver":4,"@akashic/pdi-browser":28}]},{},[80])(80)});	window.engineFiles=engineFilesV2_1_17,window.g=engineFiles.akashicEngine,function(){window.require;window.require=function(i){switch(i){case"@akashic/akashic-engine":return engineFiles.akashicEngine;default:return this.call(this,i)}}}();</script>

<script>
if (! ("optionProps" in window)) {
	window.optionProps = {};
}
window.optionProps.magnify = false
window.g = require("@akashic/akashic-engine");
</script>
<script>
if (! ("gLocalAssetContainer" in window)) {
	window.gLocalAssetContainer = {};
}

			window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 768,%0A%09%22height%22: 432,%0A%09%22fps%22: 30,%0A%09%22main%22: %22./script/main.js%22,%0A%09%22assets%22: {%0A%09%09%22main%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/main.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22scene0%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/scene0.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22title%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/title.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22black%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 768,%0A%09%09%09%22height%22: 432,%0A%09%09%09%22path%22: %22image/black.png%22%0A%09%09},%0A%09%09%22message%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 32,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/message.png%22%0A%09%09},%0A%09%09%22yellow%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 32,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/yellow.png%22%0A%09%09},%0A%09%09%22AssetCollector%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/AssetCollector.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22cowlickConfig%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/cowlickConfig.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22titleBackground%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 768,%0A%09%09%09%22height%22: 432,%0A%09%09%09%22path%22: %22image/titleBackground.png%22%0A%09%09}%0A%09},%0A%09%22operationPlugins%22: [%0A%09%09{%0A%09%09%09%22code%22: 1,%0A%09%09%09%22script%22: %22./node_modules/@akashic-extension/akashic-hover-plugin/lib/HoverPlugin.js%22,%0A%09%09%09%22option%22: {%0A%09%09%09%09%22showTooltip%22: false%0A%09%09%09}%0A%09%09}%0A%09],%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %222%22%0A%09},%0A%09%22globalScripts%22: [%0A%09%09%22node_modules/@akashic-extension/akashic-hover-plugin/lib/Converter.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-hover-plugin/lib/HoverPlugin.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-label/lib/DefaultRubyParser.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-label/lib/FragmentDrawInfo.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-label/lib/Label.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-label/lib/RubyParser.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-label/lib/index.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-timeline/lib/ActionType.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-timeline/lib/Easing.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-timeline/lib/Timeline.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-timeline/lib/Tween.js%22,%0A%09%09%22node_modules/@akashic-extension/akashic-timeline/lib/index.js%22,%0A%09%09%22node_modules/@pocketberserker/akashic-pagination/lib/LabelButton.js%22,%0A%09%09%22node_modules/@pocketberserker/akashic-pagination/lib/Pagination.js%22,%0A%09%09%22node_modules/@pocketberserker/akashic-pagination/lib/createDefaultButtonImage.js%22,%0A%09%09%22node_modules/@pocketberserker/akashic-pagination/lib/index.js%22,%0A%09%09%22node_modules/@xnv/akashic-scrollable/lib/NinePatchHorizontalScrollbar.js%22,%0A%09%09%22node_modules/@xnv/akashic-scrollable/lib/NinePatchVerticalScrollbar.js%22,%0A%09%09%22node_modules/@xnv/akashic-scrollable/lib/NullScrollbar.js%22,%0A%09%09%22node_modules/@xnv/akashic-scrollable/lib/Scrollable.js%22,%0A%09%09%22node_modules/@xnv/akashic-scrollable/lib/createDefaultScrollbarImage.js%22,%0A%09%09%22node_modules/@xnv/akashic-scrollable/lib/index.js%22,%0A%09%09%22node_modules/@cowlick/config/lib/index.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/Constant.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/Frame.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/GameError.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/Scenario.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/Scene.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/Script.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/AssetCollector.js%22,%0A%09%09%22node_modules/@cowlick/core/lib/index.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/lineBreakRule.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/Constant.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/Engine.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/AudioGroup.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/AutoMode.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/Button.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/GameScene.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/GameStateHelper.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/Image.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/ImageButton.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/LabelButton.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/LayerGroup.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/Message.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/SaveLoadScene.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/Scene.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/SceneController.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/Slider.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/components/VideoGroup.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/index.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/models/AlreadyReadChecker.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/models/GameState.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/models/LayerPriority.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/models/PriorityQueue.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/models/Storage.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/scripts/ScriptManager.js%22,%0A%09%09%22node_modules/@cowlick/engine/lib/scripts/defaultScripts.js%22%0A%09],%0A%09%22moduleMainScripts%22: {%0A%09%09%22@akashic-extension/akashic-hover-plugin%22: %22node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js%22,%0A%09%09%22@akashic-extension/akashic-label%22: %22node_modules/@akashic-extension/akashic-label/lib/index.js%22,%0A%09%09%22@akashic-extension/akashic-timeline%22: %22node_modules/@akashic-extension/akashic-timeline/lib/index.js%22,%0A%09%09%22@pocketberserker/akashic-pagination%22: %22node_modules/@pocketberserker/akashic-pagination/lib/index.js%22,%0A%09%09%22@xnv/akashic-scrollable%22: %22node_modules/@xnv/akashic-scrollable/lib/index.js%22,%0A%09%09%22@cowlick/config%22: %22node_modules/@cowlick/config/lib/index.js%22,%0A%09%09%22@cowlick/core%22: %22node_modules/@cowlick/core/lib/index.js%22,%0A%09%09%22@cowlick/engine%22: %22node_modules/@cowlick/engine/lib/index.js%22%0A%09}%0A}";
				window.gLocalAssetContainer["main"] = function(g) {
			!function(e,t,n,a,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("@akashic-extension/akashic-timeline"),c=t("@cowlick/core"),o=t("@cowlick/engine"),d=t("./AssetCollector");n.exports=function(){var e=o.initialize(g.game);e.assetCollector=new d.AssetCollector,u(e),e.load("title",function(e){})};var l;!function(e){e.enterScene="enterScene",e.nextScene="nextScene"}(l=e.Tag||(e.Tag={}));var f=300,u=function(t){var n=o.defaultScripts.get(c.Tag.fadeIn);t.script(c.Tag.fadeIn,function(e,t){t.after=[{tag:c.Tag.skip}],n(e,t)});var a=o.defaultScripts.get(c.Tag.fadeOut);t.script(c.Tag.fadeOut,function(e,t){t.after=[{tag:c.Tag.skip}],a(e,t)}),t.script(l.enterScene,function(e){var t=e.current;t.disableWindowClick(),t.transition("black",function(e){var n=new r.Timeline(t.body);n.create(e,{modified:e.modified,destroyed:e.destroyed}).fadeOut(f)})}),t.script(l.nextScene,function(e,t){var n=e.current;n.disableWindowClick(),n.transition("black",function(a){var i=new r.Timeline(n.body);i.create(a,{modified:a.modified,destroyed:a.destroyed}).fadeIn(f).call(function(){e.jump({tag:c.Tag.jump,label:t.label})})})}),t.script("newgame",function(t){var n={name:"button",x:30,y:320},a=e.createLink(t,{tag:c.Tag.link,width:200,height:40,text:"",fontSize:24,backgroundImage:"yellow",padding:4,backgroundEffector:{borderWidth:4},scripts:[{tag:c.Tag.extension,data:{tag:l.nextScene,label:"scene0"}}],layer:n});t.current.appendLayer(a,n)})};e.createLink=function(e,t){var n={scene:e.current.body,width:t.width,height:t.height,backgroundImage:t.backgroundImage,padding:t.padding,backgroundEffector:t.backgroundEffector,text:t.text,config:e.config,gameState:e.current.gameState};t.fontSize&&(n.fontSize=t.fontSize);var a=new o.LabelButton(n);a.move(t.layer.x,t.layer.y);for(var i=function(t){a.click.add(function(){o.Engine.scriptManager.call(e,t)})},r=0,c=t.scripts;r<c.length;r++){var d=c[r];i(d)}return a},e.black=function(e){return{tag:c.Tag.image,assetId:"black",layer:{name:"black",opacity:e}}}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["scene0"] = function(g) {
			!function(e,a,r,t,m){var l=a("@cowlick/core");r.exports=new l.Scene({label:"scene0",frames:[new l.Frame([{tag:"image",assetId:"black",layer:{name:"background"}},{tag:"removeLayer",name:"choice"},{tag:"text",clear:!0,values:["\n"]}]),new l.Frame([{tag:"image",assetId:"black",layer:{name:"black",opacity:0}},{tag:"fadeIn",layer:"black",duration:1e3,after:[]}]),new l.Frame([{tag:"removeLayer",name:"black"},{tag:"timeout",milliseconds:"500",scripts:[{tag:"jump",label:"scene0",frame:3}]}]),new l.Frame([{tag:"removeLayer",name:"choice"},{tag:"text",clear:!0,values:[""]}]),new l.Frame([{tag:"removeLayer",name:"choice"},{tag:"text",clear:!0,values:[""]}]),new l.Frame([{tag:"jump",label:"title"}])]})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["title"] = function(g) {
			!function(e,a,t,n,g){var l=a("@cowlick/core");t.exports=new l.Scene({label:"title",frames:[new l.Frame([{tag:"layer",name:"message",visible:!1},{tag:"layer",name:"system",visible:!1},{tag:"image",assetId:"titleBackground",layer:{name:"background"}},{tag:"extension",data:{tag:"newgame"}},{tag:"image",assetId:"black",layer:{name:"black",opacity:1}},{tag:"extension",data:{tag:"enterScene"}}])]})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["AssetCollector"] = function(g) {
			!function(t,e,o,r,n){"use strict";var c=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=e("@cowlick/core"),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return c(e,t),e.prototype.collectScript=function(e){switch(e.tag){case i.Tag.extension:return this.collectScript(e.data);default:return t.prototype.collectScript.call(this,e)}},e}(i.DefaultAssetCollector);t.AssetCollector=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["cowlickConfig"] = function(g) {
			!function(e,a,i,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=a("@cowlick/core"),s=24,r={window:{message:{ui:{layer:{name:m.LayerKind.message,x:10,y:g.game.height-g.game.height/4-40},width:g.game.width-20,height:g.game.height/4+30,backgroundImage:"message",padding:4,backgroundEffector:{borderWidth:4},touchable:!0},top:{x:30,y:g.game.height-g.game.height/4-30},marker:[]},system:[],priority:[["message",0],["choice",1],["system",2]]},font:{list:[new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:s})],color:"white",alreadyReadColor:"white",size:s},system:{maxSaveCount:100,messageSpeed:1e3/g.game.fps,autoMessageDuration:1500,alreadyRead:!1,realTimeDisplay:!1,autoSave:!1},audio:{voice:.5,se:.5,bgm:.5}};i.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-hover-plugin/lib/Converter.js"] = function(g) {
			!function(e,r,o,d,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function e(){}return e.asHoverable=function(e,r){var o=e;return o.hoverable=!0,o.touchable=!0,o.hovered=o.hovered||new g.Trigger,o.unhovered=o.unhovered||new g.Trigger,r&&r.cursor&&(o.cursor=r.cursor),o},e.asUnhoverable=function(e){var r=e;return delete r.hoverable,r.hovered&&!r.hovered.destroyed()&&(r.hovered.destroy(),delete r.hovered),r.unhovered&&!r.unhovered.destroyed()&&(r.unhovered.fire(),r.unhovered.destroy(),delete r.unhovered),r},e}();e.Converter=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-hover-plugin/lib/HoverPlugin.js"] = function(g) {
			!function(e,o,t,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function e(e,o,t){void 0===t&&(t={}),this.game=e,this.view=o.view,this.beforeHover=null,this.operationTrigger=new g.Trigger,this._cursor=t.cursor||"pointer",this._showTooltip=!!t.showTooltip,this._getScale=o.getScale?function(){return o.getScale()}:null,this._onMouseMove_bound=this._onMouseMove.bind(this),this._onMouseOut_bound=this._onMouseOut.bind(this)}return e.isSupported=function(){return"undefined"!=typeof document&&"function"==typeof document.addEventListener},e.prototype.start=function(){return this.view.addEventListener("mousemove",this._onMouseMove_bound,!1),this.view.addEventListener("mouseout",this._onMouseOut_bound,!1),!0},e.prototype.stop=function(){this.view.removeEventListener("mousemove",this._onMouseMove_bound,!1),this.view.removeEventListener("mouseout",this._onMouseOut_bound,!1)},e.prototype._onMouseMove=function(e){var o=this.view.getBoundingClientRect(),t=o.left+window.pageXOffset,i=o.top+window.pageYOffset,r=e.pageX-t,s=e.pageY-i,n={x:1,y:1};this._getScale&&(n=this._getScale());var u={x:r/n.x,y:s/n.y},h=this.game.scene().findPointSourceByPoint(u).target;h&&h.hoverable?(h!==this.beforeHover&&(this.beforeHover&&this.beforeHover.hoverable&&this._onUnhovered(h),this._onHovered(h)),this.beforeHover=h):this.beforeHover&&this._onUnhovered(this.beforeHover)},e.prototype._onHovered=function(e){e.hoverable&&(this.view.style.cursor=e.cursor?e.cursor:this._cursor,this._showTooltip&&e.title&&this.view.setAttribute("title",e.title),e.hovered.fire())},e.prototype._onUnhovered=function(e){this.view.style.cursor="auto",this.beforeHover&&this.beforeHover.unhovered&&(this.beforeHover.unhovered.fire(),this._showTooltip&&this.view.removeAttribute("title")),this.beforeHover=null},e.prototype._onMouseOut=function(){this.beforeHover&&this._onUnhovered(this.beforeHover)},e}();e.HoverPlugin=s,t.exports=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-hover-plugin/lib/index.js"] = function(g) {
			!function(e,r,o,n,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r("./Converter");e.Converter=i.Converter;var l=r("./HoverPlugin");e.HoverPlugin=l.HoverPlugin}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-label/lib/DefaultRubyParser.js"] = function(g) {
			!function(e,r,a,t,p){"use strict";function l(e){for(var r=/^((?:[^\\{]|\\+.)*?)({(?:[^\\}]|\\+.)*?})([\s\S]*)/,a=[];e.length>0;){var t=e.match(r);if(null===t){a.push(e.replace(/\\{/g,"{").replace(/\\}/g,"}"));break}var p=t[1],l=t[2];e=t[3],p.length>0&&a.push(p.replace(/\\{/g,"{").replace(/\\}/g,"}"));var c=JSON.parse(l.replace(/\\/g,"\\\\"));if(!c.hasOwnProperty("rt")||!c.hasOwnProperty("rb"))throw g.ExceptionFactory.createTypeMismatchError("parse","RubyFragment");c.rt=c.rt.replace(/\\{/g,"{").replace(/\\}/g,"}"),c.rb=c.rb.replace(/\\{/g,"{").replace(/\\}/g,"}"),c.text=l,a.push(c)}return a}Object.defineProperty(e,"__esModule",{value:!0}),e.parse=l}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-label/lib/FragmentDrawInfo.js"] = function(g) {
			!function(t,i,e,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function t(t,i,e){this.text=t,this.width=i,this.glyphs=e}return t}();t.StringDrawInfo=h;var s=function(){function t(t,i,e,r,n,h){this.text=t.text,this.fragment=t,this.width=i,this.rbWidth=e,this.rtWidth=r,this.glyphs=n,this.rubyGlyphs=h}return t}();t.RubyFragmentDrawInfo=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-label/lib/Label.js"] = function(g) {
			!function(t,e,i,r,n){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),s=e("./RubyParser"),a=e("./FragmentDrawInfo"),h=e("./DefaultRubyParser"),u=function(t){function e(e){var i=t.call(this,e)||this;return i.text=e.text,i.font=e.font,i.fontSize=e.fontSize,i._lineBreakWidth=e.width,i.lineBreak="lineBreak"in e?e.lineBreak:!0,i.lineGap=e.lineGap||0,i.textAlign="textAlign"in e?e.textAlign:g.TextAlign.Left,i.textColor=e.textColor,i.trimMarginTop="trimMarginTop"in e?e.trimMarginTop:!1,i.widthAutoAdjust="widthAutoAdjust"in e?e.widthAutoAdjust:!1,i.rubyEnabled="rubyEnabled"in e?e.rubyEnabled:!0,i.fixLineGap="fixLineGap"in e?e.fixLineGap:!1,i.rubyParser="rubyParser"in e?e.rubyParser:h.parse,i.lineBreakRule="lineBreakRule"in e?e.lineBreakRule:void 0,e.rubyOptions||(e.rubyOptions={}),i.rubyOptions=e.rubyOptions,i.rubyOptions.rubyFontSize="rubyFontSize"in e.rubyOptions?e.rubyOptions.rubyFontSize:e.fontSize/2,i.rubyOptions.rubyFont="rubyFont"in e.rubyOptions?e.rubyOptions.rubyFont:i.font,i.rubyOptions.rubyGap="rubyGap"in e.rubyOptions?e.rubyOptions.rubyGap:0,i.rubyOptions.rubyAlign="rubyAlign"in e.rubyOptions?e.rubyOptions.rubyAlign:s.RubyAlign.SpaceAround,i._lines=[],i._beforeText=void 0,i._beforeTextAlign=void 0,i._beforeFontSize=void 0,i._beforeLineBreak=void 0,i._beforeFont=void 0,i._beforeWidth=void 0,i._beforeRubyEnabled=void 0,i._beforeFixLineGap=void 0,i._beforeTrimMarginTop=void 0,i._beforeWidthAutoAdjust=void 0,i._beforeRubyOptions={},i._invalidateSelf(),i}return o(e,t),e.prototype.invalidate=function(){this._invalidateSelf(),t.prototype.invalidate.call(this)},e.prototype.renderCache=function(t){if(this.rubyEnabled||0!==this.fontSize){t.save();for(var e=0,i=0;i<this._lines.length;++i)this._lines[i].width>0&&this._lines[i].height>0&&t.drawImage(this._lines[i].surface,0,0,this._lines[i].width,this._lines[i].height,this._offsetX(this._lines[i].width),e),e+=this._lines[i].height+this.lineGap;this.textColor&&(t.setCompositeOperation(g.CompositeOperation.SourceAtop),t.fillRect(0,0,this._lineBreakWidth,this.height,this.textColor)),t.restore()}},e.prototype.destroy=function(){this._destroyLines(),t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){var t=Math.ceil(this._lines.reduce(function(t,e){return Math.max(t,e.width)},this.width));return{width:t,height:this.height}},Object.defineProperty(e.prototype,"lineCount",{get:function(){return this._lines.length},enumerable:!0,configurable:!0}),e.prototype._offsetX=function(t){switch(this.textAlign){case g.TextAlign.Left:return 0;case g.TextAlign.Right:return this._lineBreakWidth-t;case g.TextAlign.Center:return(this._lineBreakWidth-t)/2;default:return 0}},e.prototype._destroyLines=function(){for(var t=0;t<this._lines.length;t++)this._lines[t].surface&&!this._lines[t].surface.destroyed()&&this._lines[t].surface.destroy();this._lines=void 0},e.prototype._invalidateSelf=function(){if(this.fontSize<0)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: fontSize must not be negative.");if(this.lineGap<-1*this.fontSize)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: lineGap must be greater than -1 * fontSize.");this._beforeWidth!==this.width&&(this._lineBreakWidth=this.width),(this._beforeText!==this.text||this._beforeFontSize!==this.fontSize||this._beforeFont!==this.font||this._beforeLineBreak!==this.lineBreak||this._beforeWidth!==this.width&&this._beforeLineBreak===!0||this._beforeTextAlign!==this.textAlign||this._beforeRubyEnabled!==this.rubyEnabled||this._beforeFixLineGap!==this.fixLineGap||this._beforeTrimMarginTop!==this.trimMarginTop||this._beforeWidthAutoAdjust!==this.widthAutoAdjust||this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions))&&this._updateLines(),this.widthAutoAdjust&&(this.width=Math.ceil(this._lines.reduce(function(t,e){return Math.max(t,e.width)},0)));for(var t=this.lineGap*(this._lines.length-1),e=0;e<this._lines.length;e++)t+=this._lines[e].height;this.height=t,this._beforeText=this.text,this._beforeTextAlign=this.textAlign,this._beforeFontSize=this.fontSize,this._beforeLineBreak=this.lineBreak,this._beforeFont=this.font,this._beforeWidth=this.width,this._beforeRubyEnabled=this.rubyEnabled,this._beforeFixLineGap=this.fixLineGap,this._beforeTrimMarginTop=this.trimMarginTop,this._beforeWidthAutoAdjust=this.widthAutoAdjust,this._beforeRubyOptions.rubyFontSize=this.rubyOptions.rubyFontSize,this._beforeRubyOptions.rubyFont=this.rubyOptions.rubyFont,this._beforeRubyOptions.rubyGap=this.rubyOptions.rubyGap,this._beforeRubyOptions.rubyAlign=this.rubyOptions.rubyAlign},e.prototype._updateLines=function(){var t=this.rubyEnabled?this.rubyParser(this.text.replace(/\r\n|\n/g,"\r")):[this.text];t=s.flatmap(t,function(t){return"string"!=typeof t?t:t.replace(/\r\n|\n/g,"\r").match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[]});for(var e=this._divideToLines(t),i=[],r=this._beforeFontSize===this.fontSize&&this._beforeFont===this.font&&!this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions),n=0;n<e.length;n++){var o=e[n],a=this._lines[n];r&&void 0!==a&&o.sourceText===a.sourceText&&o.width===a.width&&o.height===a.height?i.push(a):(a&&a.surface&&!a.surface.destroyed()&&a.surface.destroy(),this._drawLineInfoSurface(o),i.push(o))}for(var n=i.length;n<this._lines.length;n++){var a=this._lines[n];a.surface&&!a.surface.destroyed()&&a.surface.destroy()}this._lines=i},e.prototype._drawLineInfoSurface=function(t){var e=t.fragmentDrawInfoArray,i=this._calcRubyHeightInfo(e),r=this.scene.game.resourceFactory.createSurface(Math.ceil(t.width),Math.ceil(t.height)),n=r.renderer();n.begin(),n.save();for(var o=i.hasRubyFragmentDrawInfo||this.fixLineGap?this.rubyOptions.rubyGap+i.maxRubyGlyphHeightWithOffsetY:0,s=t.minMinusOffsetY,h=0;h<e.length;h++){var u=e[h];u instanceof a.RubyFragmentDrawInfo?this._drawRubyFragmentDrawInfo(n,u,o-s,-i.minRubyMinusOffsetY):u instanceof a.StringDrawInfo&&this._drawStringGlyphs(n,this.font,u.glyphs,this.fontSize,0,o-s,0),n.translate(u.width,0)}n.restore(),n.end(),t.surface=r},e.prototype._drawStringGlyphs=function(t,e,i,r,n,o,s){void 0===s&&(s=0),t.save(),t.translate(n,o);for(var a=0;a<i.length;a++){var h=i[a],u=r/e.size,f=h.advanceWidth*u;(h.isSurfaceValid||(h=this._createGlyph(h.code,e)))&&(t.save(),t.transform([u,0,0,u,0,0]),h.width>0&&h.height>0&&t.drawImage(h.surface,h.x,h.y,h.width,h.height,h.offsetX,h.offsetY),t.restore(),t.translate(f+s,0))}t.restore()},e.prototype._drawRubyFragmentDrawInfo=function(t,e,i,r){var n,o,a,h,u=e.fragment,f="rubyFontSize"in u?u.rubyFontSize:this.rubyOptions.rubyFontSize,y="rubyAlign"in u?u.rubyAlign:this.rubyOptions.rubyAlign,l="rubyFont"in u?u.rubyFont:this.rubyOptions.rubyFont,b=e.rtWidth>e.rbWidth,p=e.width,c=e.rtWidth,d=e.rbWidth;switch(y){case s.RubyAlign.Center:a=0,h=0,n=b?0:(p-c)/2,o=b?(p-d)/2:0;break;case s.RubyAlign.SpaceAround:a=e.rubyGlyphs.length>0?(p-c)/e.rubyGlyphs.length:0,h=0,n=b?0:a/2,o=b?(p-d)/2:0;break;default:throw g.ExceptionFactory.createAssertionError("Label#_drawRubyFragmentDrawInfo: unknown rubyAlign.")}this._drawStringGlyphs(t,this.font,e.glyphs,this.fontSize,o,i,h),this._drawStringGlyphs(t,l,e.rubyGlyphs,f,n,r,a)},e.prototype._calcRubyHeightInfo=function(t){for(var e,i=this.rubyOptions.rubyFontSize,r=0,n=this.rubyOptions.rubyGap,o=!1,s=0,h=0;h<t.length;h++){var u=t[h];if(u instanceof a.RubyFragmentDrawInfo){var f=u.fragment;f.rubyFontSize>i&&(i=f.rubyFontSize),f.rubyGap>n&&(n=f.rubyGap);var y=(f.rubyFontSize?f.rubyFontSize:this.rubyOptions.rubyFontSize)/(f.rubyFont?f.rubyFont.size:this.rubyOptions.rubyFont.size),l=Math.max.apply(Math,u.rubyGlyphs.map(function(t){return t.offsetY>0?t.height+t.offsetY:t.height})),b=Math.min.apply(Math,u.rubyGlyphs.map(function(t){return t.offsetY>0?t.offsetY:0}));l*y>r&&(r=l*y);var p=f.rubyFont?f.rubyFont:this.rubyOptions.rubyFont,c=this._calcStandardOffsetY(p),d=(l-Math.min(b,c))*y;d>s&&(s=d,e=Math.min(b,c)*y),o=!0}}0===r&&(r=this.rubyOptions.rubyFontSize);var g=this.trimMarginTop?e:0;return{maxRubyFontSize:i,maxRubyGlyphHeightWithOffsetY:r,minRubyMinusOffsetY:g,maxRubyGap:n,hasRubyFragmentDrawInfo:o}},e.prototype._divideToLines=function(t){for(var e={resultLines:[],currentStringDrawInfo:new a.StringDrawInfo("",0,[]),currentLineInfo:{sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0},reservedLineBreakPosition:null},i=0;i<t.length;i++)this._addFragmentToState(e,t,i);return this._flushCurrentStringDrawInfo(e),this._feedLine(e),e.resultLines},e.prototype._addFragmentToState=function(t,e,i){var r=e[i];if(null!==t.reservedLineBreakPosition&&t.reservedLineBreakPosition--,0===t.reservedLineBreakPosition&&(this._flushCurrentStringDrawInfo(t),this._feedLine(t),t.reservedLineBreakPosition=null),"string"==typeof r&&"\r"===r)this._flushCurrentStringDrawInfo(t),this._feedLine(t);else if("string"==typeof r){var n=g.Util.charCodeAt(r,0);if(!n)return;var o=this._createGlyph(n,this.font);if(!o)return;var s=this.fontSize/this.font.size,a=o.advanceWidth*s;this._needBreakLine(t,a)&&this._breakLine(t,e,i),t.currentStringDrawInfo.width+=a,t.currentStringDrawInfo.glyphs.push(o),t.currentStringDrawInfo.text+=r}else{var h=this._createRubyFragmentDrawInfo(r);if(h.width<=0)return;this._flushCurrentStringDrawInfo(t),this._needBreakLine(t,h.width)&&this._breakLine(t,e,i),t.currentLineInfo.width+=h.width,t.currentLineInfo.fragmentDrawInfoArray.push(h),t.currentLineInfo.sourceText+=r.text}},e.prototype._createStringGlyph=function(t,e){for(var i=[],r=0;r<t.length;r++){var n=g.Util.charCodeAt(t,r);if(n){var o=this._createGlyph(n,e);o&&i.push(o)}}return i},e.prototype._createGlyph=function(t,e){var i=e.glyphForCharacter(t);if(!i){var r=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);this.game().logger.warn("Label#_invalidateSelf(): failed to get a glyph for '"+r+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")}return i},e.prototype._createRubyFragmentDrawInfo=function(t){var e=this._createStringGlyph(t.rb,this.font),i=this._createStringGlyph(t.rt,this.rubyOptions.rubyFont),r="rubyFont"in t?t.rubyFont:this.rubyOptions.rubyFont,n="rubyFontSize"in t?t.rubyFontSize:this.rubyOptions.rubyFontSize,o=this.fontSize/this.font.size,s=n/r.size,h=e.length>0?e.map(function(t){return t.advanceWidth}).reduce(function(t,e){return t+e})*o:0,u=i.length>0?i.map(function(t){return t.advanceWidth}).reduce(function(t,e){return t+e})*s:0,f=h>u?h:u;return new a.RubyFragmentDrawInfo(t,f,h,u,e,i)},e.prototype._flushCurrentStringDrawInfo=function(t){t.currentStringDrawInfo.width>0&&(t.currentLineInfo.fragmentDrawInfoArray.push(t.currentStringDrawInfo),t.currentLineInfo.width+=t.currentStringDrawInfo.width,t.currentLineInfo.sourceText+=t.currentStringDrawInfo.text),t.currentStringDrawInfo=new a.StringDrawInfo("",0,[])},e.prototype._feedLine=function(t){var e=this.fontSize/this.font.size,i=1/0,r=0,n=0;t.currentLineInfo.fragmentDrawInfoArray.forEach(function(t){t.glyphs.forEach(function(t){r>t.offsetY&&(r=t.offsetY),i>t.offsetY&&(i=t.offsetY);var e=t.offsetY>0?t.height+t.offsetY:t.height;e>n&&(n=e)})}),r*=e,n=t.currentLineInfo.fragmentDrawInfoArray.length>0?n*e-r:this.fontSize,n=Math.ceil(n);var o=this._calcRubyHeightInfo(t.currentLineInfo.fragmentDrawInfoArray);if(t.currentLineInfo.height=o.hasRubyFragmentDrawInfo||this.fixLineGap?n+o.maxRubyGlyphHeightWithOffsetY+o.maxRubyGap:n,t.currentLineInfo.minMinusOffsetY=r,this.trimMarginTop){var s=Math.min(i,this._calcStandardOffsetY(this.font))*e;t.currentLineInfo.height-=s,t.currentLineInfo.minMinusOffsetY+=s}t.resultLines.push(t.currentLineInfo),t.currentLineInfo={sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0}},e.prototype._needBreakLine=function(t,e){return this.lineBreak&&e>0&&null===t.reservedLineBreakPosition&&t.currentLineInfo.width+t.currentStringDrawInfo.width+e>this._lineBreakWidth&&t.currentLineInfo.width+t.currentStringDrawInfo.width>0},e.prototype._isDifferentRubyOptions=function(t,e){return t.rubyFontSize!==e.rubyFontSize||t.rubyFont!==e.rubyFont||t.rubyGap!==e.rubyGap||t.rubyAlign!==e.rubyAlign},e.prototype._calcStandardOffsetY=function(t){var e="M",i=t.glyphForCharacter(e.charCodeAt(0));return i.offsetY},e.prototype._breakLine=function(t,e,i){if(!this.lineBreakRule)return this._flushCurrentStringDrawInfo(t),void this._feedLine(t);var r=this.lineBreakRule(e,i),n=r-i;if(0===n)this._flushCurrentStringDrawInfo(t),this._feedLine(t);else if(n>0)t.reservedLineBreakPosition=n;else{this._flushCurrentStringDrawInfo(t);for(var o=[];0>n;){var s=t.currentLineInfo.fragmentDrawInfoArray,h=s[s.length-1];if(h instanceof a.RubyFragmentDrawInfo)n++,o.push(h),s.pop();else if(-n>=h.text.length)n+=h.text.length,o.push(h),s.pop();else{var u=h.glyphs.splice(n),f=this.fontSize/this.font.size,y=u.reduce(function(t,e){return e.advanceWidth*f+t},0);h.width-=y;var l=h.text.substring(h.text.length+n);h.text=h.text.substring(0,h.text.length+n),o.push(new a.StringDrawInfo(l,y,u)),n=0}}var b=0,p="";o.forEach(function(t){b+=t.width,p+=t.text}),t.currentLineInfo.width-=b;var c=t.currentLineInfo.sourceText;t.currentLineInfo.sourceText=c.substr(0,c.length-p.length),this._feedLine(t),t.currentLineInfo.fragmentDrawInfoArray=o,t.currentLineInfo.width=b,t.currentLineInfo.sourceText=p}},e}(g.CacheableE);i.exports=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-label/lib/RubyParser.js"] = function(g) {
			!function(e,n,r,t,u){"use strict";function o(e,n){return Array.prototype.concat.apply([],e.map(n))}Object.defineProperty(e,"__esModule",{value:!0});var a;!function(e){e[e.Center=0]="Center",e[e.SpaceAround=1]="SpaceAround"}(a=e.RubyAlign||(e.RubyAlign={})),e.flatmap=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-label/lib/index.js"] = function(g) {
			!function(e,r,a,u,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Label=r("./Label"),e.FragmentDrawInfo=r("./FragmentDrawInfo"),e.RubyParser=r("./RubyParser"),e.RubyAlign=e.RubyParser.RubyAlign;var n=r("./DefaultRubyParser");e.defaultRubyParser=n.parse}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-timeline/lib/ActionType.js"] = function(g) {
			!function(e,n,u,l,t){"use strict";var o;!function(e){e[e.Wait=0]="Wait",e[e.Call=1]="Call",e[e.TweenTo=2]="TweenTo",e[e.TweenBy=3]="TweenBy",e[e.TweenByMult=4]="TweenByMult",e[e.Cue=5]="Cue",e[e.Every=6]="Every"}(o||(o={})),u.exports=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-timeline/lib/Easing.js"] = function(g) {
			!function(n,t,e,u,r){"use strict";var a;!function(n){function t(n,t,e,u){return e*n/u+t}function e(n,t,e,u){return n/=u,e*n*n+t}function u(n,t,e,u){return n/=u,-e*n*(n-2)+t}function r(n,t,e,u){return n/=u/2,1>n?e/2*n*n+t:(--n,-e/2*(n*(n-2)-1)+t)}function a(n,t,e,u){return n/=u,e*n*n*n+t}function i(n,t,e,u){return n/=u,--n,e*(n*n*n+1)+t}function c(n,t,e,u){return n/=u/2,1>n?e/2*n*n*n+t:(n-=2,e/2*(n*n*n+2)+t)}function o(n,t,e,u){return n/=u,e*n*n*n*n+t}function s(n,t,e,u){return n/=u,--n,-e*(n*n*n*n-1)+t}function f(n,t,e,u){return n/=u,e*n*n*n*n*n+t}function I(n,t,e,u){return n/=u,--n,e*(n*n*n*n*n+1)+t}function O(n,t,e,u){return n/=u/2,1>n?e/2*n*n*n*n*n+t:(n-=2,e/2*(n*n*n*n*n+2)+t)}function h(n,t,e,u){return-e*Math.cos(n/u*(Math.PI/2))+e+t}function M(n,t,e,u){return e*Math.sin(n/u*(Math.PI/2))+t}function Q(n,t,e,u){return-e/2*(Math.cos(Math.PI*n/u)-1)+t}function d(n,t,e,u){return e*Math.pow(2,10*(n/u-1))+t}function p(n,t,e,u){return n/=u/2,1>n?e/2*Math.pow(2,10*(n-1))+t:(--n,e/2*(-Math.pow(2,-10*n)+2)+t)}function b(n,t,e,u){return n/=u,-e*(Math.sqrt(1-n*n)-1)+t}function C(n,t,e,u){return n/=u,--n,e*Math.sqrt(1-n*n)+t}function g(n,t,e,u){return n/=u/2,1>n?-e/2*(Math.sqrt(1-n*n)-1)+t:(n-=2,e/2*(Math.sqrt(1-n*n)+1)+t)}n.linear=t,n.easeInQuad=e,n.easeOutQuad=u,n.easeInOutQuad=r,n.easeInCubic=a,n.easeInQubic=a,n.easeOutCubic=i,n.easeOutQubic=i,n.easeInOutCubic=c,n.easeInOutQubic=c,n.easeInQuart=o,n.easeOutQuart=s,n.easeInQuint=f,n.easeOutQuint=I,n.easeInOutQuint=O,n.easeInSine=h,n.easeOutSine=M,n.easeInOutSine=Q,n.easeInExpo=d,n.easeInOutExpo=p,n.easeInCirc=b,n.easeOutCirc=C,n.easeInOutCirc=g}(a||(a={})),e.exports=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-timeline/lib/Timeline.js"] = function(g) {
			!function(e,t,s,n,i){"use strict";var r=t("./Tween"),o=function(){function e(e){this._scene=e,this._tweens=[],this._fps=this._scene.game.fps,this.paused=!1,e.update.add(this._handler,this)}return e.prototype.create=function(e,t){var s=new r(e,t);return this._tweens.push(s),s},e.prototype.remove=function(e){var t=this._tweens.indexOf(e);0>t||this._tweens.splice(t,1)},e.prototype.clear=function(){this._tweens.length=0},e.prototype.destroy=function(){this._tweens.length=0,this._scene.destroyed()||this._scene.update.remove(this._handler,this),this._scene=void 0},e.prototype.destroyed=function(){return void 0===this._scene},e.prototype._handler=function(){if(0!==this._tweens.length&&!this.paused){for(var e=[],t=0;t<this._tweens.length;++t){var s=this._tweens[t];s.destroyed()||(s._fire(1e3/this._fps),e.push(s))}this._tweens=e}},e}();s.exports=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-timeline/lib/Tween.js"] = function(g) {
			!function(t,e,i,s,n){"use strict";var r=e("./Easing"),o=e("./ActionType"),a=function(){function t(t,e){this._target=t,this._stepIndex=0,this._loop=!!e&&!!e.loop,this._modifiedHandler=e&&e.modified?e.modified:void 0,this._destroyedHandler=e&&e.destroyed?e.destroyed:void 0,this._steps=[],this._lastStep=void 0,this._pararel=!1,this.paused=!1}return t.prototype.to=function(t,e,i){void 0===i&&(i=r.linear);var s={input:t,duration:e,easing:i,type:o.TweenTo,initialized:!1};return this._push(s),this},t.prototype.by=function(t,e,i,s){void 0===i&&(i=r.linear),void 0===s&&(s=!1);var n=s?o.TweenByMult:o.TweenBy,a={input:t,duration:e,easing:i,type:n,initialized:!1};return this._push(a),this},t.prototype.con=function(){return this._pararel=!0,this},t.prototype.wait=function(t){var e={duration:t,type:o.Wait,initialized:!1};return this._push(e),this},t.prototype.call=function(t){var e={func:t,type:o.Call,duration:0,initialized:!1};return this._push(e),this},t.prototype.pause=function(){var t=this;return this.call(function(){t.paused=!0})},t.prototype.cue=function(t){var e=Object.keys(t);e.sort(function(t,e){return Number(t)>Number(e)?1:-1});for(var i=[],s=0;s<e.length;++s)i.push({time:Number(e[s]),func:t[e[s]]});var n={type:o.Cue,duration:Number(e[e.length-1]),cue:i,initialized:!1};return this._push(n),this},t.prototype.every=function(t,e,i){void 0===i&&(i=r.linear);var s={func:t,type:o.Every,easing:i,duration:e,initialized:!1};return this._push(s),this},t.prototype.fadeIn=function(t,e){return void 0===e&&(e=r.linear),this.to({opacity:1},t,e)},t.prototype.fadeOut=function(t,e){return void 0===e&&(e=r.linear),this.to({opacity:0},t,e)},t.prototype.moveTo=function(t,e,i,s){return void 0===s&&(s=r.linear),this.to({x:t,y:e},i,s)},t.prototype.moveBy=function(t,e,i,s){return void 0===s&&(s=r.linear),this.by({x:t,y:e},i,s)},t.prototype.moveX=function(t,e,i){return void 0===i&&(i=r.linear),this.to({x:t},e,i)},t.prototype.moveY=function(t,e,i){return void 0===i&&(i=r.linear),this.to({y:t},e,i)},t.prototype.rotateTo=function(t,e,i){return void 0===i&&(i=r.linear),this.to({angle:t},e,i)},t.prototype.rotateBy=function(t,e,i){return void 0===i&&(i=r.linear),this.by({angle:t},e,i)},t.prototype.scaleTo=function(t,e,i,s){return void 0===s&&(s=r.linear),this.to({scaleX:t,scaleY:e},i,s)},t.prototype.scaleBy=function(t,e,i,s){return void 0===s&&(s=r.linear),this.by({scaleX:t,scaleY:e},i,s,!0)},t.prototype.destroyed=function(){var t=!1;return this._destroyedHandler&&(t=this._destroyedHandler.call(this._target)),t||(t=this._stepIndex>=this._steps.length&&!this._loop),t},t.prototype._fire=function(t){if(0!==this._steps.length&&!this.destroyed()&&!this.paused){if(this._stepIndex>=this._steps.length){if(!this._loop)return;this._stepIndex=0}for(var e=this._steps[this._stepIndex],i=!1,s=0;s<e.length;++s){var n=e[s];if(n.initialized||this._initAction(n),!n.finished){switch(n.elapsed+=t,n.type){case o.Call:n.func.call(this._target);break;case o.Every:var r=n.easing(n.elapsed,0,1,n.duration);r>1&&(r=1),n.func.call(this._target,n.elapsed,r);break;case o.TweenTo:case o.TweenBy:case o.TweenByMult:for(var a=Object.keys(n.goal),p=0;p<a.length;++p){var d=a[p];n.elapsed>=n.duration?this._target[d]=n.goal[d]:this._target[d]=n.easing(n.elapsed,n.start[d],n.goal[d]-n.start[d],n.duration)}break;case o.Cue:var h=n.cue[n.cueIndex];void 0!==h&&n.elapsed>=h.time&&(h.func.call(this._target),++n.cueIndex)}this._modifiedHandler&&this._modifiedHandler.call(this._target),n.elapsed>=n.duration?n.finished=!0:i=!0}}if(!i){for(var u=0;u<e.length;++u)e[u].initialized=!1;++this._stepIndex}}},t.prototype.serializeState=function(){for(var t={_stepIndex:this._stepIndex,_steps:[]},e=0;e<this._steps.length;++e){t._steps[e]=[];for(var i=0;i<this._steps[e].length;++i)t._steps[e][i]={input:this._steps[e][i].input,start:this._steps[e][i].start,goal:this._steps[e][i].goal,duration:this._steps[e][i].duration,elapsed:this._steps[e][i].elapsed,type:this._steps[e][i].type,cueIndex:this._steps[e][i].cueIndex,initialized:this._steps[e][i].initialized,finished:this._steps[e][i].finished}}return t},t.prototype.deserializeState=function(t){this._stepIndex=t._stepIndex;for(var e=0;e<t._steps.length;++e)for(var i=0;i<t._steps[e].length;++i)t._steps[e][i]&&this._steps[e][i]&&(this._steps[e][i].input=t._steps[e][i].input,this._steps[e][i].start=t._steps[e][i].start,this._steps[e][i].goal=t._steps[e][i].goal,this._steps[e][i].duration=t._steps[e][i].duration,this._steps[e][i].elapsed=t._steps[e][i].elapsed,this._steps[e][i].type=t._steps[e][i].type,this._steps[e][i].cueIndex=t._steps[e][i].cueIndex,this._steps[e][i].initialized=t._steps[e][i].initialized,this._steps[e][i].finished=t._steps[e][i].finished)},t.prototype._push=function(t){if(this._pararel)this._lastStep.push(t);else{var e=this._steps.push([t])-1;this._lastStep=this._steps[e]}this._pararel=!1},t.prototype._initAction=function(t){if(t.elapsed=0,t.start={},t.goal={},t.cueIndex=0,t.finished=!1,t.initialized=!0,t.type===o.TweenTo||t.type===o.TweenBy||t.type===o.TweenByMult)for(var e=Object.keys(t.input),i=0;i<e.length;++i){var s=e[i];void 0!==this._target[s]&&(t.start[s]=this._target[s],t.type===o.TweenTo?t.goal[s]=t.input[s]:t.type===o.TweenBy?t.goal[s]=t.start[s]+t.input[s]:t.type===o.TweenByMult&&(t.goal[s]=t.start[s]*t.input[s]))}},t}();i.exports=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@akashic-extension/akashic-timeline/lib/index.js"] = function(g) {
			!function(e,i,n,l,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Timeline=i("./Timeline"),e.Tween=i("./Tween"),e.Easing=i("./Easing")}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@pocketberserker/akashic-pagination/lib/LabelButton.js"] = function(g) {
			!function(e,t,n,o,i){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(t){var n=e.call(this,{scene:t.scene,width:t.width,height:t.image.height,backgroundImage:t.image,backgroundEffector:t.image&&new g.NinePatchSurfaceEffector(t.scene.game),touchable:!0})||this;n.onClick=new g.Trigger;var o=t.font?t.font:new g.DynamicFont({game:t.scene.game,fontFamily:g.FontFamily.SansSerif,size:15});return n.label=new g.Label({scene:t.scene,font:o,text:t.text,fontSize:t.fontSize?t.fontSize:18,textColor:"white"}),n.label.aligning(n.width,g.TextAlign.Center),n.label.invalidate(),n.append(n.label),n.pointUp.add(n.onPointUp,n),n}return r(t,e),t.prototype.destroy=function(){this.onClick.destroy(),this.onClick=null,this.label=null,e.prototype.destroy.call(this)},t.prototype.onPointUp=function(e){this.onClick.fire()},t}(g.Pane);e.LabelButton=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@pocketberserker/akashic-pagination/lib/Pagination.js"] = function(g) {
			!function(t,e,i,n,o){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r,h=e("./LabelButton"),a=e("./createDefaultButtonImage");!function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom"}(r=t.Position||(t.Position={}));var l=function(t){function e(e){var i=t.call(this,e)||this;return i._limit=e.limit,i.offset=0,i._width=i.width,i.padding=e.padding,i.lastOffset=0,i.touchable=!0,i}return s(e,t),e.prototype.append=function(e){if(this.children){var i=this.children[this.children.length-1];this.children.length%this.limit===0?e.x=i.x+i.width+this.padding+e.x:this.children.length%this._limit.horizontal===0?(e.x=this.children[this.children.length-this._limit.horizontal].x,e.y=i.y+i.height+e.y):(e.x=i.x+i.width+this.padding+e.x,e.y=i.y)}t.prototype.append.call(this,e);var n=Math.floor(this.children.length/this.limit);this.lastOffset=this.children.length%this.limit===0?n-1:n},e.prototype.previous=function(){this.offset>0&&this.move(this.offset-1)},e.prototype.next=function(){this.offset<this.lastOffset&&this.move(this.offset+1)},e.prototype.first=function(){this.offset>0&&this.move(0)},e.prototype.last=function(){this.offset<this.lastOffset&&this.move(this.lastOffset)},e.prototype.move=function(t){if(this.offset!==t&&t>=0&&t<=this.lastOffset){var e=this.offset;this.x=this.x+this._width*(e-t),this.offset=t,this.modified()}},e.prototype.modified=function(e){this.destroyed||this.resize(),t.prototype.modified.call(this,e)},Object.defineProperty(e.prototype,"limit",{get:function(){return this._limit.vertical*this._limit.horizontal},enumerable:!0,configurable:!0}),e.prototype.resize=function(){var t=this.children[this.children.length-1];this.width=Math.max(this.width,t.x+t.width)},e}(g.E);t.PaginationContent=l;var f=function(t){function e(e){var i=t.call(this,e)||this;(void 0===e.previous||void 0===e.next||e.first===!0||e.last===!0)&&(i._image=a.createDefaultButtonImage(e.scene.game,i.width/4,24,"rgba(164, 164, 164, 0.7)"));var n;switch(e.position){case r.Top:n=e.previous?e.previous.height:i._image.height;break;default:n=0}i._content=new l({scene:e.scene,width:e.width,height:e.height,y:n,limit:e.limit,padding:e.paddingRight}),i.append(i._content),i.touchable=!0;var o=Math.round(e.width/4);i.previous=e.previous?e.previous:new h.LabelButton({scene:e.scene,width:o,text:"<",image:i._image}),i.previous.onClick.add(function(){return i._content.previous()},i),i.previous.x=e.width/4;var s;switch(e.position){case r.Top:s=0;break;case r.Bottom:s=e.height-i.previous.height}return i.previous.y=s,i.append(i.previous),i.next=e.next?e.next:new h.LabelButton({scene:e.scene,width:o,text:">",image:i._image}),i.next.onClick.add(function(){return i._content.next()},i),i.next.x=e.width/2,i.next.y=s,i.append(i.next),e.first&&(i.first=e.first===!0?new h.LabelButton({scene:e.scene,width:o,text:"|<",image:i._image}):e.first,i.first.onClick.add(function(){return i._content.first()},i),i.first.x=0,i.first.y=s,i.append(i.first)),e.last&&(i.last=e.last===!0?new h.LabelButton({scene:e.scene,width:o,text:">|",image:i._image}):e.last,i.last.onClick.add(function(){return i._content.last()},i),i.last.x=e.width/4*3,i.last.y=s,i.append(i.last)),i}return s(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),e.prototype.moveOffset=function(t){this._content.move(t)},e.prototype.destroy=function(){this.previous=null,this.next=null,this.first=null,this.last=null,this._content=null,this._image&&(this._image.destroy(),this._image=null),t.prototype.destroy.call(this)},e}(g.Pane);t.Pagination=f}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@pocketberserker/akashic-pagination/lib/createDefaultButtonImage.js"] = function(g) {
			!function(e,r,t,u,n){"use strict";function o(e,r,t,u){var n=Math.round(r),o=Math.round(t),a=e.resourceFactory.createSurface(n,o),c=a.renderer();return c.begin(),c.fillRect(0,0,n,o,u),c.end(),a}Object.defineProperty(e,"__esModule",{value:!0}),e.createDefaultButtonImage=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@pocketberserker/akashic-pagination/lib/index.js"] = function(g) {
			!function(e,n,o,r,t){"use strict";function i(n){for(var o in n)e.hasOwnProperty(o)||(e[o]=n[o])}Object.defineProperty(e,"__esModule",{value:!0}),i(n("./LabelButton")),i(n("./Pagination"))}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@xnv/akashic-scrollable/lib/NinePatchHorizontalScrollbar.js"] = function(g) {
			!function(t,i,e,a,n){"use strict";var h=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var a in i)i.hasOwnProperty(a)&&(t[a]=i[a]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},o=function(t){function i(i){var e=t.call(this,{scene:i.scene,width:0,height:i.bgImage?i.bgImage.height:i.image.height,backgroundImage:i.bgImage,backgroundEffector:i.bgImage&&new g.NinePatchSurfaceEffector(i.scene.game,Math.floor(i.bgImage.height/2)),touchable:!0})||this;return e.onChangeBarPositionRate=new g.Trigger,e._bar=new g.Pane({scene:i.scene,parent:e,width:0,height:i.bgImage?i.bgImage.height:i.image.height,backgroundImage:i.image,backgroundEffector:new g.NinePatchSurfaceEffector(i.scene.game,Math.floor(i.image.height/2)),touchable:!0}),e._barImage=i.image,e._contentLength=0,e._deltaOrigin=0,e._delta=0,e.pointDown.add(e._handlePointDown,e),e._bar.pointDown.add(e._handleBarPointDown,e),e._bar.pointMove.add(e._handleBarPointMove,e),e}return h(i,t),i.prototype.destroy=function(){this.onChangeBarPositionRate.destroy(),this.onChangeBarPositionRate=null,this._bar=null,this._barImage=null,this._contentLength=0,t.prototype.destroy.call(this)},i.prototype.setBarProperties=function(t,i,e){null!=i&&this._contentLength!==i&&(this._contentLength=i),null!=e&&this.width!==e&&(this.width=e,this.invalidate());var a=0;this.width<this._contentLength&&(a=Math.floor(Math.max(this.width*this.width/this._contentLength,this._barImage.width)));var n=Math.floor(Math.max(t*this.width));this._bar.width!==a&&(this._bar.width=a,this._bar.invalidate()),this._bar.x!==n&&(this._bar.x=n,this._bar.modified(),this._deltaOrigin=this._bar.x,this._delta=0)},i.prototype._handlePointDown=function(t){t.point.x<this._bar.x?this._changePositionRate(this._bar.x-this._bar.width):t.point.x>this._bar.x+this._bar.width&&this._changePositionRate(this._bar.x+this._bar.width)},i.prototype._handleBarPointDown=function(t){this._deltaOrigin=this._bar.x,this._delta=0},i.prototype._handleBarPointMove=function(t){this._delta+=t.prevDelta.x,this._changePositionRate(this._deltaOrigin+this._delta)},i.prototype._changePositionRate=function(t){var i=this.width-this._bar.width,e=Math.min(Math.max(t,0),i);this._bar.x!==e&&(this._bar.x=e,this._bar.modified(),this.onChangeBarPositionRate.fire(e/this.width))},i}(g.Pane);t.NinePatchHorizontalScrollbar=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@xnv/akashic-scrollable/lib/NinePatchVerticalScrollbar.js"] = function(g) {
			!function(t,e,i,a,h){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=function(t){function e(e){var i=t.call(this,{scene:e.scene,width:e.bgImage?e.bgImage.width:e.image.width,height:0,backgroundImage:e.bgImage,backgroundEffector:e.bgImage&&new g.NinePatchSurfaceEffector(e.scene.game,Math.floor(e.bgImage.width/2)),touchable:!0})||this;return i.onChangeBarPositionRate=new g.Trigger,i._bar=new g.Pane({scene:e.scene,parent:i,width:e.bgImage?e.bgImage.width:e.image.width,height:0,backgroundImage:e.image,backgroundEffector:new g.NinePatchSurfaceEffector(e.scene.game,Math.floor(e.image.width/2)),touchable:!0}),i._barImage=e.image,i._contentLength=0,i._deltaOrigin=0,i._delta=0,i.pointDown.add(i._handlePointDown,i),i._bar.pointDown.add(i._handleBarPointDown,i),i._bar.pointMove.add(i._handleBarPointMove,i),i}return n(e,t),e.prototype.destroy=function(){this.onChangeBarPositionRate.destroy(),this.onChangeBarPositionRate=null,this._bar=null,this._barImage=null,this._contentLength=0,t.prototype.destroy.call(this)},e.prototype.setBarProperties=function(t,e,i){null!=e&&this._contentLength!==e&&(this._contentLength=e),null!=i&&this.height!==i&&(this.height=i,this.invalidate());var a=0;this.height<this._contentLength&&(a=Math.floor(Math.max(this.height*this.height/this._contentLength,this._barImage.height)));var h=Math.floor(Math.max(t*this.height));this._bar.height!==a&&(this._bar.height=a,this._bar.invalidate()),this._bar.y!==h&&(this._bar.y=h,this._bar.modified(),this._deltaOrigin=this._bar.y,this._delta=0)},e.prototype._handlePointDown=function(t){t.point.y<this._bar.y?this._changePositionRate(this._bar.y-this._bar.height):t.point.y>this._bar.y+this._bar.height&&this._changePositionRate(this._bar.y+this._bar.height)},e.prototype._handleBarPointDown=function(t){this._deltaOrigin=this._bar.y,this._delta=0},e.prototype._handleBarPointMove=function(t){this._delta+=t.prevDelta.y,this._changePositionRate(this._deltaOrigin+this._delta)},e.prototype._changePositionRate=function(t){var e=this.height-this._bar.height,i=Math.min(Math.max(t,0),e);this._bar.y!==i&&(this._bar.y=i,this._bar.modified(),this.onChangeBarPositionRate.fire(i/this.height))},e}(g.Pane);t.NinePatchVerticalScrollbar=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@xnv/akashic-scrollable/lib/NullScrollbar.js"] = function(g) {
			!function(t,o,e,r,n){"use strict";var i=this&&this.__extends||function(t,o){function e(){this.constructor=t}for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r]);t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)},s=function(t){function o(o){var e=t.call(this,o)||this;return e.onChangeBarPositionRate=new g.Trigger,e}return i(o,t),o.prototype.destroy=function(){this.onChangeBarPositionRate.destroy(),this.onChangeBarPositionRate=null,t.prototype.destroy.call(this)},o.prototype.setBarProperties=function(t,o,e){},o}(g.E);t.NullScrollbar=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@xnv/akashic-scrollable/lib/Scrollable.js"] = function(g) {
			!function(t,e,i,n,r){"use strict";var o=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},s=e("./createDefaultScrollbarImage"),a=e("./NullScrollbar"),h=e("./NinePatchVerticalScrollbar"),l=e("./NinePatchHorizontalScrollbar"),c=function(){function t(t){this._buf=new Array(t),this._i=0,this._disposed=null}return t.prototype.addDelta=function(t){this._buf[this._i]=t,this._i=(this._i+1)%this._buf.length,this._i===this._disposed&&(this._disposed=null)},t.prototype.average=function(){for(var t=0,e=0,i=0,n=null!=this._disposed?this._disposed:(this._i+1)%this._buf.length;n!==this._i;n=(n+1)%this._buf.length)t+=this._buf[n].x,e+=this._buf[n].y,++i;return i>0?{x:t/i,y:e/i}:{x:0,y:0}},t.prototype.reset=function(){this._disposed=this._i},t}(),d=function(t){function e(e){var i=t.call(this,e)||this;return i.onModified=new g.Trigger,i}return o(e,t),e.prototype.destroy=function(){this.onModified.destroy(),this.onModified=null,t.prototype.destroy.call(this)},e.prototype.modified=function(e){return this.onModified&&this.onModified.fire(),t.prototype.modified.call(this,e)},e}(g.E);t.ScrolledContent=d;var u=function(t){function e(e){var i=t.call(this,e)||this;return i.onContentModified=new g.Trigger,i._offsetContainer=new g.E({scene:e.scene,parent:i}),i._content=new d({scene:e.scene,parent:i._offsetContainer}),i._content.onModified.add(i.onContentModified.fire,i.onContentModified),i}return o(e,t),e.prototype.destroy=function(){this.onContentModified.destroy(),this.onContentModified=null,t.prototype.destroy.call(this)},e.prototype.offsetContainer=function(){return this._offsetContainer},e.prototype.content=function(){return this._content},e}(g.E);t.ScrolledContentContainer=u;var _;!function(t){function e(t){return t}function i(t){return t*t}function n(t){return-t*(t-2)}function r(t){return.5>t?t*t*2:-((2*t-1)*(2*t-3)-1)/2}function o(t){return t*t*t}function s(t){return(t-1)*(t-1)*(t-1)+1}function a(t){return.5>t?t*t*t*4:((2*t-2)*(2*t-2)*(2*t-2)+2)/2}function h(t){return-Math.cos(t*(Math.PI/2))+1}function l(t){return Math.sin(t*(Math.PI/2))}function c(t){return-(Math.cos(Math.PI*t)-1)/2}t.Linear=e,t.EaseInQuad=i,t.EaseOutQuad=n,t.EaseInOutQuad=r,t.EaseInQubic=o,t.EaseOutQubic=s,t.EaseInOutQubic=a,t.EaseInSine=h,t.EaseOutSine=l,t.EaseInOutSine=c}(_=t.EasingFunction||(t.EasingFunction={}));var f=function(t){function e(e){var i=t.call(this,e)||this;return i._bgImage=null,i._barImage=null,i._isVertical=!!e.vertical,i._isHorizontal=!!e.horizontal,i._touchScroll=!!e.touchScroll,i._momentumScroll=null!=e.momentumScroll?e.momentumScroll:!0,i._insetBars=!!e.insetBars,i._extraDrawSize=100,i._extraDrawOffsetX=i._extraDrawSize,i._extraDrawOffsetY=i._extraDrawSize,i._contentContainer=new u({scene:e.scene,parent:i}),i._horizontalBar=new a.NullScrollbar({scene:e.scene,parent:i}),i._verticalBar=null,(e.vertical===!0||e.horizontal===!0)&&(i._bgImage=s.createDefaultScrollbarImage(e.scene.game,7,"rgba(255, 255, 255, 0.2)",4,"rgba(218, 218, 218, 0.5)"),i._barImage=s.createDefaultScrollbarImage(e.scene.game,7,"rgba(255, 255, 255, 0.5)",4,"rgba(164, 164, 164, 0.7)")),i._verticalBar=e.vertical===!0?new h.NinePatchVerticalScrollbar({scene:e.scene,bgImage:i._bgImage,image:i._barImage}):e.vertical?e.vertical:new a.NullScrollbar({scene:e.scene}),i._verticalBar.x=i._insetBars?i.width-i._verticalBar.width:i.width,i.append(i._verticalBar),i._verticalBar.onChangeBarPositionRate.add(i._handleOnChangeVerticalPositionRate,i),i._horizontalBar=e.horizontal===!0?new l.NinePatchHorizontalScrollbar({scene:e.scene,bgImage:i._bgImage,image:i._barImage}):e.horizontal?e.horizontal:new a.NullScrollbar({scene:e.scene}),i._horizontalBar.y=i._insetBars?i.height-i._horizontalBar.height:i.height,i.append(i._horizontalBar),i._horizontalBar.onChangeBarPositionRate.add(i._handleOnChangeHorizontalPositionRate,i),i._surface=null,i._renderer=null,i._isCached=!1,i._renderedCamera=null,i._renderOffsetX=0,i._renderOffsetY=0,i._contentBoundingWidth=0,i._contentBoundingHeight=0,i._isUpdateBoundingRectRequested=!1,i._isUpdateContentScrollRequested=!1,i._isUpdateScrollbarRequested=!1,i._isFlushRequested=!1,i._lastNotifiedVerticalRate=null,i._lastNotifiedHorizontalRate=null,i._deltaX=0,i._deltaY=0,i._apiRequestedOffsetX=null,i._apiRequestedOffsetY=null,i._beforeWidth=e.width,i._beforeHeight=e.height,i._frameTasks=[],i._momentumBuffer=new c(3),i._contentContainer.onContentModified.add(i._handleContentModified,i),i._touchScroll&&(i.touchable=!0,i.pointDown.add(i._handlePointDown,i),i.pointMove.add(i._handlePointMove,i),i.pointUp.add(i._handlePointUp,i)),i._requestUpdateBoundingRect(),i._requestUpdateScrollbar(),i}return o(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._contentContainer.content()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollOffsetX",{get:function(){return-this._contentContainer.offsetContainer().x},set:function(t){this._apiRequestedOffsetX=-t,this._requestUpdateContentScroll(),this._requestUpdateScrollbar()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollOffsetY",{get:function(){return-this._contentContainer.offsetContainer().y},set:function(t){this._apiRequestedOffsetY=-t,this._requestUpdateContentScroll(),this._requestUpdateScrollbar()},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._contentContainer=null,this._horizontalBar=null,this._verticalBar=null,this._surface&&(this._surface.destroy(),this._surface=null),this._renderer=null,this._isCached=!1,this._renderedCamera=null,this._renderOffsetX=0,this._renderOffsetY=0,this._bgImage&&(this._bgImage.destroy(),this._bgImage=null),this._barImage&&(this._barImage.destroy(),this._barImage=null),t.prototype.destroy.call(this)},e.prototype.getScrollOffsetPercentX=function(){this._flushModification();var t=this._contentBoundingWidth-this.width;return t>0?100*this.scrollOffsetX/t:0},e.prototype.setScrollOffsetPercentX=function(t){this._flushModification();var e=Math.max(this._contentBoundingWidth-this.width,0);this.scrollOffsetX=Math.floor(t*e/100)},e.prototype.getScrollOffsetPercentY=function(){this._flushModification();var t=this._contentBoundingHeight-this.height;return t>0?100*this.scrollOffsetY/t:0},e.prototype.setScrollOffsetPercentY=function(t){this._flushModification();var e=Math.max(this._contentBoundingHeight-this.height,0);this.scrollOffsetY=Math.floor(t*e/100)},e.prototype.scrollToX=function(t,e,i){this._addFrameTask({type:"scroll",origX:-this._contentContainer.offsetContainer().x,x:t,duration:e,easing:i,count:0})},e.prototype.scrollToY=function(t,e,i){this._addFrameTask({type:"scroll",origY:-this._contentContainer.offsetContainer().y,y:t,duration:e,easing:i,count:0})},e.prototype.scrollToPercentX=function(t,e,i){this._addFrameTask({type:"scroll",origX:-this._contentContainer.offsetContainer().x,perX:t,duration:e,easing:i,count:0})},e.prototype.scrollToPercentY=function(t,e,i){this._addFrameTask({type:"scroll",origY:-this._contentContainer.offsetContainer().y,perY:t,duration:e,easing:i,count:0})},e.prototype.renderSelf=function(t,e){if(this._renderedCamera!==e&&(this._isCached=!1,this._renderedCamera=e),this._isCached||this._renderCache(e),this.children)for(var i=this.children,n=0;n<i.length;++n)if(i[n]===this._contentContainer){if(this._surface&&this.width>0&&this.height>0){var r=this._extraDrawOffsetX-this._renderOffsetX,o=this._extraDrawOffsetY-this._renderOffsetY;t.drawImage(this._surface,r,o,this.width,this.height,0,0)}}else i[n].render(t,e);return!1},e.prototype.modified=function(e){e&&(this._isCached=!1);var i=!1;this.width!==this._beforeWidth&&(i=!0,this._beforeWidth=this.width,this._verticalBar&&(this._verticalBar.x=this._insetBars?this.width-this._verticalBar.width:this.width,this._verticalBar.modified())),this.height!==this._beforeHeight&&(i=!0,this._beforeHeight=this.height,this._horizontalBar&&(this._horizontalBar.y=this._insetBars?this.height-this._horizontalBar.height:this.height,this._horizontalBar.modified())),i&&(this._requestUpdateContentScroll(),this._requestUpdateScrollbar()),t.prototype.modified.call(this,e)},e.prototype.shouldFindChildrenByPoint=function(t){var e=this.width+(this._insetBars?0:this._verticalBar.width),i=this.height+(this._insetBars?0:this._horizontalBar.height);return 0<=t.x&&t.x<e&&0<=t.y&&t.y<i},e.prototype._addFrameTask=function(t){this._frameTasks.push(t),1===this._frameTasks.length&&this._contentContainer.update.add(this._onUpdate,this)},e.prototype._cancelFrameTask=function(t){for(var e=0;e<this._frameTasks.length;++e){var i=this._frameTasks[e];i.type===t&&(i.done=!0)}},e.prototype._onUpdate=function(){for(var t=0;t<this._frameTasks.length;++t){var e=this._frameTasks[t];switch(e.done&&this._frameTasks.splice(t,1),++e.count,e.type){case"momentum":var i=Math.pow(.9,e.count),n={x:e.x*i,y:e.y*i};e.done=(!this._isHorizontal||Math.abs(n.x)<.1)&&(!this._isVertical||Math.abs(n.y)<.1),this._addScrollDelta(n);break;case"scroll":this._flushModification();var r=Math.min(1e3*e.count/(e.duration*this.scene.game.fps),1),o=e.easing?e.easing(r):r;if(null!=e.x||null!=e.perX){var s=null!=e.x?e.x:e.perX*Math.max(this._contentBoundingWidth-this.width,0)/100,a=e.origX+o*(s-e.origX);this.scrollOffsetX=a}if(null!=e.y||null!=e.perY){var h=null!=e.y?e.y:e.perY*Math.max(this._contentBoundingHeight-this.height,0)/100,l=e.origY+o*(h-e.origY);this.scrollOffsetY=l}e.done=1===r;break;default:throw new Error("Scrollable#_onUpdate: never reach")}}0===this._frameTasks.length&&this._contentContainer.update.remove(this._onUpdate,this)},e.prototype._handleContentModified=function(){this._requestUpdateBoundingRect()},e.prototype._handleOnChangeVerticalPositionRate=function(t){this._lastNotifiedVerticalRate=t,this._requestUpdateContentScroll()},e.prototype._handleOnChangeHorizontalPositionRate=function(t){this._lastNotifiedHorizontalRate=t,this._requestUpdateContentScroll()},e.prototype._handlePointDown=function(t){this._cancelFrameTask("momentum"),this._momentumBuffer.reset()},e.prototype._handlePointMove=function(t){this._addScrollDelta(t.prevDelta),this._momentumBuffer.addDelta(t.prevDelta)},e.prototype._handlePointUp=function(t){if(this._momentumScroll){var e=this._momentumBuffer.average();(this._isHorizontal&&Math.abs(e.x)>2||this._isVertical&&Math.abs(e.y)>2)&&this._addFrameTask({type:"momentum",x:e.x,y:e.y,count:0})}},e.prototype._addScrollDelta=function(t){this._deltaX+=t.x,this._deltaY+=t.y,this._requestUpdateScrollbar(),this._requestUpdateContentScroll(),this.modified()},e.prototype._requestUpdateBoundingRect=function(){this._isUpdateBoundingRectRequested||(this._isUpdateBoundingRectRequested=!0,this._requestFlushModification())},e.prototype._requestUpdateScrollbar=function(){this._isUpdateScrollbarRequested||(this._isUpdateScrollbarRequested=!0,this._requestFlushModification())},e.prototype._requestUpdateContentScroll=function(){this._isUpdateContentScrollRequested||(this._isUpdateContentScrollRequested=!0,this._requestFlushModification())},e.prototype._requestFlushModification=function(){var t=this;this._isFlushRequested||(this._isFlushRequested=!0,this.scene.game._callSceneAssetHolderHandler({callHandler:function(){t.destroyed()||t._flushModification()}}))},e.prototype._flushModification=function(){if(this._isFlushRequested){this._isFlushRequested=!1;var t=!1;this._isUpdateBoundingRectRequested&&(this._isUpdateBoundingRectRequested=!1,t=this._updateBoundingRect()),(t||this._isUpdateContentScrollRequested)&&(this._isUpdateContentScrollRequested=!1,this._updateContentScroll()),(t||this._isUpdateScrollbarRequested)&&(this._isUpdateScrollbarRequested=!1,this._updateScrollBar())}},e.prototype._updateBoundingRect=function(){var t=this._calculateBoundingRectSize(),e=!1;return this._contentBoundingWidth!==t.width&&(this._contentBoundingWidth=t.width,e=!0),this._contentBoundingHeight!==t.height&&(this._contentBoundingHeight=t.height,e=!0),e},e.prototype._calculateBoundingRectSize=function(){var t=this._contentContainer.content(),e=t.calculateBoundingRect(),i=e.right-e.left,n=e.bottom-e.top;return{width:i,height:n}},e.prototype._updateContentScroll=function(){var t=this._contentContainer.offsetContainer(),e=this._lastNotifiedVerticalRate,i=this._lastNotifiedHorizontalRate,n=this._deltaX,r=this._deltaY,o=this._apiRequestedOffsetX,s=this._apiRequestedOffsetY;if(this._lastNotifiedVerticalRate=null,this._lastNotifiedHorizontalRate=null,this._deltaX=0,this._deltaY=0,this._apiRequestedOffsetX=null,this._apiRequestedOffsetY=null,this._isHorizontal){var a=t.x,h=null!=o?o:a,l=0!==n?h+n:null!=i?-i*this._contentBoundingWidth:h,c=Math.max(Math.min(l,0),Math.min(this.width-this._contentBoundingWidth,0));t.x=c,this._renderOffsetX+=t.x-a}if(this._isVertical){var d=t.y,u=null!=s?s:d,_=0!==r?u+r:null!=e?-e*this._contentBoundingHeight:u,f=Math.max(Math.min(_,0),Math.min(this.height-this._contentBoundingHeight,0));t.y=f,this._renderOffsetY+=f-d}(Math.abs(this._renderOffsetX)>this._extraDrawSize||Math.abs(this._renderOffsetY)>this._extraDrawSize)&&(this._isCached=!1)},e.prototype._updateScrollBar=function(){var t=this._contentContainer.offsetContainer();this._horizontalBar.setBarProperties(-t.x/this._contentBoundingWidth,this._contentBoundingWidth,this.width),this._verticalBar.setBarProperties(-t.y/this._contentBoundingHeight,this._contentBoundingHeight,this.height)},e.prototype._renderCache=function(t){var e=Math.ceil(this.width+2*this._extraDrawSize),i=Math.ceil(this.height+2*this._extraDrawSize),n=!this._surface||this._surface.width<e||this._surface.height<i;n&&(this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this._surface=this.scene.game.resourceFactory.createSurface(e,i),this._renderer=this._surface.renderer()),this._renderer.begin(),n||this._renderer.clear(),this._renderer.save(),this._renderer.translate(this._extraDrawOffsetX,this._extraDrawOffsetY),this._contentContainer.render(this._renderer,t),this._renderer.restore(),this._renderOffsetX=0,this._renderOffsetY=0,this._renderer.end(),this._isCached=!0},e}(g.E);f.Easing=_,t.Scrollable=f}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@xnv/akashic-scrollable/lib/createDefaultScrollbarImage.js"] = function(g) {
			!function(e,r,a,t,c){"use strict";function n(e,r,a,t,c){for(var n=a-t;a+t>=n;++n){var o=t*Math.cos(Math.asin((a-n)/t));e.fillRect(r-o,n,2*o,1,c)}}function o(e,r,a,t,c){var o=e.resourceFactory.createSurface(2*r+1,2*r+1),u=o.renderer();return u.begin(),n(u,r,r,r,a),n(u,r,r,t,c),u.end(),o}e.drawCircle=n,e.createDefaultScrollbarImage=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@xnv/akashic-scrollable/lib/index.js"] = function(g) {
			!function(l,e,r,o,n){"use strict";function t(e){for(var r in e)l.hasOwnProperty(r)||(l[r]=e[r])}t(e("./NinePatchHorizontalScrollbar")),t(e("./NinePatchVerticalScrollbar")),t(e("./NullScrollbar")),t(e("./createDefaultScrollbarImage"));var a=e("./Scrollable");l.Scrollable=a.Scrollable,l.internal={ScrolledContentContainer:a.ScrolledContentContainer,ScrolledContent:a.ScrolledContent}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/config/lib/index.js"] = function(g) {
			!function(e,a,i,o,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("@cowlick/core"),m=18;e.defaultConfig=function(){return{window:{message:{ui:{layer:{name:s.LayerKind.message,x:10,y:10},width:g.game.width-20,height:g.game.height-20,touchable:!0},top:{x:30,y:20},marker:[]},system:[],priority:[["message",0],["choice",1],["system",2]]},font:{list:[new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:m})],color:"black",alreadyReadColor:"#4444FF",size:m},system:{maxSaveCount:100,messageSpeed:1e3/g.game.fps,autoMessageDuration:1500,alreadyRead:!1,realTimeDisplay:!1,autoSave:!0},audio:{voice:.5,se:.5,bgm:.5}}}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/Constant.js"] = function(g) {
			!function(e,a,o,i,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n;!function(e){e.choice="choice",e.image="image",e.frameImage="frameImage",e.pane="pane",e.jump="jump",e.text="text",e.layer="layer",e.playAudio="playAudio",e.changeVolume="changeVolume",e.stopAudio="stopAudio",e.playVideo="playVideo",e.stopVideo="stopVideo",e.click="click",e.skip="skip",e.button="button",e.trigger="trigger",e.save="save",e.load="load",e.evaluate="eval",e.link="link",e.openSaveScene="openSaveScene",e.openLoadScene="openLoadScene",e.closeLoadScene="closeLoadScene",e.condition="condition",e.backlog="backlog",e.removeLayer="removeLayer",e.removeLayers="removeLayers",e.clearCurrentVariables="clearCurrentVariables",e.clearSystemVariables="clearSystemVariables",e.fadeIn="fadeIn",e.fadeOut="fadeOut",e.timeout="timeout",e.ifElse="ifElse",e.exception="exception",e.slider="slider",e.autoMode="autoMode",e.messageSpeed="messageSpeed",e.font="font",e.realTimeDisplay="realTimeDisplay",e.extension="extension"}(n=e.Tag||(e.Tag={}));var r;!function(e){e.system="system",e.background="background",e.choice="choice",e.message="message",e.backlog="backlog"}(r=e.LayerKind||(e.LayerKind={}));var l;!function(e){e.selectedFont="selectedFont",e.autoMode="autoMode",e.autoMessageDuration="autoMessageDuration",e.messageSpeed="messageSpeed",e.fontSize="fontSize",e.fontColor="fontColor",e.realTimeDisplay="realTimeDisplay",e.alreadyRead="alreadyRead"}(l=e.BuiltinVariable||(e.BuiltinVariable={}));var s;!function(e){e.builtin="builtin",e.system="system",e.current="current"}(s=e.VariableType||(e.VariableType={}));var c;!function(e){e.voice="voice",e.se="se",e.bgm="bgm"}(c=e.AudioGroup||(e.AudioGroup={}))}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/Frame.js"] = function(g) {
			!function(e,r,t,u,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(e){this.scripts=e}return e}();e.Frame=n}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/GameError.js"] = function(g) {
			!function(t,r,e,o,n){"use strict";var u=this&&this.__extends||function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(t){function r(r,e){var o=this.constructor,n=t.call(this,r)||this;return Object.setPrototypeOf(n,o.prototype),n.data=e,n}return u(r,t),r}(Error);t.GameError=i}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/Scenario.js"] = function(g) {
			!function(e,t,n,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=t("./GameError"),s=function(){function e(e){this.index=0,this.scenes=e,this.onLoaded=new g.Trigger,this.logs=[]}return Object.defineProperty(e.prototype,"backlog",{get:function(){return this.logs},set:function(e){this.logs=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){if(this.index<this.scenes.length)return this.scenes[this.index];throw new o.GameError("scene not found",{index:this.index})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this.scene.frame},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t){var n=this.scenes.findIndex(function(e){return e.label===t.label});return n>-1?(this.index=n,void this.scenes[this.index].reset(t.frame)):(this.scenes.push(g._require(e,t.label)),void(this.index=this.scenes.length-1))},e.prototype.load=function(){var e=this.frame;if(!e)throw new o.GameError("frame not found",this.scene.index);this.pushLog(this.scene.index),this.onLoaded.fire(e)},e.prototype.next=function(){this.scene.next(),this.load()},e.prototype.findScene=function(e,t){var n=this.scenes.find(function(e){return e.label===t.label});return n?n:(n=g._require(e,t.label),n&&this.scenes.push(n),n)},e.prototype.clear=function(){this.logs=[],this.onLoaded.removeAll()},e.prototype.pushTextLog=function(e){var t=this.scene.index,n=this.logs.find(function(e){return e.frame===t});n&&(n.text=e)},e.prototype.createSaveData=function(e,t){var n={label:this.scene.label,variables:e,logs:this.logs.map(function(e){return{frame:e.frame}})};return t&&(n.description=t),n},e.prototype.pushLog=function(e){var t=this.logs.find(function(t){return t.frame===e});t||this.logs.push({frame:e})},e}();e.Scenario=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/Scene.js"] = function(g) {
			!function(e,t,n,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e){this._index=0,this._label=e.label,this.frames=e.frames}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._index<this.frames.length?this.frames[this._index]:void 0},enumerable:!0,configurable:!0}),e.prototype.next=function(){this._index<this.frames.length&&this._index++},e.prototype.reset=function(e){this._index=e?e:0},e}();e.Scene=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/Script.js"] = function(g) {
			!function(o,e,t,i,n){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var u;!function(o){o[o.Top=0]="Top",o[o.Bottom=1]="Bottom"}(u=o.Position||(o.Position={}))}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/AssetCollector.js"] = function(g) {
			!function(e,t,a,c,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("./Constant"),o=function(){function e(){this.assets=new Map}return e.prototype.collectFromScene=function(e){var t=this.assets.get(e.label);if(t)return t;for(var a=[],c=0,s=e.frames;c<s.length;c++){var r=s[c];a.push.apply(a,this.collect(r.scripts))}return this.assets.set(e.label,a),a},e.prototype.collect=function(e){for(var t=[],a=0,c=e;a<c.length;a++){var s=c[a];t.push.apply(t,this.collectScript(s))}return t},e.prototype.collectScript=function(e){switch(e.tag){case r.Tag.image:case r.Tag.frameImage:return[e.assetId];case r.Tag.pane:return e.backgroundImage?[e.backgroundImage]:[];case r.Tag.button:return this.collect(e.scripts).concat([e.image.assetId]);case r.Tag.jump:return[e.label];case r.Tag.choice:for(var t=[],a=0,c=e.values;a<c.length;a++){var s=c[a];t.push(s.label),s.path&&t.push(s.path)}return e.backgroundImage&&t.push(e.backgroundImage),t;case r.Tag.link:return e.backgroundImage?this.collect(e.scripts).concat([e.backgroundImage]):this.collect(e.scripts);case r.Tag.playAudio:return[e.assetId];case r.Tag.playVideo:case r.Tag.stopVideo:return[e.assetId];case r.Tag.evaluate:return[e.path];case r.Tag.condition:return this.collect(e.scripts).concat([e.path]);case r.Tag.backlog:return this.collect(e.scripts);case r.Tag.timeout:return this.collect(e.scripts);case r.Tag.ifElse:return this.collect(e.conditions).concat(this.collect(e.elseBody));case r.Tag.openSaveScene:return e.base.backgroundImage?[e.base.backgroundImage]:[];case r.Tag.click:return this.collect(e.scripts);case r.Tag.extension:return this.collectFromObject(e.data);default:return[]}},e.prototype.collectFromObject=function(e){for(var t=[],a=0,c=Object.entries(e);a<c.length;a++){var s=c[a],r=s[0],o=s[1];switch(r){case"assetId":case"backgroundImage":case"label":case"path":t.push(o)}"object"==typeof o&&t.push.apply(t,this.collectFromObject(o))}return t},e}();e.DefaultAssetCollector=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/core/lib/index.js"] = function(g) {
			!function(e,r,o,n,t){"use strict";function i(r){for(var o in r)e.hasOwnProperty(o)||(e[o]=r[o])}Object.defineProperty(e,"__esModule",{value:!0}),i(r("./Constant")),i(r("./Scenario")),i(r("./Scene")),i(r("./Frame")),i(r("./Script")),i(r("./GameError")),i(r("./AssetCollector"))}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/lineBreakRule.js"] = function(g) {
			!function(e,i,r,n,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t="".split(""),l="".split(""),s="".split("");e.lineBreakRule=function(e,i){var r=e[i];if("string"!=typeof r)return i;if(t.includes(r))return i+1;var n=e[i-1];return n?"string"!=typeof n?i:s.includes(r)&&s.includes(n)?i+1:t.includes(n)?i:l.includes(n)?i-1:i:i}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/Constant.js"] = function(g) {
			!function(e,i,t,a,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gameId="$gameId";var u;!function(e){e.builtin="builtin",e.system="system",e.saveDataPrefix="data"}(u=e.Region||(e.Region={}))}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/Engine.js"] = function(g) {
			!function(e,t,r,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=t("@cowlick/core"),n=t("@cowlick/config"),i=t("./components/SceneController"),c=t("./scripts/ScriptManager"),l=t("./scripts/defaultScripts"),f=t("./components/GameStateHelper"),p=function(){function e(e){this.game=e.game,this.player=e.player,this._assetCollector=new s.DefaultAssetCollector,e.config?this._config=e.config:this._config=n.defaultConfig(),e.storageKeys?this.storageKeys=e.storageKeys:this.storageKeys=f.createStorageKeys(this.player,this.config.system.maxSaveCount)}return Object.defineProperty(e,"scriptManager",{get:function(){return e._scriptManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetCollector",{get:function(){return this._assetCollector},set:function(e){this._assetCollector=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.prototype.start=function(t,r){var o=this,a=this.makeScene(t);a.loaded.addOnce(function(){var s=new i.SceneController({scene:a,scenario:t,scriptManager:e.scriptManager,assetCollector:o.assetCollector,config:o.config,player:o.player,storageKeys:o.storageKeys});s.current.init(),r&&r(s)}),this.game.pushScene(a)},e.prototype.load=function(e,t){return this.start(new s.Scenario([g._require(this.game,e)]),t)},e.prototype.restore=function(t,r){var o=[new s.Scene({label:"",frames:[new s.Frame([{tag:s.Tag.jump,label:t.label}])]})],a=new s.Scenario(o),n=this.makeScene(a,t.storageValuesSerialization),c=new i.SceneController({scene:n,scenario:a,scriptManager:e.scriptManager,assetCollector:this.assetCollector,config:this.config,player:this.player,storageKeys:this.storageKeys});void 0===this.game.assets[t.label]?(n.assetLoaded.add(function(e){e.id===t.label&&(o.shift(),c.restore(t),r&&r(c))}),n.prefetch()):(o.shift(),c.restore(t),r&&r(c))},e.prototype.script=function(t,r){e.scriptManager.register(t,r)},e.prototype.makeScene=function(e,t){return i.SceneController.createSceneForGame({game:this.game,scenario:e,assetCollector:this.assetCollector,config:this.config,storageKeys:this.storageKeys,storageValuesSerialization:t})},e._scriptManager=new c.ScriptManager(l.defaultScripts),e}();e.Engine=p,e.initialize=function(e,t){var r="cowlickConfig",o={game:e?e:g.game,player:t?t:{id:"0"}};return r in o.game.assets&&(o.config=g._require(o.game,r)),new p(o)}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/AudioGroup.js"] = function(g) {
			!function(r,e,t,o,n){"use strict";var u=this&&this.__values||function(r){var e="function"==typeof Symbol&&r[Symbol.iterator],t=0;return e?e.call(r):{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}}};Object.defineProperty(r,"__esModule",{value:!0});var i=e("@cowlick/core"),a=function(){function r(r,e){this.scene=r,this.group=new Map,this.config=e}return r.prototype.add=function(r){var e=this.group.get(r.group);e||(e=[],this.group.set(r.group,e));var t=this.play(r),o=this.config[r.group];return o&&t.changeVolume(o),e.push(t),t},r.prototype.changeVolume=function(r,e){var t,o,n=this.group.get(r);if(n)try{for(var i=u(n),a=i.next();!a.done;a=i.next()){var l=a.value;l.changeVolume(e)}}catch(c){t={error:c}}finally{try{a&&!a.done&&(o=i["return"])&&o.call(i)}finally{if(t)throw t.error}}},r.prototype.remove=function(r){var e,t,o=this.group.get(r.group);if(o){if(this.group["delete"](r.group)){try{for(var n=u(o),a=n.next();!a.done;a=n.next()){var l=a.value;l.stop()}}catch(c){e={error:c}}finally{try{a&&!a.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}return}var s=o.findIndex(function(e){return e.currentAudio.id===r.assetId});if(!(s>-1))throw new i.GameError("audio not found",r);o[s].stop(),o.splice(s,1)}},r.prototype.play=function(r){var e=this.scene.assets[r.assetId];return e.play()},r}();r.AudioGroup=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/AutoMode.js"] = function(g) {
			!function(e,t,i,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("@cowlick/core"),u=function(){function e(e){this.scene=e}return e.prototype.setTrigger=function(){var e=this;this.autoIdentifier||(this.autoIdentifier=this.scene.body.setTimeout(function(){e.scene.requestNextFrame(),e.autoIdentifier=void 0},this.scene.gameState.variables.builtin[r.BuiltinVariable.autoMessageDuration],this))},e.prototype.clear=function(){this.autoIdentifier&&(this.scene.body.clearTimeout(this.autoIdentifier),this.autoIdentifier=void 0)},e}();e.AutoMode=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/Button.js"] = function(g) {
			!function(t,e,o,n,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var h=function(t){function e(e){var o=t.call(this,{scene:e.scene,width:e.width,height:e.height,backgroundImage:e.backgroundImage?e.scene.assets[e.backgroundImage]:void 0,padding:e.padding,backgroundEffector:e.backgroundEffector?new g.NinePatchSurfaceEffector(e.scene.game,e.backgroundEffector.borderWidth):void 0})||this;return o.hoverable=!0,o.touchable=!0,o.pointDown.add(o.onPointDown,o),o.pointMove.add(o.onPointMove,o),o.pointUp.add(o.onPointUp,o),o.onClick=null,o.buttonState=0,o.onHovered=null,o.onUnhovered=null,o}return r(e,t),Object.defineProperty(e.prototype,"click",{get:function(){return this.onClick||(this.onClick=new g.Trigger),this.onClick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hovered",{get:function(){return this.onHovered||(this.onHovered=new g.Trigger),this.onHovered},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unhovered",{get:function(){return this.onUnhovered||(this.onUnhovered=new g.Trigger),this.onUnhovered},enumerable:!0,configurable:!0}),e.prototype.push=function(){this.buttonState=2,this.hoverable=!1,this.modified()},e.prototype.unpush=function(){this.buttonState=0,this.hoverable=!0,this.modified()},e.prototype.hover=function(){1!==this.buttonState&&(this.buttonState=1,this.modified())},e.prototype.move=function(t,e){t&&(this.x=t),e&&(this.y=e),this.modified()},e.prototype.destroy=function(){this.onClick&&(this.onClick.destroy(),this.onClick=null),this.onHovered&&(this.onHovered.destroy(),this.onHovered=null),this.onUnhovered&&(this.onUnhovered.destroy(),this.onUnhovered=null),this.hoverable=!1,t.prototype.destroy.call(this)},e.prototype.onPointDown=function(t){2!==this.buttonState&&this.push()},e.prototype.isHover=function(t){var e={x:t.point.x+t.startDelta.x,y:t.point.y+t.startDelta.y};return e.x<0||e.y<0?!1:e.x>=this.width||e.y>=this.height?!1:!0},e.prototype.onPointMove=function(t){var e=this.isHover(t);2===this.buttonState&&e===!1?this.unpush():0===this.buttonState&&e&&this.push()},e.prototype.onPointUp=function(t){2===this.buttonState&&(this.unpush(),this.onClick&&this.onClick.fire(this))},e}(g.Pane);t.Button=h}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/GameScene.js"] = function(g) {
			!function(e,t,r,o,i){"use strict";var a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,r=1,o=arguments.length;o>r;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},a.apply(this,arguments)},n=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,i,a=r.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(o=a.next()).done;)n.push(o.value)}catch(s){i={error:s}}finally{try{o&&!o.done&&(r=a["return"])&&r.call(a)}finally{if(i)throw i.error}}return n};Object.defineProperty(e,"__esModule",{value:!0});var l=t("../models/Storage"),c=t("@cowlick/core"),p=t("./Message"),y=t("./LayerGroup"),u=t("./AudioGroup"),h=t("./VideoGroup"),d=t("./AutoMode"),f=t("../models/LayerPriority"),g=function(){function e(e){this.scene=e.scene,this.layerGroup=new y.LayerGroup(this.scene),this.scriptManager=e.scriptManager,this.config=e.config,this.layerPriority=new f.LayerPriority(new Map(this.config.window.priority)),this.controller=e.controller,this.audioGroup=new u.AudioGroup(this.scene,e.config.audio),this.videoGroup=new h.VideoGroup(this.scene),this.player=e.player,this._gameState=e.state,this.scenario=e.scenario,this.scenario.onLoaded.add(this.loadFrame,this),this._enabledWindowClick=!1,this.autoMode=new d.AutoMode(this),this._gameState.copyGameVariables(),this.storage=new l.Storage({storage:this.game.storage,player:this.player,state:this._gameState}),this.config.system.autoSave&&(this.storage.saveBuiltinVariables(),this.storage.saveSystemVariables())}return Object.defineProperty(e.prototype,"body",{get:function(){return this.scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game",{get:function(){return this.scene.game},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this.scenario.scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameState",{get:function(){return this._gameState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabledWindowClick",{get:function(){return this._enabledWindowClick},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.createMessageLayer(),this.createSystemLayer(),this.scenario.load()},e.prototype.appendLayer=function(e,t){this.layerGroup.append(e,t),this.layerPriority.add(t.name)},e.prototype.removeLayer=function(e){this.layerGroup.remove(e)},e.prototype.removeLayers=function(e){var t,r;try{for(var o=n(e),i=o.next();!i.done;i=o.next()){var a=i.value;this.removeLayer(a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}this.layerPriority.clear(e)},e.prototype.updateText=function(e){var t=this;if(void 0===this._message)throw new c.GameError("GameScene");var r=this.scenario.scene;this._message.updateText(e,this._gameState.isAlreadyRead(r.label,r.index)),this._gameState.markAlreadyRead(r.label,r.index),this._message.finish.addOnce(function(e){var r,o;t.scenario.pushTextLog(e);try{for(var i=n(t.config.window.message.marker),a=i.next();!a.done;a=i.next()){var s=a.value;t.scriptManager.call(t.controller,s)}}catch(l){r={error:l}}finally{try{a&&!a.done&&(o=i["return"])&&o.call(i)}finally{if(r)throw r.error}}t.scriptManager.call(t.controller,{tag:c.Tag.autoMode})},this),this.disableWindowClick(),this.enableWindowClick()},e.prototype.applyLayerConfig=function(e){(e.name!==c.LayerKind.system||this.existsSystemLayer()!==!1)&&this.layerGroup.applyConfig(e)},e.prototype.disableWindowClick=function(){this.disableTrigger(),this._enabledWindowClick=!1},e.prototype.enableWindowClick=function(){var e=this;this.layerGroup.evaluate(c.LayerKind.message,function(t){var r,o,i,a;if(void 0===e._message)throw new c.GameError("GameScene");if(t.touchable=!0,e._message.finished){t.pointUp.addOnce(e.requestNextFrame,e);try{for(var s=n(t.children),l=s.next();!l.done;l=s.next()){var p=l.value;p.pointUp.addOnce(e.requestNextFrame,e)}}catch(y){r={error:y}}finally{try{l&&!l.done&&(o=s["return"])&&o.call(s)}finally{if(r)throw r.error}}}else{t.pointUp.addOnce(e.onWindowClick,e);try{for(var u=n(t.children),h=u.next();!h.done;h=u.next()){var p=h.value;p.pointUp.addOnce(e.onWindowClick,e)}}catch(d){i={error:d}}finally{try{h&&!h.done&&(a=u["return"])&&a.call(u)}finally{if(i)throw i.error}}}}),this._enabledWindowClick=!0},e.prototype.transition=function(e,t){(e!==c.LayerKind.system||this.existsSystemLayer()!==!1)&&this.layerGroup.evaluate(e,t)},e.prototype.requestNextFrame=function(){this.disableWindowClick(),this.scenario.next()},e.prototype.playAudio=function(e){var t=this,r=this.audioGroup.add(e);e.group===c.AudioGroup.voice&&r.stopped.addOnce(function(){t.scriptManager.call(t.controller,{tag:c.Tag.autoMode})},this)},e.prototype.changeVolume=function(e){this.audioGroup.changeVolume(e.groupName,e.volume)},e.prototype.stopAudio=function(e){this.audioGroup.remove(e)},e.prototype.playVideo=function(e){this.videoGroup.add(e)},e.prototype.stopVideo=function(e){this.videoGroup.remove(e)},e.prototype.save=function(e){this.storage.save(e)},e.prototype.load=function(e){return this.storage.load(e)},e.prototype.setAutoTrigger=function(){this.autoMode.setTrigger()},e.prototype.applyMessageSpeed=function(){if(void 0===this._message)throw new c.GameError("GameScene");this._message.applySpeed()},e.prototype.applyFontSetting=function(){if(void 0===this._message)throw new c.GameError("GameScene");this._message.applyFontSetting()},e.prototype.disableTrigger=function(){this.autoMode.clear(),this.layerGroup.evaluate(c.LayerKind.message,function(e){var t,r;e.touchable=!1,e.pointUp.removeAll();try{for(var o=n(e.children),i=o.next();!i.done;i=o.next()){var a=i.value;a.pointUp.removeAll()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}})},e.prototype.loadFrame=function(e){var t,r;e&&(this.scriptManager.call(this.controller,{tag:c.Tag.removeLayers,targets:e.scripts}),this.applyScripts(e.scripts)),this.layerPriority.add(c.LayerKind.message),this.layerGroup.exists(c.LayerKind.system)&&this.layerPriority.add(c.LayerKind.system);try{for(var o=n(this.layerPriority.collect()),i=o.next();!i.done;i=o.next()){var a=s(i.value,1),l=a[0];this.layerGroup.top(l)}}catch(p){t={error:p}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.createMessageLayer=function(){this.scriptManager.call(this.controller,a({tag:c.Tag.pane},this.config.window.message.ui)),this._message=new p.Message({scene:this.scene,config:this.config,width:this.game.width-60,x:this.config.window.message.top.x,y:this.config.window.message.top.y,gameState:this.gameState}),this.layerGroup.append(this._message,{name:c.LayerKind.message}),this.enableWindowClick()},e.prototype.createSystemLayer=function(){var e,t;try{for(var r=n(this.config.window.system),o=r.next();!o.done;o=r.next()){var i=o.value;this.scriptManager.call(this.controller,i)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.applyScripts=function(e){var t,r;try{for(var o=n(e),i=o.next();!i.done;i=o.next()){var a=i.value;this.scriptManager.call(this.controller,a)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=o["return"])&&r.call(o)}finally{if(t)throw t.error}}},e.prototype.onWindowClick=function(){if(void 0===this._message)throw new c.GameError("GameScene");this._enabledWindowClick&&(this.gameState.setValue({type:c.VariableType.builtin,name:c.BuiltinVariable.autoMode},!1),this._message.finished?this.requestNextFrame():(this._message.showAll(),this.enableWindowClick()))},e.prototype.existsSystemLayer=function(){return this.layerGroup.exists(c.LayerKind.system)},e}();e.GameScene=g}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/GameStateHelper.js"] = function(g) {
			!function(e,r,a,t,n){"use strict";function i(e,r,a,t){var n=e.find(function(e){return e.key===t.storageKey});if(n)return n;var i=parseInt(a[0].substring(m),10),o={key:r,value:{label:"",variables:{},logs:[]}};return e[i]=o,o}function o(e,r,a){var t,n,o,l,s={builtin:{},system:{},current:{}},u=[];try{for(var g=f(r),c=g.next();!c.done;c=g.next()){var y=c.value;try{for(var d=f(e.storageValues.get(y)),m=d.next();!m.done;m=d.next()){var b=m.value,h="number"==typeof b.data?b.data:JSON.parse(b.data);if(y.regionKey===v.Region.system)s.system=h;else{var p=y.regionKey.split("."),S=i(u,y,p,b),x=p[p.length-1];switch(x){case"label":S.value.label=h;break;case"logs":S.value.logs=h;break;case"description":S.value.description=h;break;default:S.value.variables=h}}}}catch(V){o={error:V}}finally{try{m&&!m.done&&(l=d["return"])&&l.call(d)}finally{if(o)throw o.error}}}}catch(I){t={error:I}}finally{try{c&&!c.done&&(n=g["return"])&&n.call(g)}finally{if(t)throw t.error}}return{data:u.map(function(e){return e.value}),variables:s,max:a}}function l(e,r,a,t){var n,i,l=a.system.maxSaveCount,s=o(e,r,l),g=[[y.BuiltinVariable.selectedFont,0],[y.BuiltinVariable.autoMode,!1],[y.BuiltinVariable.autoMessageDuration,a.system.autoMessageDuration],[y.BuiltinVariable.messageSpeed,a.system.messageSpeed],[y.BuiltinVariable.realTimeDisplay,a.system.realTimeDisplay],[y.BuiltinVariable.fontSize,a.font.size],[y.BuiltinVariable.fontColor,a.font.color],[y.BuiltinVariable.alreadyRead,{}]];try{for(var v=f(g),m=v.next();!m.done;m=v.next()){var b=c(m.value,2),h=b[0],p=b[1];h in s.variables.builtin||(s.variables.builtin[h]=p)}}catch(S){n={error:S}}finally{try{m&&!m.done&&(i=v["return"])&&i.call(v)}finally{if(n)throw n.error}}return new d.GameState(u({},s,{scenario:t}))}function s(e,r){for(var a=[{region:g.StorageRegion.Values,regionKey:v.Region.system,userId:e.id,gameId:v.gameId},{region:g.StorageRegion.Values,regionKey:v.Region.builtin,userId:e.id,gameId:v.gameId}],t=0;r-1>t;t++)a.push({region:g.StorageRegion.Values,regionKey:v.Region.saveDataPrefix+t,userId:e.id,gameId:v.gameId});return a}var u=this&&this.__assign||function(){return u=Object.assign||function(e){for(var r,a=1,t=arguments.length;t>a;a++){r=arguments[a];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u.apply(this,arguments)},f=this&&this.__values||function(e){var r="function"==typeof Symbol&&e[Symbol.iterator],a=0;return r?r.call(e):{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}},c=this&&this.__read||function(e,r){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var t,n,i=a.call(e),o=[];try{for(;(void 0===r||r-- >0)&&!(t=i.next()).done;)o.push(t.value)}catch(l){n={error:l}}finally{try{t&&!t.done&&(a=i["return"])&&a.call(i)}finally{if(n)throw n.error}}return o};Object.defineProperty(e,"__esModule",{value:!0});var y=r("@cowlick/core"),d=r("../models/GameState"),v=r("../Constant"),m=v.Region.saveDataPrefix.length;e.loadGameState=l,e.createStorageKeys=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/Image.js"] = function(g) {
			!function(e,r,a,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r("@cowlick/core");e.createFrameSprite=function(e,r,a){var t=new g.FrameSprite({scene:e,src:r,width:a.width,height:a.height});return t.frames=a.frames,a.interval&&(t.interval=a.interval),t.start(),t},e.createImage=function(r,a){var t,i=r.assets[a.assetId];return t=a.tag===n.Tag.frameImage?e.createFrameSprite(r,i,a.frame):new g.Sprite({scene:r,src:i}),void 0!==a.layer.x&&(t.x=a.layer.x),void 0!==a.layer.y&&(t.y=a.layer.y),t.invalidate(),t}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/ImageButton.js"] = function(g) {
			!function(t,e,i,o,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var h=e("./Button"),a=e("./Image"),u=function(t){function e(e,i){var o=t.call(this,{scene:e,width:0,height:0})||this;return o.image=a.createImage(e,i),o.image.x=0,o.image.y=0,o.width=o.image.width/3,o.height=o.image.height,o.append(o.image),o.hovered.add(o.hover,o),o.unhovered.add(o.unpush,o),o}return r(e,t),e.prototype.push=function(){this.image.x=-this.image.width/3,this.image.modified(),t.prototype.push.call(this)},e.prototype.unpush=function(){this.image.x=0,this.image.modified(),t.prototype.unpush.call(this)},e.prototype.hover=function(){this.image.x=-this.image.width/3*2,this.image.modified(),t.prototype.hover.call(this)},e}(h.Button);t.ImageButton=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/LabelButton.js"] = function(g) {
			!function(t,e,n,o,i){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(t,"__esModule",{value:!0});var u=e("./Button"),c=e("@cowlick/core"),a=function(t){function e(e){var n=t.call(this,e)||this,o=e.gameState.getValue({type:c.VariableType.builtin,name:c.BuiltinVariable.selectedFont}),i=e.config.font.list[o],r=new g.Label({scene:n.scene,text:e.text,font:i,fontSize:e.fontSize?e.fontSize:i.size,textColor:e.config.font.color});return r.aligning(n.width,g.TextAlign.Center),r.invalidate(),n.append(r),n}return r(e,t),e.prototype.push=function(){this.y+=2,this.height-=2,t.prototype.push.call(this)},e.prototype.unpush=function(){this.y-=2,this.height+=2,t.prototype.unpush.call(this)},e}(u.Button);t.LabelButton=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/LayerGroup.js"] = function(g) {
			!function(e,t,o,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("@cowlick/core"),p=function(){function e(e){this.scene=e,this.root=new g.E({scene:e}),this.scene.append(this.root),this.group=new Map}return e.prototype.append=function(e,t){var o=this.group.get(t.name);o?o.append(e):(o=new g.E({scene:this.scene,width:this.scene.game.width,height:this.scene.game.height,x:0,y:0,opacity:t.opacity}),o.append(e),this.root.append(o),this.group.set(t.name,o))},e.prototype.remove=function(e){var t=this.group.get(e);t&&this.group["delete"](e)&&t.destroyed()===!1&&t.destroy()},e.prototype.applyConfig=function(e){this.evaluate(e.name,function(t){void 0!==e.visible&&(e.visible?t.show():t.hide());var o=!1;void 0!==e.opacity&&(t.opacity=e.opacity,o=!0),void 0!==e.x&&(t.x=e.x,o=!0),void 0!==e.y&&(t.y=e.y,o=!0),o&&t.modified()})},e.prototype.top=function(e){var t=this.group.get(e);t&&this.root.append(t)},e.prototype.evaluate=function(e,t){var o=this.group.get(e);if(!o)throw new r.GameError("layer not found",{name:e});t(o)},e.prototype.exists=function(e){return this.group.has(e)},e}();e.LayerGroup=p}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/Message.js"] = function(g) {
			!function(t,e,i,n,r){"use strict";var s=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}};Object.defineProperty(t,"__esModule",{value:!0});var a=e("@akashic-extension/akashic-label"),l=e("@cowlick/core"),h=e("../lineBreakRule"),u=function(t){function e(i){var n=t.call(this,e.toLabelParameters(i))||this;return n.index=0,n.counter=0,n.original={tag:l.Tag.text,values:[]},n.current=[],n.gameState=i.gameState,n.textAlign=g.TextAlign.Left,n.config=i.config,n.applySpeed(),n}return s(e,t),Object.defineProperty(e.prototype,"finish",{get:function(){return this.onFinish||(this.onFinish=new g.Trigger),this.onFinish},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"finished",{get:function(){return this.index>=this.original.values.length},enumerable:!0,configurable:!0}),e.prototype.updateText=function(t,e){this.config.system.alreadyRead&&e?this.textColor=this.config.font.alreadyReadColor:this.textColor=this.config.font.color,t.clear?(this.text="",this.original=t,this.index=0,this.counter=0):this.original={tag:l.Tag.text,values:this.original.values.concat(t.values)},this.setCurrent(),this.gameState.variables.builtin[l.BuiltinVariable.realTimeDisplay]?this.showAll():this.applySpeed()},e.prototype.applySpeed=function(){this.identifier&&this.removeTimer(),this.identifier=this.scene.setInterval(this.next,this.gameState.variables.builtin[l.BuiltinVariable.messageSpeed],this)},e.prototype.applyFontSetting=function(){this.fontSize=this.gameState.variables.builtin[l.BuiltinVariable.fontSize],this.textColor=this.gameState.variables.builtin[l.BuiltinVariable.fontColor],this.invalidate()},e.prototype.showAll=function(){var t,e;if(!this.finished){this.removeTimer(),this.text="";try{for(var i=o(this.original.values),n=i.next();!n.done;n=i.next()){var r=n.value;if("string"==typeof r)this.text+=r;else if(Array.isArray(r))this.text+=r[r.length-1].value;else{var s=this.gameState.findStringValue(r);if(!s)throw new l.GameError("",r);this.text+=s}}}catch(a){t={error:a}}finally{try{n&&!n.done&&(e=i["return"])&&e.call(i)}finally{if(t)throw t.error}}this.index=this.original.values.length,this.invalidate(),this.onFinish&&this.onFinish.fire(this.text)}},e.prototype.destroy=function(){this.removeTimer(),this.onFinish&&(this.onFinish.destroy(),this.onFinish=void 0),t.prototype.destroy.call(this)},e.prototype.next=function(){if(!this.finished&&this.counter>=this.current.length&&(this.counter=0,this.index++,this.finished||this.setCurrent()),!this.finished){var t=this.current[this.counter];"string"==typeof t?this.text+=t:(0!==this.counter&&(this.text=this.text.substring(0,this.text.length-t.value.length)),this.text+=t.value),this.invalidate(),this.counter++}this.finished&&(this.removeTimer(),this.onFinish&&this.onFinish.fire(this.text))},e.prototype.removeTimer=function(){this.identifier&&(this.scene.clearInterval(this.identifier),this.identifier=void 0)},e.prototype.setCurrent=function(){var t=this.original.values[this.index];if("string"==typeof t)this.current=t.split(/.*?/);else if(Array.isArray(t))this.current=t;else{var e=this.gameState.findStringValue(t);if(!e)throw new l.GameError("",t);this.current=e.split(/.*?/)}},e.toLabelParameters=function(t){var e=t.gameState.getValue({type:l.VariableType.builtin,name:l.BuiltinVariable.selectedFont}),i=t.config.font.list[e],n=t.gameState.getValue({type:l.VariableType.builtin,name:l.BuiltinVariable.fontSize}),r=t.gameState.getValue({type:l.VariableType.builtin,name:l.BuiltinVariable.fontColor});return{scene:t.scene,font:i,text:"",fontSize:n,textColor:r,width:t.width,x:t.x,y:t.y,fixLineGap:!0,lineBreakRule:h.lineBreakRule}},e}(a.Label);t.Message=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/SaveLoadScene.js"] = function(g) {
			!function(e,t,n,o,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=t("@cowlick/core"),r=t("./LabelButton"),s=function(){function e(e){this.scene=e.scene,this.config=e.config,this._gameState=e.gameState,this.button=new r.LabelButton({scene:this.scene,width:100,height:24,text:"close",fontSize:18,config:this.config,gameState:e.gameState}),this.button.move(this.game.width-110,10),this.button.click.add(this.close,this),this.scene.append(this.button)}return Object.defineProperty(e.prototype,"body",{get:function(){return this.scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameState",{get:function(){return this._gameState},enumerable:!0,configurable:!0}),e.prototype.close=function(){if(this.game.scene()!==this.scene)throw new c.GameError("Current scene is not a save or load scene.");this.game.popScene(!0)},Object.defineProperty(e.prototype,"game",{get:function(){return this.scene.game},enumerable:!0,configurable:!0}),e}();e.SaveLoadScene=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/Scene.js"] = function(g) {
			!function(e,u,o,r,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/SceneController.js"] = function(g) {
			!function(e,t,a,o,n){"use strict";var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,a=1,o=arguments.length;o>a;a++){t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},s.apply(this,arguments)},r=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var o,n,s=a.call(e),r=[];try{for(;(void 0===t||t-- >0)&&!(o=s.next()).done;)r.push(o.value)}catch(i){n={error:i}}finally{try{o&&!o.done&&(a=s["return"])&&a.call(s)}finally{if(n)throw n.error}}return r},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],a=0;return t?t.call(e):{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}};Object.defineProperty(e,"__esModule",{value:!0});var l=t("@cowlick/core"),u=t("./GameScene"),h=t("./SaveLoadScene"),d=t("./GameStateHelper"),p=function(){function e(e){this.game=e.scene.game,this.scenario=e.scenario,this.scriptManager=e.scriptManager,this.assetCollector=e.assetCollector,this.config=e.config,this.player=e.player,this.storageKeys=e.storageKeys,this.current=new u.GameScene({scene:e.scene,scenario:this.scenario,scriptManager:this.scriptManager,config:this.config,controller:this,player:this.player,state:d.loadGameState(e.scene,e.storageKeys,e.config,e.scenario)}),this.saveLoadSceneBody=this.makeSaveLoadScene()}return Object.defineProperty(e.prototype,"backlog",{get:function(){return this.scenario.backlog},enumerable:!0,configurable:!0}),e.prototype.snapshot=function(){return s({},this.current.gameState.createSnapshot(),{storageKeys:this.storageKeys,storageValuesSerialization:this.current.body.serializeStorageValues()})},e.prototype.jump=function(e,t){var a=this.scenario.scene.label;this.scenario.update(this.game,e),a===this.scenario.scene.label?this.scenario.load():this.loadScene(t)},e.prototype.save=function(e){this.current.save(e)},e.prototype.load=function(e){var t=this,a=this.current.load(e.index);if(!a)throw new l.GameError("save data not found",e);this.jump({tag:l.Tag.jump,label:a.label,frame:a.logs[0].frame},function(){return t.skip(a)})},e.prototype.openSaveLoadScene=function(e){var t=this;return this.saveLoadSceneBody.loaded.addOnce(function(){t.saveLoadScene=new h.SaveLoadScene({scene:t.saveLoadSceneBody,config:t.config,gameState:t.current.gameState}),e(t.saveLoadScene)}),this.game.pushScene(this.saveLoadSceneBody),this.saveLoadScene},e.prototype.closeSaveLoadScene=function(){if(!this.saveLoadScene)throw new l.GameError("");this.saveLoadScene.close()},e.prototype.destroy=function(){var e=this,t=this.game.scene(),a=this.current.body;t===this.saveLoadSceneBody?(this.saveLoadSceneBody.stateChanged.add(function(t){t===g.SceneState.Destroyed&&e.game.scene()===a&&e.game.popScene()},this),this.game.popScene()):0==this.saveLoadSceneBody.destroyed()&&this.saveLoadSceneBody.destroy(),t===a&&this.game.popScene()},e.prototype.destroyed=function(){return this.current.body.destroyed()},e.prototype.restore=function(e){var t=this;this.scenario.update(this.game,{tag:l.Tag.jump,label:e.label}),this.loadScene(function(){return t.skip(e)})},e.createSceneForGame=function(e){var t=e.assetCollector.collectFromScene(e.scenario.scene);return t.push.apply(t,i(e.assetCollector.collect(e.config.window.system))),t.push.apply(t,i(e.assetCollector.collect(e.config.window.message.marker))),e.config.window.message.ui.backgroundImage&&t.push(e.config.window.message.ui.backgroundImage),new g.Scene({game:e.game,assetIds:t,storageKeys:e.storageKeys,storageValuesSerialization:e.storageValuesSerialization})},e.prototype.loadScene=function(t){var a=this;this.scenario.clear();var o=this.saveLoadSceneBody,n=this.current.body,s=e.createSceneForGame({game:this.game,scenario:this.scenario,assetCollector:this.assetCollector,config:this.config,storageKeys:this.storageKeys});switch(s.loaded.addOnce(function(){a.current=new u.GameScene({scene:s,scenario:a.scenario,scriptManager:a.scriptManager,config:a.config,controller:a,player:a.player,state:a.current.gameState}),a.current.init(),t&&t(),a.saveLoadSceneBody=a.makeSaveLoadScene()},this),o.stateChanged.add(function(e){e===g.SceneState.Destroyed&&(a.game.scene()===n?a.game.replaceScene(s):a.game.pushScene(s))},this),o.state){case g.SceneState.Standby:o.destroy();break;case g.SceneState.Active:n.setTimeout(function(){return o.destroy()},this.game.fps,this)}},e.prototype.makeSaveLoadScene=function(){var e=this.assetCollector.collectFromScene(this.scenario.scene).concat(this.assetCollector.collect(this.config.window.system),this.current.gameState.collectAssetIds(this.game,this.assetCollector));this.config.window.message.ui.backgroundImage&&e.push(this.config.window.message.ui.backgroundImage);var t=new g.Scene({game:this.game,assetIds:e});return t.prefetch(),t},e.prototype.skip=function(e){var t,a;try{for(var o=c(e.logs.slice(1)),n=o.next();!n.done;n=o.next()){var s=n.value;this.jump({tag:l.Tag.jump,label:e.label,frame:s.frame})}}catch(r){t={error:r}}finally{try{n&&!n.done&&(a=o["return"])&&a.call(o)}finally{if(t)throw t.error}}},e}();e.SceneController=p}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/Slider.js"] = function(g) {
			!function(e,t,a,r,n){"use strict";var o=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=t("@xnv/akashic-scrollable"),l=t("@cowlick/core"),s=function(e){function t(t){var a=e.call(this,t)||this;a.touchable=!0,a.length=t.data.length,a.target=t.data.target,a.gameState=t.state,a.maxValue=t.data.max,a.defaultValue=t.data["default"];var r=i.createDefaultScrollbarImage(t.scene.game,7,"rgba(255, 255, 255, 0.2)",4,"rgba(218, 218, 218, 0.5)"),n=i.createDefaultScrollbarImage(t.scene.game,7,"rgba(255, 255, 255, 0.5)",4,"rgba(164, 164, 164, 0.7)");switch(t.data.direction){case 0:a.bar=new i.NinePatchVerticalScrollbar({scene:t.scene,bgImage:r,image:n});break;case 1:a.bar=new i.NinePatchHorizontalScrollbar({scene:t.scene,bgImage:r,image:n});break;default:throw new l.GameError("Can not initialize slider. Please bug report.")}a.width=a.bar.width,a.height=a.bar.height;var o=a.gameState.getValue(a.target);if("number"==typeof o)a.setPosRate(o/a.maxValue);else{if("undefined"!=typeof o)throw new l.GameError("target variable is not number type",t.data);a.setPosRate(a.defaultValue/a.maxValue)}return a.bar.onChangeBarPositionRate.add(function(e){a.gameState.setValue(a.target,a.maxValue*e)},a),a.append(a.bar),a}return o(t,e),t.prototype.reset=function(){this.setPosRate(this.defaultValue/this.maxValue)},t.prototype.setPosRate=function(e){this.bar.setBarProperties(e,this.length*this.length,this.length)},t}(g.Pane);e.Slider=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/components/VideoGroup.js"] = function(g) {
			!function(e,s,t,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("@cowlick/core"),n=function(){function e(e){this.scene=e,this.assets=[]}return e.prototype.add=function(e){var s=this.scene.assets[e.assetId];return this.assets.push(s),s.play()},e.prototype.remove=function(e){var s=this.assets.findIndex(function(s){return s.id===e.assetId});if(!(s>0))throw new i.GameError("video not found",e);var t=this.assets[s];t.stop(),t.destroy(),this.assets.splice(s,1)},e}();e.VideoGroup=n}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/index.js"] = function(g) {
			!function(e,n,o,t,a){"use strict";function r(n){for(var o in n)e.hasOwnProperty(o)||(e[o]=n[o])}Object.defineProperty(e,"__esModule",{value:!0}),r(n("./Engine"));var c=n("./scripts/defaultScripts");e.defaultScripts=c.defaultScripts,r(n("./models/GameState"));var l=n("./components/SceneController");e.SceneController=l.SceneController;var m=n("./components/GameScene");e.GameScene=m.GameScene;var u=n("./components/SaveLoadScene");e.SaveLoadScene=u.SaveLoadScene,r(n("./components/Button"));var S=n("./components/ImageButton");e.ImageButton=S.ImageButton;var s=n("./components/LabelButton");e.LabelButton=s.LabelButton;var d=n("./components/Slider");e.Slider=d.Slider}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/models/AlreadyReadChecker.js"] = function(g) {
			!function(e,r,a,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function e(e){this.alreadyRead=e}return e.prototype.mark=function(e,r){if(e in this.alreadyRead){var a=this.alreadyRead[e];a.some(function(e){return e===r})===!1&&a.push(r)}else this.alreadyRead[e]=[r]},e.prototype.isAlreadyRead=function(e,r){return e in this.alreadyRead?this.alreadyRead[e].some(function(e){return e===r}):!1},e}();e.AlreadyReadChecker=d}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/models/GameState.js"] = function(g) {
			!function(e,r,t,a,i){"use strict";var n=this&&this.__values||function(e){var r="function"==typeof Symbol&&e[Symbol.iterator],t=0;return r?r.call(e):{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}},o=this&&this.__read||function(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var a,i,n=t.call(e),o=[];try{for(;(void 0===r||r-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(s){i={error:s}}finally{try{a&&!a.done&&(t=n["return"])&&t.call(n)}finally{if(i)throw i.error}}return o},s=this&&this.__spread||function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(o(arguments[r]));return e};Object.defineProperty(e,"__esModule",{value:!0});var l=r("@cowlick/core"),u=r("./AlreadyReadChecker"),c=function(){function e(e){this.data=e.data,this.currentVariables=e.variables,this.sceneStartVariables=this.currentVariables.current,this.max=e.max,this.alreadyReadChecker=new u.AlreadyReadChecker(this.currentVariables.builtin.alreadyRead),this.scenario=e.scenario}return Object.defineProperty(e.prototype,"variables",{get:function(){return this.currentVariables},enumerable:!0,configurable:!0}),e.prototype.exists=function(e){return"undefined"!=typeof this.data[e]},e.prototype.save=function(e){if(e.index>this.max||e.index<0)throw new l.GameError("storage out of range",e);var r=this.scenario.createSaveData(this.sceneStartVariables,e.description);if(e.force)return this.data[e.index]=r,r;if(this.exists(e.index))throw new l.GameError("save data already exists",e);return this.data[e.index]=r,r},e.prototype.load=function(e){var r=this.data[e];return r&&(this.currentVariables.current=r.variables,this.sceneStartVariables=r.variables,this.scenario.backlog=r.logs),r},e.prototype.getValue=function(e){return this.getVariables(e)[e.name]},e.prototype.findStringValue=function(e){var r=this.getValue(e);return void 0!==r?String(r):void 0},e.prototype.setValue=function(e,r){this.getVariables(e)[e.name]=r},e.prototype.collectAssetIds=function(e,r){var t,a,i=[];try{for(var o=n(this.data),u=o.next();!u.done;u=o.next()){var c=u.value;if(c){var d=this.scenario.findScene(e,c);if(!d)throw new l.GameError("scene not found",c);i.push.apply(i,s(r.collectFromScene(d)))}}}catch(h){t={error:h}}finally{try{u&&!u.done&&(a=o["return"])&&a.call(o)}finally{if(t)throw t.error}}return i},e.prototype.isAlreadyRead=function(e,r){return this.alreadyReadChecker.isAlreadyRead(e,r)},e.prototype.markAlreadyRead=function(e,r){this.alreadyReadChecker.mark(e,r)},e.prototype.copyGameVariables=function(){this.sceneStartVariables=this.currentVariables.current},e.prototype.getVariables=function(e){if(e.type===l.VariableType.system)return this.currentVariables.system;if(e.type===l.VariableType.builtin)return this.currentVariables.builtin;if(e.type===l.VariableType.current)return this.currentVariables.current;throw new l.GameError("invalid variable type",e)},e.prototype.createSnapshot=function(){return this.scenario.createSaveData(this.sceneStartVariables)},e}();e.GameState=c}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/models/LayerPriority.js"] = function(g) {
			!function(r,t,e,i,n){"use strict";var o=this&&this.__values||function(r){var t="function"==typeof Symbol&&r[Symbol.iterator],e=0;return t?t.call(r):{next:function(){return r&&e>=r.length&&(r=void 0),{value:r&&r[e++],done:!r}}}},l=this&&this.__read||function(r,t){var e="function"==typeof Symbol&&r[Symbol.iterator];if(!e)return r;var i,n,o=e.call(r),l=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)l.push(i.value)}catch(a){n={error:a}}finally{try{i&&!i.done&&(e=o["return"])&&e.call(o)}finally{if(n)throw n.error}}return l};Object.defineProperty(r,"__esModule",{value:!0});var a=t("./PriorityQueue"),u=t("@cowlick/core"),s=function(){function r(r){var t,e;this.priorities=r,this.minPriority=-1;try{for(var i=o(this.priorities.values()),n=i.next();!n.done;n=i.next()){var l=n.value;this.minPriority=Math.min(this.minPriority,l)}}catch(a){t={error:a}}finally{try{n&&!n.done&&(e=i["return"])&&e.call(i)}finally{if(t)throw t.error}}this.layers=[]}return r.prototype.add=function(r){r!==u.LayerKind.backlog&&(this.layers=this.layers.filter(function(t){return t!==r}),this.layers.push(r))},r.prototype.collect=function(){var r,t,e=new a.PriorityQueue(function(r,t){var e=l(r,2),i=(e[0],e[1]),n=l(t,2),o=(n[0],n[1]);return o>i}),i=this.minPriority;try{for(var n=o(this.layers.slice().reverse()),u=n.next();!u.done;u=n.next()){var s=u.value,y=this.priorities.get(s);(void 0===y||null===y)&&(y=i,i--),e.add([s,y])}}catch(c){r={error:c}}finally{try{u&&!u.done&&(t=n["return"])&&t.call(n)}finally{if(r)throw r.error}}return e},r.prototype.clear=function(r){this.layers=this.layers.filter(function(t){return r.has(t)===!1})},r}();r.LayerPriority=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/models/PriorityQueue.js"] = function(g) {
			!function(t,r,i,e,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function t(t){this.compare=t?t:function(t,r){return r>t},this.array=[],this.size=0}return t.prototype.add=function(t){var r=this.size;this.array[this.size]=t,this.size+=1;for(var i,e;r>0&&(i=r-1>>1,e=this.array[i],this.compare(t,e));)this.array[r]=e,r=i;this.array[r]=t},t.prototype.poll=function(){if(0!==this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this.percolateDown(0)):this.size--,t}},t.prototype.isEmpty=function(){return 0===this.size},t.prototype.next=function(){return{done:this.isEmpty(),value:this.poll()}},t.prototype[Symbol.iterator]=function(){return this},t.prototype.percolateDown=function(t){for(var r,i,e,s=this.size,a=this.size>>>1,o=this.array[t];a>t&&(r=(t<<1)+1,i=r+1,e=this.array[r],s>i&&this.compare(this.array[i],e)&&(r=i,e=this.array[i]),this.compare(e,o)!==!1);)this.array[t]=e,t=r;this.array[t]=o},t}();t.PriorityQueue=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/models/Storage.js"] = function(g) {
			!function(t,e,i,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("../Constant"),o=function(){function t(t){this.storage=t.storage,this.player=t.player,this.state=t.state}return t.prototype.load=function(t){return this.state.load(t)},t.prototype.save=function(t){var e=this.state.save(t),i=r.Region.saveDataPrefix+t.index+".";this.write(e.variables,i+"variables"),this.write(e.label,i+"label"),this.write(e.logs,i+"logs"),e.description&&this.write(e.description,i+"description")},t.prototype.saveBuiltinVariables=function(){this.write(this.state.variables.builtin,r.Region.builtin)},t.prototype.saveSystemVariables=function(){this.write(this.state.variables.system,r.Region.system)},t.prototype.write=function(t,e){this.storage.write({region:g.StorageRegion.Values,regionKey:e,userId:this.player.id,gameId:r.gameId},{data:JSON.stringify(t)})},t}();t.Storage=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/scripts/ScriptManager.js"] = function(g) {
			!function(t,e,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("@cowlick/core"),s=function(){function t(t){this.scripts=t}return t.prototype.register=function(t,e){this.scripts.set(t,e)},t.prototype.call=function(t,e){var r,i;if(e.tag===o.Tag.extension?(r=this.scripts.get(e.data.tag),i=e.data):(r=this.scripts.get(e.tag),i=e),r)try{r(t,i)}catch(a){if(!(a instanceof o.GameError))throw a;this.call(t,{tag:o.Tag.exception,error:a})}else{var a=new o.GameError("script tag was not registered",e);this.call(t,{tag:o.Tag.exception,error:a})}},t}();t.ScriptManager=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["node_modules/@cowlick/engine/lib/scripts/defaultScripts.js"] = function(g) {
			!function(e,a,r,t,n){"use strict";var i=this&&this.__values||function(e){var a="function"==typeof Symbol&&e[Symbol.iterator],r=0;return a?a.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}};Object.defineProperty(e,"__esModule",{value:!0});var o=a("@akashic-extension/akashic-timeline"),c=a("@xnv/akashic-scrollable"),l=a("@pocketberserker/akashic-pagination"),u=a("@cowlick/core"),d=a("../components/ImageButton"),f=a("../components/LabelButton"),y=a("../components/Image"),s=a("../components/Slider"),v=a("../components/Message"),p=a("../Engine"),h=function(e,a){var r=e.current;r.appendLayer(y.createImage(r.body,a),a.layer),r.applyLayerConfig({name:a.layer.name,opacity:a.layer.opacity,visible:a.layer.visible})},m=function(e,a){var r=e.current,t=new g.Pane({scene:r.body,width:a.width,height:a.height,x:a.layer.x,y:a.layer.y,backgroundImage:a.backgroundImage?r.body.assets[a.backgroundImage]:void 0,padding:a.padding,backgroundEffector:a.backgroundEffector?new g.NinePatchSurfaceEffector(r.game,a.backgroundEffector.borderWidth):void 0});t.touchable=!!a.touchable,r.appendLayer(t,a.layer)},b=function(e,a){e.jump(a)},T=function(e,a){var r=new d.ImageButton(e.current.body,a.image);r.move(a.image.layer.x,a.image.layer.y),r.click.add(function(){var r,t;try{for(var n=i(a.scripts),o=n.next();!o.done;o=n.next()){var c=o.value;p.Engine.scriptManager.call(e,c)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(r)throw r.error}}}),e.current.appendLayer(r,a.image.layer)},x=function(e,a){var r,t,n=e.game,o=a.values.length,c=a.width?a.width:n.width/4*3,l=a.height?a.height:32,u=a.margin?a.margin:10,d=void 0!==a.layer.x?a.layer.x:c/6,y=void 0!==a.layer.y?a.layer.y:(n.height/3*2-l*o-u*(o-1))/2,s=0,v=function(r){if(r.path){var t=g._require(n,r.path);if(!t(e.current.gameState.variables))return"continue"}var i=new f.LabelButton({scene:e.current.body,width:c,height:l,backgroundImage:a.backgroundImage,padding:a.padding,backgroundEffector:a.backgroundEffector,text:r.text,config:e.config,gameState:e.current.gameState});i.click.add(function(){p.Engine.scriptManager.call(e,r)});var o=a.direction?a.direction:0;switch(o){case 0:i.move(d,y+(l+u)*s);break;case 1:i.move(d+(c+u)*s,y)}e.current.appendLayer(i,a.layer),s++};try{for(var h=i(a.values),m=h.next();!m.done;m=h.next()){var b=m.value;v(b)}}catch(T){r={error:T}}finally{try{m&&!m.done&&(t=h["return"])&&t.call(h)}finally{if(r)throw r.error}}},w=function(e,a,r){var t={scene:e.body,width:r.width,height:r.height,backgroundImage:r.backgroundImage,padding:r.padding,backgroundEffector:r.backgroundEffector,text:r.text,config:a,gameState:e.gameState};r.fontSize&&(t.fontSize=r.fontSize);var n=new f.LabelButton(t);return n.move(r.layer.x,r.layer.y),n},S=function(e,a){var r,t,n=w(e.current,e.config,a),o=function(a){n.click.add(function(){p.Engine.scriptManager.call(e,a)})};try{for(var c=i(a.scripts),l=c.next();!l.done;l=c.next()){var u=l.value;o(u)}}catch(g){r={error:g}}finally{try{l&&!l.done&&(t=c["return"])&&t.call(c)}finally{if(r)throw r.error}}e.current.appendLayer(n,a.layer)},k=function(e,a){e.current.updateText(a)},E=function(e,a){e.current.applyLayerConfig(a)},L=function(e,a){e.current.playAudio(a)},V=function(e,a){e.current.changeVolume(a)},M=function(e,a){e.current.stopAudio(a)},I=function(e,a){e.current.playVideo(a)},B=function(e,a){e.current.stopVideo(a)},z=function(e,a){var r=e.current.body;r.pointUpCapture.addOnce(function(){var r,t;try{for(var n=i(a.scripts),o=n.next();!o.done;o=n.next()){var c=o.value;p.Engine.scriptManager.call(e,c)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(r)throw r.error}}},r)},C=function(e,a){e.current.requestNextFrame()},P=function(e,a){switch(a.value){case 1:e.current.disableWindowClick();break;case 0:e.current.enableWindowClick()}},_=function(e,a){e.save(a)},A=function(e,a){e.load(a)},q=function(e,a){var r=g._require(e.game,a.path);r(e.current.gameState.variables)},O=function(e,a){var r,t,n=g._require(e.game,a.path);if(n(e.current.gameState.variables)){try{for(var o=i(a.scripts),c=o.next();!c.done;c=o.next()){var l=c.value;p.Engine.scriptManager.call(e,l)}}catch(u){r={error:u}}finally{try{c&&!c.done&&(t=o["return"])&&t.call(o)}finally{if(r)throw r.error}}return!0}return!1},W=function(e,a){var r,t,n,o,l={name:u.LayerKind.backlog};try{for(var g=i(a.scripts),d=g.next();!d.done;d=g.next()){var f=d.value;p.Engine.scriptManager.call(e,f)}}catch(y){r={error:y}}finally{try{d&&!d.done&&(t=g["return"])&&t.call(g)}finally{if(r)throw r.error}}var s=e.current,h=s.enabledWindowClick;h&&P(e,{tag:u.Tag.trigger,value:1});var m=new c.Scrollable({scene:s.body,x:20,y:50,width:e.game.width-50,height:e.game.height-70,vertical:!0,horizontal:!1});s.appendLayer(m,l);var b=new v.Message({scene:s.body,config:e.config,width:e.game.width-60,x:0,y:0,gameState:s.gameState}),T={tag:u.Tag.text,values:[]};try{for(var x=i(e.backlog),w=x.next();!w.done;w=x.next()){var k=w.value;k.text&&(0!==T.values.length?T.values.push("\n",k.text):T.values.push(k.text))}}catch(E){n={error:E}}finally{try{w&&!w.done&&(o=x["return"])&&o.call(x)}finally{if(n)throw n.error}}b.updateText(T),b.showAll(),m.content.append(b);var L=[{tag:u.Tag.removeLayer,name:l.name}];h&&L.push({tag:u.Tag.trigger,value:0});var V=80,M={tag:u.Tag.link,layer:{name:l.name,x:e.game.width-V-10,y:20},width:V,height:24,text:"close",scripts:L};S(e,M)},j=function(e,a){e.current.removeLayer(a.name)},D=function(e,a){e.current.gameState.variables.system={}},F=function(e,a){e.current.gameState.variables.current={}},N=function(e,a){e.current.transition(a.layer,function(r){var t=new o.Timeline(e.current.body);t.create(r,{modified:r.modified,destroyed:r.destroyed}).fadeIn(a.duration).call(function(){var r,t;try{for(var n=i(a.after),o=n.next();!o.done;o=n.next()){var c=o.value;p.Engine.scriptManager.call(e,c)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(r)throw r.error}}})})},K=function(e,a){e.current.transition(a.layer,function(r){var t=new o.Timeline(e.current.body);t.create(r,{modified:r.modified,destroyed:r.destroyed}).fadeOut(a.duration).call(function(){var r,t;try{for(var n=i(a.after),o=n.next();!o.done;o=n.next()){var c=o.value;p.Engine.scriptManager.call(e,c)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(r)throw r.error}}})})},R=function(e,a){e.current.body.setTimeout(function(){var r,t;try{for(var n=i(a.scripts),o=n.next();!o.done;o=n.next()){var c=o.value;p.Engine.scriptManager.call(e,c)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(t=n["return"])&&t.call(n)}finally{if(r)throw r.error}}},a.milliseconds)},U=function(e,a){var r,t,n,o;try{for(var c=i(a.conditions),l=c.next();!l.done;l=c.next()){var u=l.value;if(O(e,u))return}}catch(g){r={error:g}}finally{try{l&&!l.done&&(t=c["return"])&&t.call(c)}finally{if(r)throw r.error}}try{for(var d=i(a.elseBody),f=d.next();!f.done;f=d.next()){var y=f.value;p.Engine.scriptManager.call(e,y)}}catch(s){n={error:s}}finally{try{f&&!f.done&&(o=d["return"])&&o.call(d)}finally{if(n)throw n.error}}},G=function(e,a){console.warn(a.message,a.data)},H=function(e,a){var r=new s.Slider({scene:e.current.body,width:0,height:0,x:a.layer.x,y:a.layer.y,data:a,state:e.current.gameState});e.current.appendLayer(r,a.layer)};e.autoMode=function(e,a){e.current.gameState.getValue({type:u.VariableType.builtin,name:u.BuiltinVariable.autoMode})&&e.current.setAutoTrigger()};var J=function(e,a){e.closeSaveLoadScene()},Q=function(e,a,r,t){var n=l.Position.Top;switch(r.button){case u.Position.Top:n=l.Position.Top;break;case u.Position.Bottom:n=l.Position.Bottom}var o=new l.Pagination({scene:e.body,x:20,y:40,width:e.body.game.width-40,height:e.body.game.height-50,limit:{vertical:r.vertical,horizontal:r.horizontal},position:n,paddingRight:r.padding,first:!0,last:!0});e.body.append(o);for(var c=function(n){var c={tag:u.Tag.link,layer:r.base.layer,width:r.base.width,height:r.base.height,backgroundImage:r.base.backgroundImage,padding:r.base.padding,backgroundEffector:r.base.backgroundEffector,text:String(n),scripts:t(n)},l=w(e,a.config,c);l.click.add(function(){var e,r;try{for(var t=i(c.scripts),n=t.next();!n.done;n=t.next()){var o=n.value;p.Engine.scriptManager.call(a,o)}}catch(l){e={error:l}}finally{try{n&&!n.done&&(r=t["return"])&&r.call(t)}finally{if(e)throw e.error}}}),o.content.append(l)},g=0;g<a.config.system.maxSaveCount;g++)c(g)},X=function(e,a,r){e.openSaveLoadScene(function(t){return Q(t,e,a,r)})},Y=function(e,a){X(e,a,function(e){return[{tag:u.Tag.save,index:e,force:!0}]})},Z=function(e,a){X(e,a,function(e){return[{tag:u.Tag.closeLoadScene},{tag:u.Tag.load,index:e}]})},$=function(e,a){e.current.gameState.setValue({type:u.VariableType.builtin,name:u.BuiltinVariable.messageSpeed},a.speed),e.current.applyMessageSpeed()},ee=function(e,a){a.size&&e.current.gameState.setValue({type:u.VariableType.builtin,name:u.BuiltinVariable.fontSize},"default"===a.size?e.config.font.size:a.size),a.color&&e.current.gameState.setValue({type:u.VariableType.builtin,name:u.BuiltinVariable.fontColor},"default"===a.color?e.config.font.color:a.color),e.current.applyFontSetting()},ae=function(e,a){e.current.gameState.setValue({type:u.VariableType.builtin,name:u.BuiltinVariable.realTimeDisplay},a.enabled)},re=function(e,a){var r,t,n=new Set;try{for(var o=i(a.targets),c=o.next();!c.done;c=o.next()){var l=c.value;l.tag!==u.Tag.fadeIn&&l.tag!==u.Tag.fadeOut&&"layer"in l&&n.add(l.layer)}}catch(g){r={error:g}}finally{try{c&&!c.done&&(t=o["return"])&&t.call(o)}finally{if(r)throw r.error}}e.current.removeLayers(n)};e.defaultScripts=new Map([[u.Tag.image,h],[u.Tag.pane,m],[u.Tag.jump,b],[u.Tag.button,T],[u.Tag.choice,x],[u.Tag.link,S],[u.Tag.text,k],[u.Tag.layer,E],[u.Tag.playAudio,L],[u.Tag.stopAudio,M],[u.Tag.playVideo,I],[u.Tag.changeVolume,V],[u.Tag.stopVideo,B],[u.Tag.click,z],[u.Tag.skip,C],[u.Tag.trigger,P],[u.Tag.save,_],[u.Tag.load,A],[u.Tag.evaluate,q],[u.Tag.condition,O],[u.Tag.backlog,W],[u.Tag.removeLayer,j],[u.Tag.clearSystemVariables,D],[u.Tag.clearCurrentVariables,F],[u.Tag.fadeIn,N],[u.Tag.fadeOut,K],[u.Tag.timeout,R],[u.Tag.ifElse,U],[u.Tag.exception,G],[u.Tag.slider,H],[u.Tag.autoMode,e.autoMode],[u.Tag.closeLoadScene,J],[u.Tag.openSaveScene,Y],[u.Tag.openLoadScene,Z],[u.Tag.messageSpeed,$],[u.Tag.font,ee],[u.Tag.realTimeDisplay,ae],[u.Tag.removeLayers,re]])}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
	</script>

<script>
	var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),LocalScriptAsset=function(t){function o(o,n){var e=t.call(this,o,n)||this;return e.func=window.gLocalAssetContainer[o],e}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load script asset"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);	!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";var n=e("@akashic/akashic-engine"),o=e("./validator"),i="akst:",a=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error("Slots is not supported.");default:throw new Error("Unknown region.")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf(i)){var n=e.slice(i.length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf("*")||"*"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf(i)&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error("Invalid condition.");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error("Unknown StorageCountsOperation");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem(""+i+e,JSON.stringify(t))},e.prototype.getValue=function(e){var t=JSON.parse(this._localStorage.getItem(""+i+e));return t},e.prototype.storageKeyToStringKey=function(e){var t=e.region||"",r=null!=e.gameId?String(e.gameId):"",n=null!=e.userId?String(e.userId):"",o=e.regionKey||"";return t+"/"+r+"/"+n+"/"+o},e.prototype.stringKeyToStorageKey=function(e){var t=e.split("/"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||"",r=null!=e.gameId?String(e.gameId):"",n=null!=e.userId?String(e.userId):"",o="";if("*"===n&&(n="[0-9]+"),-1!==e.regionKey.indexOf("*")){var i=e.regionKey.split(".");i.forEach(function(e,t){o+="*"===e?"[.a-z0-9]*":-1!==e.indexOf("*")?e.replace("*","[a-z0-9]*"):e,t!==i.length-1&&(o+=".")})}else o=e.regionKey.replace(".",".");return new RegExp("^"+t+"/"+r+"/"+n+"/"+o+"$")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(i>o)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(i>o)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(i>o)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(i>o)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf("$gameId")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=a},{"./validator":3,"@akashic/akashic-engine":"@akashic/akashic-engine"}],2:[function(e,t,r){"use strict";var n=e("./GameStorage");r.GameStorage=n.GameStorage},{"./GameStorage":1}],3:[function(e,t,r){"use strict";function n(e,t){u(e.length>0,"regionKey is empty.");var r=e.split(".");u(r.length<=c,"The maximum number of layers in the region key is "+c+".");for(var n=!1,o=0;o<r.length;++o)t?"*"===r[o]?(u(!n,"The only one layer of the region key for reading consists of a wildcard character."),n=!0):u(/^(\*|[a-z])[a-z0-9]{0,31}\*?$/.test(r[o]),"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'."):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,"Invalid region."),u(e.regionKey,"regionKey must be set."),n(e.regionKey,t),u(e.gameId||e.userId,"StorageKey must have any one at least from gameId and userId."),null!=e.gameId&&(u.equal(typeof e.gameId,"string","gameId must be a string type."),u(e.gameId.length>0,"gameId is empty.")),null!=e.userId&&(u.equal(typeof e.userId,"string","userId must be a string type."),u(e.userId.length>0,"userId is empty."),t?"*"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is "*".'),u(-1===e.regionKey.indexOf("*"),'regionKey for reading must not include "*" when userId is "*".')):u("*"!==e.userId,'userId for writing must not include "*".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,"Invalid keyOrder."),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,"Invalid valueOrder.")}}function a(e){}var u=e("assert"),s=e("@akashic/akashic-engine"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{"@akashic/akashic-engine":"@akashic/akashic-engine",assert:4}],4:[function(e,t,r){(function(r){"use strict";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);i>o;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return n>r?-1:r>n?1:0}function o(e){return r.Buffer&&"function"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return o(e)?!1:"function"!=typeof r.ArrayBuffer?!1:"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e?e instanceof DataView?!0:e.buffer&&e.buffer instanceof ArrayBuffer?!0:!1:!1}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e),r=t?": "+t:"";return"[Function"+r+"]"}function l(e){return s(c(e.actual),128)+" "+e.operator+" "+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,"==",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)?!0:(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,"notDeepStrictEqual",h)}function m(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(r){}return Error.isPrototypeOf(t)?!1:t.call({},e)===!0}function v(e){var t;try{e()}catch(r){t=r}return t}function S(e,t,r,n){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!o&&f(o,r,"Missing expected exception"+n);var i="string"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,"Got unwanted exception"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e("util/"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return"foo"===function(){}.name}(),x=t.exports=g,I=/\s*function\s+([^\(\s]*)\s*/;x.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf("\n"+o);if(i>=0){var a=n.indexOf("\n",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,"==",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,"!=",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,"deepEqual",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,"deepStrictEqual",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,"notDeepEqual",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,"===",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,"!==",x.notStrictEqual)},x["throws"]=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":8}],5:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g="function"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?": "+t.name:"";return e.stylize("[Function"+h+"]","special")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(I(t))return l(t)}var m="",v=!1,b=["{","}"];if(d(t)&&(v=!0,b=["[","]"]),k(t)){var w=t.name?": "+t.name:"";m=" [Function"+w+"]"}if(O(t)&&(m=" "+RegExp.prototype.toString.call(t)),x(t)&&(m=" "+Date.prototype.toUTCString.call(t)),I(t)&&(m=" "+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(0>n)return O(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var E;return E=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(E,m,b)}function c(e,t){if(w(t))return e.stylize("undefined","undefined");if(S(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return v(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;u>a;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),D(n,o)||(a="["+o+"]"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf("\n")>-1&&(u=i?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),w(a)){if(i&&o.match(/^\d+$/))return u;a=JSON.stringify(""+o),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+u}function p(e,t,r){var n=0,o=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return"number"==typeof e}function S(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&"[object RegExp]"===K(e)}function E(e){return"object"==typeof e&&null!==e}function x(e){return E(e)&&"[object Date]"===K(e)}function I(e){return E(e)&&("[object Error]"===K(e)||e instanceof Error)}function k(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function K(e){return Object.prototype.toString.call(e)}function j(e){return 10>e?"0"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":");return[e.getDate(),C[e.getMonth()],t].join(" ")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return e}}),u=n[r];i>r;u=n[++r])a+=h(u)||!E(u)?" "+u:" "+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!q[e])if(new RegExp("\\b"+e+"\\b","i").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",V(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}]},{},[2])(2)});	window.addEventListener("load",function(){function e(e){function n(e){if(u.containerController){var n={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight},t=Math.min(n.width/e.width,n.height/e.height),o={width:Math.floor(e.width*t),height:Math.floor(e.height*t)};u.containerController.changeScale(t,t);var i={x:Math.floor((n.width-o.width)/2),y:Math.floor((n.height-o.height)/2)};u.containerController.inputHandlerLayer.setOffset(i)}}var t,o=e,i={id:"9999",name:"sandbox-player"},r="sandboxDummyPlayId",a=new gameStorage.GameStorage(window.localStorage,{gameId:o}),d=engineFiles.pdiBrowser,l=engineFiles.gameDriver,c=new l.MemoryAmflowClient({playId:r,putStorageDataSyncFunc:a.set.bind(a),getStorageDataSyncFunc:function(e){var n=a.load(e);return e.map(function(e,t){return{readKey:e,values:n[t]}})}});t="file:"!==location.protocol?[d.WebAudioPlugin,d.HTMLAudioPlugin]:[d.HTMLAudioPlugin];var u=new d.Platform({amflow:c,containerView:document.getElementById("container"),audioPlugins:t});u.loadGameConfiguration=function(e,n){try{var t=window.gLocalAssetContainer["game.json"];t=decodeURIComponent(t),n(null,JSON.parse(t))}catch(o){n(o,null)}},u._resourceFactory.createScriptAsset=function(e,n){return new LocalScriptAsset(e,n)};var g=function(e,n){return new LocalTextAsset(e,n)};"undefined"!=typeof LocalTextAsset&&(u._resourceFactory.createTextAsset=g),driver=new l.GameDriver({platform:u,player:i,errorHandler:function(e){console.log("ERRORHANDLER:",e)}}),driver.gameCreatedTrigger.add(function(e){window.optionProps.magnify&&(n(e),window.addEventListener("resize",function(){n(e)}))}),driver.initialize({configurationUrl:"game.json",assetBase:"./",driverConfiguration:{playId:r,playToken:"dummyToken",executionMode:l.ExecutionMode.Active},loopConfiguration:{loopMode:l.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}e("exportHTML")});	window.g=require("@akashic/akashic-engine"),"gLocalAssetContainer"in window||(window.gLocalAssetContainer={});	var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),LocalTextAsset=function(t){function o(o,e){var n=t.call(this,o,e)||this;return n.data=decodeURIComponent(window.gLocalAssetContainer[o]),n}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load text asset"))},0)},o}(g.TextAsset);</script>

<style type="text/css">
* {
	margin: 0;
	border: 0;
	padding: 0;
}

html {
	width: 100%;
	height: 100%;
}

body {
	overflow: hidden;
	width: 100%;
	height: 100%;
}

#container {
	margin: 0px;
	padding: 0px;
	overflow: hidden;
	touch-action: none;
	width: 100%;
	height: 100%;

	/* iOS: body */
	position: absolute;
}

#container canvas {
	background-size: contain;
}
</style>


</head>
<body>
<div id="container">
</div>
</body>
</html>
